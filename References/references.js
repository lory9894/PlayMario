var AreaSpawnr;
(function(q){var r=function(){function b(a){if(!a)throw Error("No settings given to AreaSpawnr.");if(!a.MapsCreator)throw Error("No MapsCreator provided to AreaSpawnr.");this.MapsCreator=a.MapsCreator;if(!a.MapScreener)throw Error("No MapScreener provided to AreaSpawnr.");this.MapScreener=a.MapScreener;this.onSpawn=a.onSpawn;this.onUnspawn=a.onUnspawn;this.screenAttributes=a.screenAttributes||[];this.stretchAdd=a.stretchAdd;this.afterAdd=a.afterAdd;this.commandScope=a.commandScope}b.prototype.getMapsCreator=
function(){return this.MapsCreator};b.prototype.getMapScreener=function(){return this.MapScreener};b.prototype.getScreenAttributes=function(){return this.screenAttributes};b.prototype.getMapName=function(){return this.mapName};b.prototype.getMap=function(a){return"undefined"!==typeof a?this.MapsCreator.getMap(a):this.mapCurrent};b.prototype.getMaps=function(){return this.MapsCreator.getMaps()};b.prototype.getArea=function(){return this.areaCurrent};b.prototype.getAreaName=function(){return this.areaCurrent.name};
b.prototype.getLocation=function(a){return this.areaCurrent.map.locations[a]};b.prototype.getLocationEntered=function(){return this.locationEntered};b.prototype.getPreThings=function(){return this.prethings};b.prototype.setMap=function(a,c){this.mapCurrent=this.getMap(a);if(!this.mapCurrent)throw Error("Unknown Map in setMap: '"+a+"'.");this.mapName=a;1<arguments.length&&this.setLocation(c);return this.mapCurrent};b.prototype.setLocation=function(a){var c,b;c=this.mapCurrent.locations[a];if(!c)throw Error("Unknown location in setLocation: '"+
a+"'.");this.locationEntered=c;this.areaCurrent=c.area;this.areaCurrent.boundaries={top:0,right:0,bottom:0,left:0};for(b=0;b<this.screenAttributes.length;b+=1)a=this.screenAttributes[b],this.MapScreener[a]=this.areaCurrent[a];this.prethings=this.MapsCreator.getPreThings(c.area);this.areaCurrent.stretches&&this.setStretches(this.areaCurrent.stretches);this.areaCurrent.afters&&this.setAfters(this.areaCurrent.afters)};b.prototype.setStretches=function(a){var c;this.stretches=a;for(c=0;c<a.length;c+=
1)this.stretchAdd.call(this.commandScope||this,a[c],c,a)};b.prototype.setAfters=function(a){var c;this.afters=a;for(c=0;c<a.length;c+=1)this.afterAdd.call(this.commandScope||this,a[c],c,a)};b.prototype.spawnArea=function(a,c,b,d,e){this.onSpawn&&this.applySpawnAction(this.onSpawn,!0,a,c,b,d,e)};b.prototype.unspawnArea=function(a,b,f,d,e){this.onUnspawn&&this.applySpawnAction(this.onUnspawn,!1,a,b,f,d,e)};b.prototype.applySpawnAction=function(a,b,f,d,e,g,h){var p,k,l,m,n;for(p in this.prethings)if(this.prethings.hasOwnProperty(p)&&
(k=this.prethings[p][f],0!==k.length))for(m=k.length/2|0,l=this.findPreThingsSpawnStart(f,k,m,d,e,g,h),m=this.findPreThingsSpawnEnd(f,k,m,d,e,g,h),n=l;n<=m;n+=1)l=k[n],l.spawned!==b&&(l.spawned=b,a(l))};b.prototype.findPreThingsSpawnStart=function(a,c,f,d,e,g,h){a=b.directionKeys[a];d=this.getDirectionEnd(a,d,e,g,h);for(e=0;e<c.length&&!(c[e][a]>=d);e+=1);return e};b.prototype.findPreThingsSpawnEnd=function(a,c,f,d,e,g,h){f=b.directionKeys[a];a=this.getDirectionEnd(b.directionKeys[b.directionOpposites[a]],
d,e,g,h);for(d=c.length-1;0<=d&&!(c[d][f]<=a);--d);return d};b.prototype.getDirectionEnd=function(a,b,f,d,e){switch(a){case "top":return b;case "right":return f;case "bottom":return d;case "left":return e;default:throw Error("Unknown directionKey: "+a);}};b.directionKeys={xInc:"left",xDec:"right",yInc:"top",yDec:"bottom"};b.directionOpposites={xInc:"xDec",xDec:"xInc",yInc:"yDec",yDec:"yInc"};return b}();q.AreaSpawnr=r})(AreaSpawnr||(AreaSpawnr={}));var AudioPlayr;
(function (AudioPlayr_1) {
    "use strict";
    /**
     * An audio library to automate preloading and controlled playback of multiple
     * audio tracks, with support for different browsers' preferred file types.
     */
    var AudioPlayr = (function () {
        /**
         * Initializes a new instance of the AudioPlayr class.
         *
         * @param settings   Settings to use for initialization.
         */
        function AudioPlayr(settings) {
            if (typeof settings.library === "undefined") {
                throw new Error("No library given to AudioPlayr.");
            }
            if (typeof settings.directory === "undefined") {
                throw new Error("No directory given to AudioPlayr.");
            }
            if (typeof settings.fileTypes === "undefined") {
                throw new Error("No fileTypes given to AudioPlayr.");
            }
            if (!settings.ItemsHolder) {
                throw new Error("No ItemsHoldr given to AudioPlayr.");
            }
            var volumeInitial;
            this.ItemsHolder = settings.ItemsHolder;
            this.directory = settings.directory;
            this.fileTypes = settings.fileTypes;
            this.getThemeDefault = settings.getThemeDefault || "Theme";
            this.getVolumeLocal = typeof settings.getVolumeLocal === "undefined"
                ? 1 : settings.getVolumeLocal;
            // Sounds should always start blank
            this.sounds = {};
            // Preload everything!
            this.generateLibraryFromSettings(settings.library);
            volumeInitial = this.ItemsHolder.getItem("volume");
            if (volumeInitial === undefined) {
                this.setVolume(1);
            }
            else {
                this.setVolume(volumeInitial);
            }
            this.setMuted(this.ItemsHolder.getItem("muted") || false);
        }
        /* Simple getters
        */
        /**
         * @returns The listing of <audio> Elements, keyed by name.
         */
        AudioPlayr.prototype.getLibrary = function () {
            return this.library;
        };
        /**
         * @returns The allowed filetypes for audio files.
         */
        AudioPlayr.prototype.getFileTypes = function () {
            return this.fileTypes;
        };
        /**
         * @returns The currently playing <audio> Elements, keyed by name.
         */
        AudioPlayr.prototype.getSounds = function () {
            return this.sounds;
        };
        /**
         * @returns The current playing theme's <audio> Element.
         */
        AudioPlayr.prototype.getTheme = function () {
            return this.theme;
        };
        /**
         * @returns The name of the currently playing theme.
         */
        AudioPlayr.prototype.getThemeName = function () {
            return this.themeName;
        };
        /**
         * @returns The directory under which all filetype directories are to be located.
         */
        AudioPlayr.prototype.getDirectory = function () {
            return this.directory;
        };
        /* Playback modifiers
        */
        /**
         * @returns The current volume as a Number in [0,1], retrieved by the ItemsHoldr.
         */
        AudioPlayr.prototype.getVolume = function () {
            return Number(this.ItemsHolder.getItem("volume") || 0);
        };
        /**
         * Sets the current volume. If not muted, all sounds will have their volume
         * updated.
         *
         * @param volume   A Number in [0,1] to set as the current volume.
         */
        AudioPlayr.prototype.setVolume = function (volume) {
            var i;
            if (!this.getMuted()) {
                for (i in this.sounds) {
                    if (this.sounds.hasOwnProperty(i)) {
                        this.sounds[i].volume = Number(this.sounds[i].getAttribute("volumeReal")) * volume;
                    }
                }
            }
            this.ItemsHolder.setItem("volume", volume.toString());
        };
        /**
         * @returns Whether this is currently muted.
         */
        AudioPlayr.prototype.getMuted = function () {
            return Boolean(Number(this.ItemsHolder.getItem("muted")));
        };
        /**
         * Calls either setMutedOn or setMutedOff as is appropriate.
         *
         * @param muted   The new status for muted.
         */
        AudioPlayr.prototype.setMuted = function (muted) {
            this.getMuted() ? this.setMutedOn() : this.setMutedOff();
        };
        /**
         * Calls either setMutedOn or setMutedOff to toggle whether this is muted.
         */
        AudioPlayr.prototype.toggleMuted = function () {
            this.setMuted(!this.getMuted());
        };
        /**
         * Sets volume to 0 in all currently playing sounds and stores the muted
         * status as on in the internal ItemsHoldr.
         */
        AudioPlayr.prototype.setMutedOn = function () {
            var i;
            for (i in this.sounds) {
                if (this.sounds.hasOwnProperty(i)) {
                    this.sounds[i].volume = 0;
                }
            }
            this.ItemsHolder.setItem("muted", "1");
        };
        /**
         * Sets sound volumes to their actual volumes and stores the muted status
         * as off in the internal ItemsHoldr.
         */
        AudioPlayr.prototype.setMutedOff = function () {
            var volume = this.getVolume(), sound, i;
            for (i in this.sounds) {
                if (this.sounds.hasOwnProperty(i)) {
                    sound = this.sounds[i];
                    sound.volume = Number(sound.getAttribute("volumeReal")) * volume;
                }
            }
            this.ItemsHolder.setItem("muted", "0");
        };
        /* Other modifiers
        */
        /**
         * @returns The Function or Number used as the volume setter for local sounds.
         */
        AudioPlayr.prototype.getGetVolumeLocal = function () {
            return this.getVolumeLocal;
        };
        /**
         * @param getVolumeLocal   A new Function or Number to use as the volume setter
         *                         for local sounds.
         */
        AudioPlayr.prototype.setGetVolumeLocal = function (getVolumeLocalNew) {
            this.getVolumeLocal = getVolumeLocalNew;
        };
        /**
         * @returns The Function or String used to get the default theme for playTheme.
         */
        AudioPlayr.prototype.getGetThemeDefault = function () {
            return this.getThemeDefault;
        };
        /**
         * @param getThemeDefaultNew A new Function or String to use as the source for
         *                           theme names in default playTheme calls.
         */
        AudioPlayr.prototype.setGetThemeDefault = function (getThemeDefaultNew) {
            this.getThemeDefault = getThemeDefaultNew;
        };
        /* Playback
        */
        /**
         * Plays the sound of the given name.
         *
         * @param name   The name of the sound to play.
         * @returns The sound's <audio> element, now playing.
         * @remarks Internally, this stops any previously playing sound of that name
         *          and starts a new one, with volume set to the current volume and
         *          muted status. If the name wasn't previously being played (and
         *          therefore a new Element has been created), an event listener is
         *          added to delete it from sounds after.
         */
        AudioPlayr.prototype.play = function (name) {
            var sound, used;
            // If the sound isn't yet being played, see if it's in the library
            if (!this.sounds.hasOwnProperty(name)) {
                // If the sound also isn't in the library, it's unknown
                if (!this.library.hasOwnProperty(name)) {
                    throw new Error("Unknown name given to AudioPlayr.play: '" + name + "'.");
                }
                sound = this.sounds[name] = this.library[name];
            }
            else {
                sound = this.sounds[name];
            }
            this.soundStop(sound);
            if (this.getMuted()) {
                sound.volume = 0;
            }
            else {
                sound.setAttribute("volumeReal", "1");
                sound.volume = this.getVolume();
            }
            this.playSound(sound);
            used = Number(sound.getAttribute("used"));
            // If this is the song's first play, let it know how to stop
            if (!used) {
                sound.setAttribute("used", String(used + 1));
                sound.addEventListener("ended", this.soundFinish.bind(this, name));
            }
            sound.setAttribute("name", name);
            return sound;
        };
        /**
         * Pauses all currently playing sounds.
         */
        AudioPlayr.prototype.pauseAll = function () {
            var i;
            for (i in this.sounds) {
                if (this.sounds.hasOwnProperty(i)) {
                    this.pauseSound(this.sounds[i]);
                }
            }
        };
        /**
         * Un-pauses (resumes) all currently paused sounds.
         */
        AudioPlayr.prototype.resumeAll = function () {
            var i;
            for (i in this.sounds) {
                if (!this.sounds.hasOwnProperty(i)) {
                    continue;
                }
                this.playSound(this.sounds[i]);
            }
        };
        /**
         * Pauses the currently playing theme, if there is one.
         */
        AudioPlayr.prototype.pauseTheme = function () {
            if (this.theme) {
                this.pauseSound(this.theme);
            }
        };
        /**
         * Resumes the theme, if there is one and it's paused.
         */
        AudioPlayr.prototype.resumeTheme = function () {
            if (this.theme) {
                this.playSound(this.theme);
            }
        };
        /**
         * Stops all sounds and any theme, and removes all references to them.
         */
        AudioPlayr.prototype.clearAll = function () {
            this.pauseAll();
            this.clearTheme();
            this.sounds = {};
        };
        /**
         * Pauses and removes the theme, if there is one.
         */
        AudioPlayr.prototype.clearTheme = function () {
            if (!this.theme) {
                return;
            }
            this.pauseTheme();
            delete this.sounds[this.theme.getAttribute("name")];
            this.theme = undefined;
            this.themeName = undefined;
        };
        /**
         * "Local" version of play that changes the output sound's volume depending
         * on the result of a getVolumeLocal call.
         *
         * @param name   The name of the sound to play.
         * @param location   An argument for getVolumeLocal, if that's a Function.
         * @returns The sound's <audio> element, now playing.
         */
        AudioPlayr.prototype.playLocal = function (name, location) {
            var sound = this.play(name), volumeReal;
            switch (this.getVolumeLocal.constructor) {
                case Function:
                    volumeReal = this.getVolumeLocal(location);
                    break;
                case Number:
                    volumeReal = this.getVolumeLocal;
                    break;
                default:
                    volumeReal = Number(this.getVolumeLocal) || 1;
                    break;
            }
            sound.setAttribute("volumeReal", String(volumeReal));
            if (this.getMuted()) {
                sound.volume = 0;
            }
            else {
                sound.volume = volumeReal * this.getVolume();
            }
            return sound;
        };
        /**
         * Pauses any previously playing theme and starts playback of a new theme.
         *
         * @param name   The name of the sound to be used as the theme. If not
         *               provided, getThemeDefault is used to
         *                          provide one.
         * @param loop   Whether the theme should always loop (by default, true).
         * @returns The theme's <audio> element, now playing.
         * @remarks This is different from normal sounds in that it normally loops
         *          and is controlled by pauseTheme and co. If loop is on and the
         *          sound wasn't already playing, an event listener is added for
         *          when it ends.
         */
        AudioPlayr.prototype.playTheme = function (name, loop) {
            this.pauseTheme();
            // Loop defaults to true
            loop = typeof loop !== "undefined" ? loop : true;
            // If name isn't given, use the default getter
            if (typeof name === "undefined") {
                switch (this.getThemeDefault.constructor) {
                    case Function:
                        name = this.getThemeDefault();
                        break;
                    default:
                        name = this.getThemeDefault;
                        break;
                }
            }
            // If a theme already exists, kill it
            if (typeof this.theme !== "undefined" && this.theme.hasAttribute("name")) {
                delete this.sounds[this.theme.getAttribute("name")];
            }
            this.themeName = name;
            this.theme = this.sounds[name] = this.play(name);
            this.theme.loop = loop;
            // If it's used (no repeat), add the event listener to resume theme
            if (this.theme.getAttribute("used") === "1") {
                this.theme.addEventListener("ended", this.playTheme.bind(this));
            }
            return this.theme;
        };
        /**
         * Wrapper around playTheme that plays a sound, then a theme. This is
         * implemented using an event listener on the sound's ending.
         *
         * @param prefix    The name of a sound to play before the theme.
         * @param name   The name of the sound to be used as the theme. If not
         *               provided, getThemeDefault is used to
         *                          provide one.
         * @param loop   Whether the theme should always loop (by default, false).
         * @returns The sound's <audio> element, now playing.
         */
        AudioPlayr.prototype.playThemePrefixed = function (prefix, name, loop) {
            var sound = this.play(prefix);
            this.pauseTheme();
            // If name isn't given, use the default getter
            if (typeof name === "undefined") {
                switch (this.getThemeDefault.constructor) {
                    case Function:
                        name = this.getThemeDefault();
                        break;
                    default:
                        name = this.getThemeDefault;
                        break;
                }
            }
            this.addEventListener(prefix, "ended", this.playTheme.bind(this, prefix + name, loop));
            return sound;
        };
        /* Public utilities
        */
        /**
         * Adds an event listener to a currently playing sound. The sound will keep
         * track of event listeners via an .addedEvents attribute, so they can be
         * cancelled later.
         *
         * @param name   The name of the sound.
         * @param event   The name of the event, such as "ended".
         * @param callback   The Function to be called by the event.
         */
        AudioPlayr.prototype.addEventListener = function (name, event, callback) {
            var sound = this.library[name];
            if (!sound) {
                throw new Error("Unknown name given to addEventListener: '" + name + "'.");
            }
            if (!sound.addedEvents) {
                sound.addedEvents = {};
            }
            if (!sound.addedEvents[event]) {
                sound.addedEvents[event] = [callback];
            }
            else {
                sound.addedEvents[event].push(callback);
            }
            sound.addEventListener(event, callback);
        };
        /**
         * Clears all events added by this.addEventListener to a sound under a given
         * event.
         *
         * @param name   The name of the sound.
         * @param event   The name of the event, such as "ended".
         */
        AudioPlayr.prototype.removeEventListeners = function (name, event) {
            var sound = this.library[name], events, i;
            if (!sound) {
                throw new Error("Unknown name given to removeEventListeners: '" + name + "'.");
            }
            if (!sound.addedEvents) {
                return;
            }
            events = sound.addedEvents[event];
            if (!events) {
                return;
            }
            for (i = 0; i < events.length; i += 1) {
                sound.removeEventListener(event, events[i]);
            }
            events.length = 0;
        };
        /**
         * Adds an event listener to a sound. If the sound doesn't exist or has
         * finished playing, it's called immediately.
         *
         * @param name   The name of the sound.
         * @param event   The name of the event, such as "onended".
         * @param callback   The Function to be called by the event.
         */
        AudioPlayr.prototype.addEventImmediate = function (name, event, callback) {
            if (!this.sounds.hasOwnProperty(name) || this.sounds[name].paused) {
                callback();
                return;
            }
            this.sounds[name].addEventListener(event, callback);
        };
        /* Private utilities
        */
        /**
         * Called when a sound has completed to get it out of sounds.
         *
         * @param name   The name of the sound that just finished.
         */
        AudioPlayr.prototype.soundFinish = function (name) {
            if (this.sounds.hasOwnProperty(name)) {
                delete this.sounds[name];
            }
        };
        /**
         * Carefully stops a sound. HTMLAudioElement don't natively have a .stop()
         * function, so this is the shim to do that.
         */
        AudioPlayr.prototype.soundStop = function (sound) {
            this.pauseSound(sound);
            if (sound.readyState) {
                sound.currentTime = 0;
            }
        };
        /* Private loading / resetting
        */
        /**
         * Loads every sound defined in the library via AJAX. Sounds are loaded
         * into <audio> elements via createAudio and stored in the library.
         */
        AudioPlayr.prototype.generateLibraryFromSettings = function (librarySettings) {
            var directory = {}, directorySoundNames, directoryName, name, j;
            this.library = {};
            this.directories = {};
            // For each given directory (e.g. names, themes):
            for (directoryName in librarySettings) {
                if (!librarySettings.hasOwnProperty(directoryName)) {
                    continue;
                }
                directory = {};
                directorySoundNames = librarySettings[directoryName];
                // For each audio file to be loaded in that directory:
                for (j = 0; j < directorySoundNames.length; j += 1) {
                    name = directorySoundNames[j];
                    // Create the sound and store it in the container
                    this.library[name] = directory[name] = this.createAudio(name, directoryName);
                }
                // The full directory is stored in the master directories
                this.directories[directoryName] = directory;
            }
        };
        /**
         * Creates an audio element, gives it sources, and starts preloading.
         *
         * @param name   The name of the sound to play.
         * @param sectionName   The name of the directory containing the sound.
         * @returns An <audio> element ocntaining the sound, currently playing.
         */
        AudioPlayr.prototype.createAudio = function (name, directory) {
            var sound = document.createElement("audio"), sourceType, child, i;
            // Create an audio source for each child
            for (i = 0; i < this.fileTypes.length; i += 1) {
                sourceType = this.fileTypes[i];
                child = document.createElement("source");
                child.type = "audio/" + sourceType;
                child.src = this.directory + "/" + directory + "/" + sourceType + "/" + name + "." + sourceType;
                sound.appendChild(child);
            }
            // This preloads the sound.
            sound.volume = 0;
            sound.setAttribute("volumeReal", "1");
            sound.setAttribute("used", "0");
            this.playSound(sound);
            return sound;
        };
        /**
         * Utility to try to play a sound, which may not be possible in headless
         * environments like PhantomJS.
         *
         * @param sound   An <audio> element to play.
         * @returns Whether the sound was able to play.
         */
        AudioPlayr.prototype.playSound = function (sound) {
            if (sound && sound.play) {
                sound.play();
                return true;
            }
            return false;
        };
        /**
         * Utility to try to pause a sound, which may not be possible in headless
         * environments like PhantomJS.
         *
         * @param sound   An <audio> element to pause.
         * @returns Whether the sound was able to pause.
         */
        AudioPlayr.prototype.pauseSound = function (sound) {
            if (sound && sound.pause) {
                sound.pause();
                return true;
            }
            return false;
        };
        return AudioPlayr;
    })();
    AudioPlayr_1.AudioPlayr = AudioPlayr;
})(AudioPlayr || (AudioPlayr = {}));
var ChangeLinr;
(function(e){var f=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given to ChangeLinr.");if("undefined"===typeof a.pipeline)throw Error("No pipeline given to ChangeLinr.");if("undefined"===typeof a.transforms)throw Error("No transforms given to ChangeLinr.");this.pipeline=a.pipeline||[];this.transforms=a.transforms||{};this.doMakeCache="undefined"===typeof a.doMakeCache?!0:a.doMakeCache;this.doUseCache="undefined"===typeof a.doUseCache?!0:a.doUseCache;this.cache=
{};this.cacheFull={};for(a=0;a<this.pipeline.length;a+=1){if(!this.pipeline[a])throw Error("Pipe["+a+"] is invalid.");if(!this.transforms.hasOwnProperty(this.pipeline[a]))throw Error("Pipe["+a+"] ('"+this.pipeline[a]+"') not found in transforms.");if(!(this.transforms[this.pipeline[a]]instanceof Function))throw Error("Pipe["+a+"] ('"+this.pipeline[a]+"') is not a valid Function from transforms.");this.cacheFull[a]=this.cacheFull[this.pipeline[a]]={}}}b.prototype.getCache=function(){return this.cache};
b.prototype.getCached=function(a){return this.cache[a]};b.prototype.getCacheFull=function(){return this.cacheFull};b.prototype.getDoMakeCache=function(){return this.doMakeCache};b.prototype.getDoUseCache=function(){return this.doUseCache};b.prototype.process=function(a,d,b){var c;"undefined"===typeof d&&(this.doMakeCache||this.doUseCache)&&(d=a);if(this.doUseCache&&this.cache.hasOwnProperty(d))return this.cache[d];for(c=0;c<this.pipeline.length;c+=1)a=this.transforms[this.pipeline[c]](a,d,b,this),
this.doMakeCache&&(this.cacheFull[this.pipeline[c]][d]=a);this.doMakeCache&&(this.cache[d]=a);return a};b.prototype.processFull=function(a,b,e){var c={};this.process(a,b,e);for(a=0;a<this.pipeline.length;a+=1)c[a]=c[this.pipeline[a]]=this.cacheFull[this.pipeline[a]][b];return c};return b}();e.ChangeLinr=f})(ChangeLinr||(ChangeLinr={}));var DeviceLayr;
(function(f){(function(d){d[d.negative=0]="negative";d[d.neutral=1]="neutral";d[d.positive=2]="positive"})(f.AxisStatus||(f.AxisStatus={}));var g=f.AxisStatus,k=function(){function d(a){if("undefined"===typeof a)throw Error("No settings object given to DeviceLayr.");if("undefined"===typeof a.InputWriter)throw Error("No InputWriter given to DeviceLayr.");this.InputWritr=a.InputWriter;this.triggers=a.triggers||{};this.aliases=a.aliases||{on:"on",off:"off"};this.gamepads=[]}d.prototype.getInputWritr=function(){return this.InputWritr};
d.prototype.getTriggers=function(){return this.triggers};d.prototype.getAliases=function(){return this.aliases};d.prototype.getGamepads=function(){return this.gamepads};d.prototype.checkNavigatorGamepads=function(){if("undefined"===typeof navigator.getGamepads||!navigator.getGamepads()[this.gamepads.length])return 0;this.registerGamepad(navigator.getGamepads()[this.gamepads.length]);return this.checkNavigatorGamepads()+1};d.prototype.registerGamepad=function(a){this.gamepads.push(a);this.setDefaultTriggerStatuses(a,
this.triggers)};d.prototype.activateAllGamepadTriggers=function(){for(var a=0;a<this.gamepads.length;a+=1)this.activateGamepadTriggers(this.gamepads[a])};d.prototype.activateGamepadTriggers=function(a){var c=d.controllerMappings[a.mapping||"standard"],b;for(b=Math.min(c.axes.length,a.axes.length)-1;0<=b;--b)this.activateAxisTrigger(a,c.axes[b].name,c.axes[b].axis,a.axes[b]);for(b=Math.min(c.buttons.length,a.buttons.length)-1;0<=b;--b)this.activateButtonTrigger(a,c.buttons[b],a.buttons[b].pressed)};
d.prototype.activateAxisTrigger=function(a,c,b,d){if(c=this.triggers[c][b]){a=this.getAxisStatus(a,d);if(c.status===a)return!1;void 0!==c.status&&void 0!==c[g[c.status]]&&this.InputWritr.callEvent(this.aliases.off,c[g[c.status]]);c.status=a;void 0!==c[g[a]]&&this.InputWritr.callEvent(this.aliases.on,c[g[a]]);return!0}};d.prototype.activateButtonTrigger=function(a,c,b){a=this.triggers[c];if(!a||a.status===b)return!1;a.status=b;this.InputWritr.callEvent(b?this.aliases.on:this.aliases.off,a.trigger);
return!0};d.prototype.clearAllGamepadTriggers=function(){for(var a=0;a<this.gamepads.length;a+=1)this.clearGamepadTriggers(this.gamepads[a])};d.prototype.clearGamepadTriggers=function(a){var c=d.controllerMappings[a.mapping||"standard"],b;for(b=0;b<c.axes.length;b+=1)this.clearAxisTrigger(a,c.axes[b].name,c.axes[b].axis);for(b=0;b<c.buttons.length;b+=1)this.clearButtonTrigger(a,c.buttons[b])};d.prototype.clearAxisTrigger=function(a,c,b){this.triggers[c][b].status=g.neutral};d.prototype.clearButtonTrigger=
function(a,c){this.triggers[c].status=!1};d.prototype.setDefaultTriggerStatuses=function(a,c){var b=d.controllerMappings[a.mapping||"standard"],h,e,f;for(e=0;e<b.buttons.length;e+=1)(h=c[b.buttons[e]])&&void 0===h.status&&(h.status=!1);for(e=0;e<b.axes.length;e+=1)for(f in h=c[b.axes[e].name],h)h.hasOwnProperty(f)&&void 0===h[f].status&&(h[f].status=g.neutral)};d.prototype.getAxisStatus=function(a,c){var b=d.controllerMappings[a.mapping||"standard"].joystickThreshold;return c>b?g.positive:c<-b?g.negative:
g.neutral};d.controllerMappings={standard:{axes:[{axis:"x",joystick:0,name:"leftJoystick"},{axis:"y",joystick:0,name:"leftJoystick"},{axis:"x",joystick:1,name:"rightJoystick"},{axis:"y",joystick:1,name:"rightJoystick"}],buttons:"a b x y leftTop rightTop leftTrigger rightTrigger select start leftStick rightStick dpadUp dpadDown dpadLeft dpadRight".split(" "),joystickThreshold:.49}};return d}();f.DeviceLayr=k})(DeviceLayr||(DeviceLayr={}));var EightBittr;
(function(h){var k=function(){function e(a){void 0===a&&(a={});var b=e.prototype.ensureCorrectCaller(this),c=a.constants,d=a.constantsSource||b;b.unitsize=a.unitsize||1;if(b.constants=c)for(a=0;a<c.length;a+=1)b[c[a]]=d[c[a]]}e.prototype.reset=function(a,b,c){var d,f;a.customs=c;for(f=0;f<b.length;f+=1){d=b[f];if(!a[d])throw Error(d+" is missing on a resetting EightBittr.");a[d](a,c)}};e.prototype.resetTimed=function(a,b,c){var d=performance.now(),f,e,g;this.resetTimes={order:b,times:[]};for(g=0;g<
b.length;g+=1)f=performance.now(),a[b[g]](a,c),e=performance.now(),this.resetTimes.times.push({name:b[g],timeStart:f,timeEnd:e,timeTaken:e-f});a=performance.now();this.resetTimes.total={name:"resetTimed",timeStart:d,timeEnd:a,timeTaken:a-d}};e.prototype.createCanvas=function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=a;c.height=b;"undefined"!==typeof d.imageSmoothingEnabled?d.imageSmoothingEnabled=!1:"undefined"!==typeof d.webkitImageSmoothingEnabled?d.webkitImageSmoothingEnabled=
!1:"undefined"!==typeof d.mozImageSmoothingEnabled?d.mozImageSmoothingEnabled=!1:"undefined"!==typeof d.msImageSmoothingEnabled?d.msImageSmoothingEnabled=!1:"undefined"!==typeof d.oImageSmoothingEnabled&&(d.oImageSmoothingEnabled=!1);return c};e.prototype.shiftVert=function(a,b){a.top+=b;a.bottom+=b};e.prototype.shiftHoriz=function(a,b){a.left+=b;a.right+=b};e.prototype.setTop=function(a,b){a.top=b;a.bottom=a.top+a.height*a.EightBitter.unitsize};e.prototype.setRight=function(a,b){a.right=b;a.left=
a.right-a.width*a.EightBitter.unitsize};e.prototype.setBottom=function(a,b){a.bottom=b;a.top=a.bottom-a.height*a.EightBitter.unitsize};e.prototype.setLeft=function(a,b){a.left=b;a.right=a.left+a.width*a.EightBitter.unitsize};e.prototype.setMidX=function(a,b){a.EightBitter.setLeft(a,b-a.width*a.EightBitter.unitsize/2)};e.prototype.setMidY=function(a,b){a.EightBitter.setTop(a,b-a.height*a.EightBitter.unitsize/2)};e.prototype.setMid=function(a,b,c){a.EightBitter.setMidX(a,b);a.EightBitter.setMidY(a,
c)};e.prototype.getMidX=function(a){return a.left+a.width*a.EightBitter.unitsize/2};e.prototype.getMidY=function(a){return a.top+a.height*a.EightBitter.unitsize/2};e.prototype.setMidObj=function(a,b){a.EightBitter.setMidXObj(a,b);a.EightBitter.setMidYObj(a,b)};e.prototype.setMidXObj=function(a,b){a.EightBitter.setLeft(a,a.EightBitter.getMidX(b)-a.width*a.EightBitter.unitsize/2)};e.prototype.setMidYObj=function(a,b){a.EightBitter.setTop(a,a.EightBitter.getMidY(b)-a.height*a.EightBitter.unitsize/2)};
e.prototype.objectToLeft=function(a,b){return a.EightBitter.getMidX(a)<a.EightBitter.getMidX(b)};e.prototype.updateTop=function(a,b){a.top+=b||0;a.bottom=a.top+a.height*a.EightBitter.unitsize};e.prototype.updateRight=function(a,b){a.right+=b||0;a.left=a.right-a.width*a.EightBitter.unitsize};e.prototype.updateBottom=function(a,b){a.bottom+=b||0;a.top=a.bottom-a.height*a.EightBitter.unitsize};e.prototype.updateLeft=function(a,b){a.left+=b||0;a.right=a.left+a.width*a.EightBitter.unitsize};e.prototype.slideToX=
function(a,b,c){var d=a.EightBitter.getMidX(a);c=c||Infinity;d<b?a.EightBitter.shiftHoriz(a,Math.min(c,b-d)):a.EightBitter.shiftHoriz(a,Math.max(-c,b-d))};e.prototype.slideToY=function(a,b,c){var d=a.EightBitter.getMidY(a);c=c||Infinity;d<b?a.EightBitter.shiftVert(a,Math.min(c,b-d)):a.EightBitter.shiftVert(a,Math.max(-c,b-d))};e.prototype.ensureCorrectCaller=function(a){if(!(a instanceof e))throw Error("A function requires the caller ('this') to be the manipulated EightBittr object. Unfortunately, 'this' is a "+
typeof this+".");return a};e.prototype.proliferate=function(a,b,c){void 0===c&&(c=!1);var d,f;for(f in b)!b.hasOwnProperty(f)||c&&a.hasOwnProperty(f)||(d=b[f],"object"===typeof d?(a.hasOwnProperty(f)||(a[f]=new d.constructor),this.proliferate(a[f],d,c)):a[f]=d);return a};e.prototype.proliferateHard=function(a,b,c){var d,f;for(f in b)!b.hasOwnProperty(f)||c&&a[f]||(d=b[f],"object"===typeof d?(a[f]||(a[f]=new d.constructor),this.proliferate(a[f],d,c)):a[f]=d);return a};e.prototype.proliferateElement=
function(a,b,c){void 0===c&&(c=!1);var d,f,e;for(f in b)if(b.hasOwnProperty(f)&&(!c||!a.hasOwnProperty(f)))switch(d=b[f],f){case "children":case "children":if("undefined"!==typeof d)for(e=0;e<d.length;e+=1)a.appendChild(d[e]);break;case "style":this.proliferate(a[f],d);break;default:null===d?a[f]=null:"object"===typeof d?(a.hasOwnProperty(f)||(a[f]=new d.constructor),this.proliferate(a[f],d,c)):a[f]=d}return a};e.prototype.createElement=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];
var c=e.prototype.ensureCorrectCaller(this),d=document.createElement(a||"div"),f;for(f=0;f<b.length;f+=1)c.proliferateElement(d,b[f]);return d};e.prototype.followPathHard=function(a,b,c){for(void 0===c&&(c=0);c<b.length;c+=1){if("undefined"===typeof a[b[c]])return;a=a[b[c]]}return a};e.prototype.arraySwitch=function(a,b,c){b.splice(b.indexOf(a),1);c.push(a)};e.prototype.arrayToBeginning=function(a,b){b.splice(b.indexOf(a),1);b.unshift(a)};e.prototype.arrayToEnd=function(a,b){b.splice(b.indexOf(a),
1);b.push(a)};e.prototype.arrayToIndex=function(a,b,c){b.splice(b.indexOf(a),1);b.splice(c,0,a)};return e}();h.EightBittr=k})(EightBittr||(EightBittr={}));var FPSAnalyzr;
(function(e){var f=function(){function c(a){void 0===a&&(a={});this.maxKept=a.maxKept||35;this.numRecorded=0;this.ticker=-1;this.measurements=isFinite(this.maxKept)?Array(this.maxKept):{};this.getTimestamp="undefined"===typeof a.getTimestamp?"undefined"===typeof performance?function(){return Date.now()}:(performance.now||performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow).bind(performance):a.getTimestamp}c.prototype.measure=function(a){void 0===a&&(a=this.getTimestamp());this.timeCurrent&&
this.addFPS(1E3/(a-this.timeCurrent));this.timeCurrent=a};c.prototype.addFPS=function(a){this.ticker=(this.ticker+=1)%this.maxKept;this.measurements[this.ticker]=a;this.numRecorded+=1};c.prototype.getMaxKept=function(){return this.maxKept};c.prototype.getNumRecorded=function(){return this.numRecorded};c.prototype.getTimeCurrent=function(){return this.timeCurrent};c.prototype.getTicker=function(){return this.ticker};c.prototype.getMeasurements=function(){var a=Math.min(this.maxKept,this.numRecorded),
b;isFinite(this.maxKept)?b=Array(a):(b={},b.length=a);for(--a;0<=a;--a)b[a]=this.measurements[a];return b};c.prototype.getDifferences=function(){var a=this.getMeasurements(),b;for(b=a.length-1;0<=b;--b)a[b]=1E3/a[b];return a};c.prototype.getAverage=function(){var a=0,b=Math.min(this.maxKept,this.numRecorded),c;for(c=b-1;0<=c;--c)a+=this.measurements[c];return a/b};c.prototype.getMedian=function(){var a=this.getMeasurementsSorted(),b=Math.floor(a.length/2);return 0===a.length%2?a[b]:(a[b-2]+a[b])/
2};c.prototype.getExtremes=function(){var a=this.measurements[0],b=a,c,d;for(d=Math.min(this.maxKept,this.numRecorded)-1;0<=d;--d)c=this.measurements[d],c>b?b=c:c<a&&(a=c);return[a,b]};c.prototype.getRange=function(){var a=this.getExtremes();return a[1]-a[0]};c.prototype.getMeasurementsSorted=function(){var a,b;if(this.measurements.constructor===Array)a=[].slice.call(this.measurements).sort();else{a=[];for(b in this.measurements)this.measurements.hasOwnProperty(b)&&"undefined"!==typeof this.measurements[b]&&
(a[b]=this.measurements[b]);a.sort()}this.numRecorded<this.maxKept&&(a.length=this.numRecorded);return a.sort()};return c}();e.FPSAnalyzr=f})(FPSAnalyzr||(FPSAnalyzr={}));var GamesRunnr;
(function(c){var d=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given GamesRunnr.");if("undefined"===typeof a.games)throw Error("No games given to GamesRunnr.");this.games=a.games;this.interval=a.interval||1E3/60;this.speed=a.speed||1;this.onPause=a.onPause;this.onPlay=a.onPlay;this.callbackArguments=a.callbackArguments||[this];this.adjustFramerate=a.adjustFramerate;this.FPSAnalyzer=a.FPSAnalyzer||new FPSAnalyzr.FPSAnalyzr(a.FPSAnalyzerSettings);this.scope=a.scope||
this;this.paused=!0;this.upkeepScheduler=a.upkeepScheduler||function(a,b){return setTimeout(a,b)};this.upkeepCanceller=a.upkeepCanceller||function(a){clearTimeout(a)};this.upkeepBound=this.upkeep.bind(this);for(a=0;a<this.games.length;a+=1)this.games[a]=this.games[a].bind(this.scope);this.setIntervalReal()}b.prototype.getFPSAnalyzer=function(){return this.FPSAnalyzer};b.prototype.getPaused=function(){return this.paused};b.prototype.getGames=function(){return this.games};b.prototype.getInterval=function(){return this.interval};
b.prototype.getSpeed=function(){return this.speed};b.prototype.getOnPause=function(){return this.onPause};b.prototype.getOnPlay=function(){return this.onPlay};b.prototype.getCallbackArguments=function(){return this.callbackArguments};b.prototype.getUpkeepScheduler=function(){return this.upkeepScheduler};b.prototype.getUpkeepCanceller=function(){return this.upkeepCanceller};b.prototype.upkeep=function(){this.paused||(this.upkeepCanceller(this.upkeepNext),this.adjustFramerate?this.upkeepNext=this.upkeepScheduler(this.upkeepBound,
this.intervalReal-(this.upkeepTimed()|0)):(this.upkeepNext=this.upkeepScheduler(this.upkeepBound,this.intervalReal),this.runAllGames()),this.FPSAnalyzer&&this.FPSAnalyzer.measure())};b.prototype.upkeepTimed=function(){if(!this.FPSAnalyzer)throw Error("An internal FPSAnalyzr is required for upkeepTimed.");var a=this.FPSAnalyzer.getTimestamp();this.runAllGames();return this.FPSAnalyzer.getTimestamp()-a};b.prototype.play=function(){this.paused&&(this.paused=!1,this.onPlay&&this.onPlay.apply(this,this.callbackArguments),
this.upkeep())};b.prototype.pause=function(){this.paused||(this.paused=!0,this.onPause&&this.onPause.apply(this,this.callbackArguments),this.upkeepCanceller(this.upkeepNext))};b.prototype.step=function(a){void 0===a&&(a=1);this.play();this.pause();0<a&&this.step(a-1)};b.prototype.togglePause=function(){this.paused?this.play():this.pause()};b.prototype.setInterval=function(a){var b=Number(a);if(isNaN(b))throw Error("Invalid interval given to setInterval: "+a);this.interval=b;this.setIntervalReal()};
b.prototype.setSpeed=function(a){var b=Number(a);if(isNaN(b))throw Error("Invalid speed given to setSpeed: "+a);this.speed=b;this.setIntervalReal()};b.prototype.setIntervalReal=function(){this.intervalReal=1/this.speed*this.interval};b.prototype.runAllGames=function(){for(var a=0;a<this.games.length;a+=1)this.games[a]()};return b}();c.GamesRunnr=d})(GamesRunnr||(GamesRunnr={}));var __extends=this&&this.__extends||function(k,g){function m(){this.constructor=k}for(var b in g)g.hasOwnProperty(b)&&(k[b]=g[b]);k.prototype=null===g?Object.create(g):(m.prototype=g.prototype,new m)},GameStartr;
(function(k){var g=function(g){function b(a){void 0===a&&(a={});g.call(this,{unitsize:a.unitsize,constantsSource:a.constantsSource,constants:a.constants});this.resets="resetUsageHelper resetObjectMaker resetPixelRender resetTimeHandler resetItemsHolder resetAudioPlayer resetQuadsKeeper resetGamesRunner resetGroupHolder resetThingHitter resetMapScreener resetPixelDrawer resetNumberMaker resetMapsCreator resetAreaSpawner resetInputWriter resetDeviceLayer resetTouchPasser resetLevelEditor resetWorldSeeder resetScenePlayer resetMathDecider resetModAttacher startModAttacher resetContainer".split(" ");a.extraResets&&
this.resets.push.apply(this.resets,a.extraResets);a.resetTimed?this.resetTimed(this,a):this.reset(this,a)}__extends(b,g);b.prototype.reset=function(a,c){g.prototype.reset.call(this,a,a.resets,c)};b.prototype.resetTimed=function(a,c){g.prototype.resetTimed.call(this,a,a.resets,c)};b.prototype.resetUsageHelper=function(a,c){a.UsageHelper=new UsageHelpr.UsageHelpr(a.settings.help)};b.prototype.resetObjectMaker=function(a,c){a.ObjectMaker=new ObjectMakr.ObjectMakr(a.proliferate({properties:{Quadrant:{EightBitter:a,
GameStarter:a},Thing:{EightBitter:a,GameStarter:a}}},a.settings.objects))};b.prototype.resetQuadsKeeper=function(a,c){var d=c.width/(a.settings.quadrants.numCols-3),b=c.height/(a.settings.quadrants.numRows-2);a.QuadsKeeper=new QuadsKeepr.QuadsKeepr(a.proliferate({ObjectMaker:a.ObjectMaker,createCanvas:a.createCanvas,quadrantWidth:d,quadrantHeight:b,startLeft:-d,startHeight:-b,onAdd:a.onAreaSpawn.bind(a,a),onRemove:a.onAreaUnspawn.bind(a,a)},a.settings.quadrants))};b.prototype.resetPixelRender=function(a,
c){a.PixelRender=new PixelRendr.PixelRendr(a.proliferate({scale:a.scale,QuadsKeeper:a.QuadsKeeper,unitsize:a.unitsize},a.settings.sprites))};b.prototype.resetPixelDrawer=function(a,c){a.PixelDrawer=new PixelDrawr.PixelDrawr(a.proliferate({PixelRender:a.PixelRender,MapScreener:a.MapScreener,createCanvas:a.createCanvas,unitsize:a.unitsize,generateObjectKey:a.generateThingKey},a.settings.renderer))};b.prototype.resetTimeHandler=function(a,c){a.TimeHandler=new TimeHandlr.TimeHandlr(a.proliferate({classAdd:a.addClass,
classRemove:a.removeClass},a.settings.events))};b.prototype.resetAudioPlayer=function(a,c){a.AudioPlayer=new AudioPlayr.AudioPlayr(a.proliferate({ItemsHolder:a.ItemsHolder},a.settings.audio))};b.prototype.resetGamesRunner=function(a,c){a.GamesRunner=new GamesRunnr.GamesRunnr(a.proliferate({adjustFramerate:!0,scope:a,onPlay:a.onGamePlay.bind(a,a),onPause:a.onGamePause.bind(a,a),FPSAnalyzer:new FPSAnalyzr.FPSAnalyzr},a.settings.runner));a.FPSAnalyzer=a.GamesRunner.getFPSAnalyzer()};b.prototype.resetItemsHolder=
function(a,c){a.ItemsHolder=new ItemsHoldr.ItemsHoldr(a.proliferate({callbackArgs:[a]},a.settings.items))};b.prototype.resetGroupHolder=function(a,c){a.GroupHolder=new GroupHoldr.GroupHoldr(a.settings.groups)};b.prototype.resetThingHitter=function(a,c){a.ThingHitter=new ThingHittr.ThingHittr(a.proliferate({scope:a},a.settings.collisions))};b.prototype.resetMapScreener=function(a,c){a.MapScreener=new MapScreenr.MapScreenr({EightBitter:a,unitsize:a.unitsize,width:c.width,height:c.height,variableArgs:[a],
variables:a.settings.maps.screenVariables})};b.prototype.resetNumberMaker=function(a,c){a.NumberMaker=new NumberMakr.NumberMakr};b.prototype.resetMapsCreator=function(a,c){a.MapsCreator=new MapsCreatr.MapsCreatr({ObjectMaker:a.ObjectMaker,groupTypes:a.settings.maps.groupTypes,macros:a.settings.maps.macros,entrances:a.settings.maps.entrances,maps:a.settings.maps.library,scope:a})};b.prototype.resetAreaSpawner=function(a,c){a.AreaSpawner=new AreaSpawnr.AreaSpawnr({MapsCreator:a.MapsCreator,MapScreener:a.MapScreener,
screenAttributes:a.settings.maps.screenAttributes,onSpawn:a.settings.maps.onSpawn,onUnspawn:a.settings.maps.onUnspawn,stretchAdd:a.settings.maps.stretchAdd,afterAdd:a.settings.maps.afterAdd,commandScope:a})};b.prototype.resetInputWriter=function(a,c){a.InputWriter=new InputWritr.InputWritr(a.proliferate({canTrigger:a.canInputsTrigger.bind(a,a),eventInformation:a},a.settings.input.InputWritrArgs))};b.prototype.resetDeviceLayer=function(a,c){a.DeviceLayer=new DeviceLayr.DeviceLayr(a.proliferate({InputWriter:a.InputWriter},
a.settings.devices))};b.prototype.resetTouchPasser=function(a,c){a.TouchPasser=new TouchPassr.TouchPassr(a.proliferate({InputWriter:a.InputWriter},a.settings.touch))};b.prototype.resetLevelEditor=function(a,c){a.LevelEditor=new LevelEditr.LevelEditr(a.proliferate({GameStarter:a,beautifier:js_beautify},a.settings.editor))};b.prototype.resetWorldSeeder=function(a,c){a.WorldSeeder=new WorldSeedr.WorldSeedr(a.proliferate({random:a.NumberMaker.random.bind(a.NumberMaker),onPlacement:a.mapPlaceRandomCommands.bind(a,
a)},a.settings.generator))};b.prototype.resetScenePlayer=function(a,c){a.ScenePlayer=new ScenePlayr.ScenePlayr(a.proliferate({cutsceneArguments:[a]},a.settings.scenes))};b.prototype.resetMathDecider=function(a,c){a.MathDecider=new MathDecidr.MathDecidr(a.settings.math)};b.prototype.resetModAttacher=function(a,c){a.ModAttacher=new ModAttachr.ModAttachr(a.proliferate({scopeDefault:a,ItemsHoldr:a.ItemsHolder},a.settings.mods))};b.prototype.startModAttacher=function(a,c){var d=c.mods,b;if(d)for(b in d)d.hasOwnProperty(b)&&
d[b]&&a.ModAttacher.enableMod(b);a.ModAttacher.fireEvent("onReady",a,a)};b.prototype.resetContainer=function(a,c){a.container=a.createElement("div",{className:"EightBitter",style:a.proliferate({position:"relative",width:c.width+"px",height:c.height+"px"},c.style)});a.canvas=a.createCanvas(c.width,c.height);a.PixelDrawer.setCanvas(a.canvas);a.container.appendChild(a.canvas);a.TouchPasser.setParentContainer(a.container)};b.prototype.scrollWindow=function(a,c){var d=b.prototype.ensureCorrectCaller(this);
a|=0;c|=0;if(a||c)d.MapScreener.shift(a,c),d.shiftAll(-a,-c),d.QuadsKeeper.shiftQuadrants(-a,-c)};b.prototype.scrollThing=function(a,c,d){var b=a.left,f=a.top;a.GameStarter.scrollWindow(c,d);a.GameStarter.setLeft(a,b);a.GameStarter.setTop(a,f)};b.prototype.onAreaSpawn=function(a,c,d,b,f,g){a.AreaSpawner.spawnArea(c,(d+a.MapScreener.top)/a.unitsize,(b+a.MapScreener.left)/a.unitsize,(f+a.MapScreener.top)/a.unitsize,(g+a.MapScreener.left)/a.unitsize)};b.prototype.onAreaUnspawn=function(a,c,d,b,f,g){a.AreaSpawner.unspawnArea(c,
(d+a.MapScreener.top)/a.unitsize,(b+a.MapScreener.left)/a.unitsize,(f+a.MapScreener.top)/a.unitsize,(g+a.MapScreener.left)/a.unitsize)};b.prototype.addThing=function(a,c,d){void 0===c&&(c=0);void 0===d&&(d=0);var b;b="string"===typeof a||a instanceof String?this.ObjectMaker.make(a):a.constructor===Array?this.ObjectMaker.make.apply(this.ObjectMaker,a):a;2<arguments.length?(b.GameStarter.setLeft(b,c),b.GameStarter.setTop(b,d)):1<arguments.length&&b.GameStarter.setLeft(b,c);b.GameStarter.updateSize(b);
b.GameStarter.GroupHolder.getFunctions().add[b.groupType](b);b.placed=!0;if(b.onThingAdd)b.onThingAdd(b);b.GameStarter.PixelDrawer.setThingSprite(b);if(b.onThingAdded)b.onThingAdded(b);b.GameStarter.ModAttacher.fireEvent("onAddThing",b,c,d);return b};b.prototype.thingProcess=function(a,c,b,e){var f=4,g,h;a.title=a.title||c;a.width&&!a.spritewidth&&(a.spritewidth=e.spritewidth||e.width);a.height&&!a.spriteheight&&(a.spriteheight=e.spriteheight||e.height);g=Math.floor(a.width*(a.GameStarter.unitsize/
a.GameStarter.QuadsKeeper.getQuadrantWidth()));0<g&&(f+=(g+1)*f/2);g=Math.floor(a.height*a.GameStarter.unitsize/a.GameStarter.QuadsKeeper.getQuadrantHeight());0<g&&(f+=(g+1)*f/2);a.maxquads=f;a.quadrants=Array(f);a.spritewidth=a.spritewidth||a.width;a.spriteheight=a.spriteheight||a.height;a.spritewidthpixels=a.spritewidth*a.GameStarter.unitsize;a.spriteheightpixels=a.spriteheight*a.GameStarter.unitsize;a.canvas=a.GameStarter.createCanvas(a.spritewidthpixels,a.spriteheightpixels);a.context=a.canvas.getContext("2d");
1!==a.opacity&&a.GameStarter.setOpacity(a,a.opacity);a.attributes&&a.GameStarter.thingProcessAttributes(a,a.attributes);if(a.onThingMake)a.onThingMake(a,b);a.GameStarter.setSize(a,a.width,a.height);a.GameStarter.setClassInitial(a,a.name||a.title);(h=a.spriteCycle)&&a.GameStarter.TimeHandler.addClassCycle(a,h[0],h[1]||null,h[2]||null);(h=a.spriteCycleSynched)&&a.GameStarter.TimeHandler.addClassCycleSynched(a,h[0],h[1]||null,h[2]||null);a.flipHoriz&&a.GameStarter.flipHoriz(a);a.flipVert&&a.GameStarter.flipVert(a);
a.GameStarter.ModAttacher.fireEvent("onThingMake",a.GameStarter,a,c,b,e)};b.prototype.thingProcessAttributes=function(a,c){for(var b in c)a[b]&&(a.GameStarter.proliferate(a,c[b]),a.name=a.name?a.name+(" "+b):a.title+" "+b)};b.prototype.mapPlaceRandomCommands=function(a,c){var b=a.MapsCreator,e=a.AreaSpawner,f=e.getPreThings(),g=e.getArea(),e=e.getMap(),h,k,l;for(l=0;l<c.length;l+=1)h=c[l],k={thing:h.title,x:h.left,y:h.top},h.arguments&&a.proliferateHard(k,h.arguments,!0),b.analyzePreSwitch(k,f,g,
e)};b.prototype.onGamePlay=function(a){a.AudioPlayer.resumeAll();a.ModAttacher.fireEvent("onGamePlay")};b.prototype.onGamePause=function(a){a.AudioPlayer.pauseAll();a.ModAttacher.fireEvent("onGamePause")};b.prototype.canInputsTrigger=function(a){return!0};b.prototype.gameStart=function(){this.ModAttacher.fireEvent("onGameStart")};b.prototype.killNormal=function(a){a&&(a.alive=!1,a.hidden=!0,a.movement=void 0)};b.prototype.markChanged=function(a){a.changed=!0};b.prototype.shiftVert=function(a,c,b){EightBittr.EightBittr.prototype.shiftVert(a,
c);b||a.GameStarter.markChanged(a)};b.prototype.shiftHoriz=function(a,c,b){EightBittr.EightBittr.prototype.shiftHoriz(a,c);b||a.GameStarter.markChanged(a)};b.prototype.setTop=function(a,c){EightBittr.EightBittr.prototype.setTop(a,c);a.GameStarter.markChanged(a)};b.prototype.setRight=function(a,c){EightBittr.EightBittr.prototype.setRight(a,c);a.GameStarter.markChanged(a)};b.prototype.setBottom=function(a,c){EightBittr.EightBittr.prototype.setBottom(a,c);a.GameStarter.markChanged(a)};b.prototype.setLeft=
function(a,c){EightBittr.EightBittr.prototype.setLeft(a,c);a.GameStarter.markChanged(a)};b.prototype.shiftBoth=function(a,c,b,e){c=c||0;b=b||0;a.noshiftx||(a.parallaxHoriz?a.GameStarter.shiftHoriz(a,a.parallaxHoriz*c,e):a.GameStarter.shiftHoriz(a,c,e));a.noshifty||(a.parallaxVert?a.GameStarter.shiftVert(a,a.parallaxVert*b,e):a.GameStarter.shiftVert(a,b,e))};b.prototype.shiftThings=function(a,c,b,e){for(var f=a.length-1;0<=f;--f)a[f].GameStarter.shiftBoth(a[f],c,b,e)};b.prototype.shiftAll=function(a,
c){var d=b.prototype.ensureCorrectCaller(this);d.GroupHolder.callAll(d,d.shiftThings,a,c,!0)};b.prototype.setWidth=function(a,c,b,e){a.width=c;a.unitwidth=c*a.GameStarter.unitsize;b&&(a.spritewidth=c,a.spritewidthpixels=c*a.GameStarter.unitsize);e&&a.GameStarter.updateSize(a);a.GameStarter.markChanged(a)};b.prototype.setHeight=function(a,b,d,e){a.height=b;a.unitheight=b*a.GameStarter.unitsize;d&&(a.spriteheight=b,a.spriteheightpixels=b*a.GameStarter.unitsize);e&&a.GameStarter.updateSize(a);a.GameStarter.markChanged(a)};
b.prototype.setSize=function(a,b,d,e,f){a.GameStarter.setWidth(a,b,e,f);a.GameStarter.setHeight(a,d,e,f)};b.prototype.updatePosition=function(a){a.GameStarter.shiftHoriz(a,a.xvel);a.GameStarter.shiftVert(a,a.yvel)};b.prototype.updateSize=function(a){a.unitwidth=a.width*a.GameStarter.unitsize;a.unitheight=a.height*a.GameStarter.unitsize;a.spritewidthpixels=a.spritewidth*a.GameStarter.unitsize;a.spriteheightpixels=a.spriteheight*a.GameStarter.unitsize;a.canvas.width=a.spritewidthpixels;a.canvas.height=
a.spriteheightpixels;a.GameStarter.PixelDrawer.setThingSprite(a);a.GameStarter.markChanged(a)};b.prototype.reduceWidth=function(a,b,d){a.right-=b;a.width-=b/a.GameStarter.unitsize;d?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)};b.prototype.reduceHeight=function(a,b,d){a.top+=b;a.height-=b/a.GameStarter.unitsize;d?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)};b.prototype.increaseWidth=function(a,b,d){a.right+=b;a.width+=b/a.GameStarter.unitsize;a.unitwidth=a.width*a.GameStarter.unitsize;
d?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)};b.prototype.increaseHeight=function(a,b,d){a.top-=b;a.height+=b/a.GameStarter.unitsize;a.unitheight=a.height*a.GameStarter.unitsize;d?a.GameStarter.updateSize(a):a.GameStarter.markChanged(a)};b.prototype.generateThingKey=function(a){return a.groupType+" "+a.title+" "+a.className};b.prototype.setClass=function(a,b){a.className=b;a.GameStarter.PixelDrawer.setThingSprite(a);a.GameStarter.markChanged(a)};b.prototype.setClassInitial=function(a,
b){a.className=b};b.prototype.addClass=function(a,b){a.className+=" "+b;a.GameStarter.PixelDrawer.setThingSprite(a);a.GameStarter.markChanged(a)};b.prototype.addClasses=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];var e,f;for(e=0;e<b.length;e+=1){d=b[e];if(d.constructor===String||"string"===typeof d)d=d.split(" ");for(f=d.length-1;0<=f;--f)a.GameStarter.addClass(a,d[f])}};b.prototype.removeClass=function(a,b){b&&(-1!==b.indexOf(" ")&&a.GameStarter.removeClasses(a,b),a.className=
a.className.replace(new RegExp(" "+b,"gm"),""),a.GameStarter.PixelDrawer.setThingSprite(a))};b.prototype.removeClasses=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];var e,f;for(e=0;e<b.length;e+=1){d=b[e];if(d.constructor===String||"string"===typeof d)d=d.split(" ");for(f=d.length-1;0<=f;--f)a.GameStarter.removeClass(a,d[f])}};b.prototype.hasClass=function(a,b){return-1!==a.className.indexOf(b)};b.prototype.switchClass=function(a,b,d){a.GameStarter.removeClass(a,b);a.GameStarter.addClass(a,
d)};b.prototype.flipHoriz=function(a){a.flipHoriz=!0;a.GameStarter.addClass(a,"flipped")};b.prototype.flipVert=function(a){a.flipVert=!0;a.GameStarter.addClass(a,"flip-vert")};b.prototype.unflipHoriz=function(a){a.flipHoriz=!1;a.GameStarter.removeClass(a,"flipped")};b.prototype.unflipVert=function(a){a.flipVert=!1;a.GameStarter.removeClass(a,"flip-vert")};b.prototype.setOpacity=function(a,b){a.opacity=b;a.GameStarter.markChanged(a)};b.prototype.ensureCorrectCaller=function(a){if(!(a instanceof b))throw Error("A function requires the scope ('this') to be the manipulated GameStartr object. Unfortunately, 'this' is a "+
typeof this+".");return a};b.prototype.arrayDeleteThing=function(a,b,d){void 0===d&&(d=b.indexOf(a));if(-1!==d&&(b.splice(d,1),"function"===typeof a.onDelete))a.onDelete(a)};b.prototype.takeScreenshot=function(a,c){void 0===c&&(c="image/png");var d=b.prototype.ensureCorrectCaller(this);d.createElement("a",{download:a+"."+c.split("/")[1],href:d.canvas.toDataURL(c).replace(c,"image/octet-stream")}).click()};b.prototype.addPageStyles=function(a){var c=b.prototype.ensureCorrectCaller(this).createElement("style",
{type:"text/css"}),d="",e,f;for(e in a)if(a.hasOwnProperty(e)){d+=e+" { \r\n";for(f in a[e])a[e].hasOwnProperty(f)&&(d+="  "+f+": "+a[e][f]+";\r\n");d+="}\r\n"}c.styleSheet?c.style.cssText=d:c.appendChild(document.createTextNode(d));document.querySelector("head").appendChild(c)};return b}(EightBittr.EightBittr);k.GameStartr=g})(GameStartr||(GameStartr={}));var GroupHoldr;
(function(g){var h=function(){function e(a){if("undefined"===typeof a)throw Error("No settings object given to GroupHoldr.");if("undefined"===typeof a.groupNames)throw Error("No groupNames given to GroupHoldr.");if("undefined"===typeof a.groupTypes)throw Error("No groupTypes given to GroupHoldr.");this.functions={setGroup:{},getGroup:{},set:{},get:{},add:{},"delete":{}};this.setGroupNames(a.groupNames,a.groupTypes)}e.prototype.getFunctions=function(){return this.functions};e.prototype.getGroups=function(){return this.groups};
e.prototype.getGroup=function(a){return this.groups[a]};e.prototype.getGroupNames=function(){return this.groupNames};e.prototype.switchMemberGroup=function(a,b,c,d,e){if(this.groups[b].constructor===Array)this.functions["delete"][b](a,d);else this.functions["delete"][b](d);this.functions.add[c](a,e)};e.prototype.applyAll=function(a,b,c){void 0===c&&(c=void 0);var d;c?c.unshift(void 0):c=[void 0];a||(a=this);for(d=this.groupNames.length-1;0<=d;--d)c[0]=this.groups[this.groupNames[d]],b.apply(a,c);
c.shift()};e.prototype.applyOnAll=function(a,b,c){void 0===c&&(c=void 0);var d,e,f;c?c.unshift(void 0):c=[void 0];a||(a=this);for(e=this.groupNames.length-1;0<=e;--e)if(d=this.groups[this.groupNames[e]],d instanceof Array)for(f=0;f<d.length;f+=1)c[0]=d[f],b.apply(a,c);else for(f in d)d.hasOwnProperty(f)&&(c[0]=d[f],b.apply(a,c))};e.prototype.callAll=function(a,b){var c=Array.prototype.slice.call(arguments,1),d;a||(a=this);for(d=this.groupNames.length-1;0<=d;--d)c[0]=this.groups[this.groupNames[d]],
b.apply(a,c)};e.prototype.callOnAll=function(a,b){var c=Array.prototype.slice.call(arguments,1),d,e,f;a||(a=this);for(e=this.groupNames.length-1;0<=e;--e)if(d=this.groups[this.groupNames[e]],d instanceof Array)for(f=0;f<d.length;f+=1)c[0]=d[f],b.apply(a,c);else for(f in d)d.hasOwnProperty(f)&&(c[0]=d[f],b.apply(a,c))};e.prototype.clearArrays=function(){var a,b;for(b=this.groupNames.length-1;0<=b;--b)a=this.groups[this.groupNames[b]],a instanceof Array&&(a.length=0)};e.prototype.setGroupNames=function(a,
b){var c=this,d,e;this.groupNames&&this.clearFunctions();this.groupNames=a;this.groupTypes={};this.groupTypeNames={};b.constructor===Object?this.groupNames.forEach(function(a){c.groupTypes[a]=c.getTypeFunction(b[a]);c.groupTypeNames[a]=c.getTypeName(b[a])}):(d=this.getTypeFunction(b),e=this.getTypeName(b),this.groupNames.forEach(function(a){c.groupTypes[a]=d;c.groupTypeNames[a]=e}));this.setGroups();this.createFunctions()};e.prototype.clearFunctions=function(){this.groupNames.forEach(function(a){delete this["set"+
a+"Group"];delete this["get"+a+"Group"];delete this["set"+a];delete this["get"+a];delete this["add"+a];delete this["delete"+a];this.functions.setGroup={};this.functions.getGroup={};this.functions.set={};this.functions.get={};this.functions.add={};this.functions["delete"]={}})};e.prototype.setGroups=function(){var a=this;this.groups={};this.groupNames.forEach(function(b){a.groups[b]=new a.groupTypes[b]})};e.prototype.createFunctions=function(){var a,b;for(b=0;b<this.groupNames.length;b+=1)a=this.groupNames[b],
this.createFunctionSetGroup(a),this.createFunctionGetGroup(a),this.createFunctionSet(a),this.createFunctionGet(a),this.createFunctionAdd(a),this.createFunctionDelete(a)};e.prototype.createFunctionSetGroup=function(a){var b=this;this.functions.setGroup[a]=this["set"+a+"Group"]=function(c){b.groups[a]=c}};e.prototype.createFunctionGetGroup=function(a){var b=this;this.functions.getGroup[a]=this["get"+a+"Group"]=function(){return b.groups[a]}};e.prototype.createFunctionSet=function(a){this.functions.set[a]=
this["set"+a]=function(b,c){void 0===c&&(c=void 0);this.groups[a][b]=c}};e.prototype.createFunctionGet=function(a){this.functions.get[a]=this["get"+a]=function(b){return this.groups[a][b]}};e.prototype.createFunctionAdd=function(a){var b=this.groups[a];this.functions.add[a]=this.groupTypes[a]===Object?this["add"+a]=function(a,d){b[d]=a}:this["add"+a]=function(a,d){void 0!==d?b[d]=a:b.push(a)}};e.prototype.createFunctionDelete=function(a){var b=this.groups[a];this.functions["delete"][a]=this.groupTypes[a]===
Object?this["delete"+a]=function(a){delete b[a]}:this["delete"+a]=function(a,d){void 0===d&&(d=b.indexOf(a));-1!==d&&b.splice(d,1)}};e.prototype.getTypeName=function(a){return a&&a.charAt&&"o"===a.charAt(0).toLowerCase()?"Object":"Array"};e.prototype.getTypeFunction=function(a){return a&&a.charAt&&"o"===a.charAt(0).toLowerCase()?Object:Array};return e}();g.GroupHoldr=h})(GroupHoldr||(GroupHoldr={}));var InputWritr;
(function(k){var l=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given to InputWritr.");if("undefined"===typeof a.triggers)throw Error("No triggers given to InputWritr.");this.triggers=a.triggers;this.getTimestamp="undefined"===typeof a.getTimestamp?"undefined"===typeof performance?function(){return Date.now()}:(performance.now||performance.webkitNow||performance.mozNow||performance.msNow||performance.oNow).bind(performance):a.getTimestamp;this.eventInformation=a.eventInformation;
this.canTrigger=a.hasOwnProperty("canTrigger")?a.canTrigger:function(){return!0};this.isRecording=a.hasOwnProperty("isRecording")?a.isRecording:function(){return!0};this.currentHistory={};this.histories={};this.aliases={};this.addAliases(a.aliases||{});this.keyAliasesToCodes=a.keyAliasesToCodes||{shift:16,ctrl:17,space:32,left:37,up:38,right:39,down:40};this.keyCodesToAliases=a.keyCodesToAliases||{16:"shift",17:"ctrl",32:"space",37:"left",38:"up",39:"right",40:"down"}}b.prototype.getAliases=function(){return this.aliases};
b.prototype.getAliasesAsKeyStrings=function(){var a={},c;for(c in this.aliases)this.aliases.hasOwnProperty(c)&&(a[c]=this.getAliasAsKeyStrings(c));return a};b.prototype.getAliasAsKeyStrings=function(a){return this.aliases[a].map(this.convertAliasToKeyString.bind(this))};b.prototype.convertAliasToKeyString=function(a){return a.constructor===String?a:96<a&&105>a?String.fromCharCode(a-48):64<a&&97>a?String.fromCharCode(a):"undefined"!==typeof this.keyCodesToAliases[a]?this.keyCodesToAliases[a]:"?"};
b.prototype.convertKeyStringToAlias=function(a){return a.constructor===Number?a:1===a.length?a.charCodeAt(0)-32:"undefined"!==typeof this.keyAliasesToCodes[a]?this.keyAliasesToCodes[a]:-1};b.prototype.getCurrentHistory=function(){return this.currentHistory};b.prototype.getHistory=function(a){return this.histories[a]};b.prototype.getHistories=function(){return this.histories};b.prototype.getCanTrigger=function(){return this.canTrigger};b.prototype.getIsRecording=function(){return this.isRecording};
b.prototype.setCanTrigger=function(a){this.canTrigger=a.constructor===Boolean?function(){return a}:a};b.prototype.setIsRecording=function(a){this.isRecording=a.constructor===Boolean?function(){return a}:a};b.prototype.setEventInformation=function(a){this.eventInformation=a};b.prototype.addAliasValues=function(a,c){var b,e,d;this.aliases.hasOwnProperty(a)?this.aliases[a].push.apply(this.aliases[a],c):this.aliases[a]=c;for(b in this.triggers)if(this.triggers.hasOwnProperty(b)&&(e=this.triggers[b],e.hasOwnProperty(a)))for(d=
0;d<c.length;d+=1)e[c[d]]=e[a]};b.prototype.removeAliasValues=function(a,c){var b,e,d;if(this.aliases.hasOwnProperty(a)){for(d=0;d<c.length;d+=1)this.aliases[a].splice(this.aliases[a].indexOf(c[d],1));for(b in this.triggers)if(this.triggers.hasOwnProperty(b)&&(e=this.triggers[b],e.hasOwnProperty(a)))for(d=0;d<c.length;d+=1)e.hasOwnProperty(c[d])&&delete e[c[d]]}};b.prototype.switchAliasValues=function(a,c,b){this.removeAliasValues(a,c);this.addAliasValues(a,b)};b.prototype.addAliases=function(a){for(var c in a)a.hasOwnProperty(c)&&
this.addAliasValues(c,a[c])};b.prototype.addEvent=function(a,c,b){var e;if(!this.triggers.hasOwnProperty(a))throw Error("Unknown trigger requested: '"+a+"'.");this.triggers[a][c]=b;if(this.aliases.hasOwnProperty(c))for(e=0;e<this.aliases[c].length;e+=1)this.triggers[a][this.aliases[c][e]]=b};b.prototype.removeEvent=function(a,c){var b;if(!this.triggers.hasOwnProperty(a))throw Error("Unknown trigger requested: '"+a+"'.");delete this.triggers[a][c];if(this.aliases.hasOwnProperty(c))for(b=0;b<this.aliases[c].length;b+=
1)this.triggers[a][this.aliases[c][b]]&&delete this.triggers[a][this.aliases[c][b]]};b.prototype.saveHistory=function(a){void 0===a&&(a=Object.keys(this.histories).length.toString());this.histories[a]=this.currentHistory};b.prototype.restartHistory=function(a){void 0===a&&(a=!0);a&&this.saveHistory();this.currentHistory={};this.startingTime=this.getTimestamp()};b.prototype.playHistory=function(a){for(var b in a)a.hasOwnProperty(b)&&setTimeout(this.makeEventCall(a[b]),Number(b)-this.startingTime|0)};
b.prototype.callEvent=function(a,b,f){if(!a)throw Error("Blank event given to InputWritr.");if(this.canTrigger(a,b,f))return a.constructor===String&&(a=this.triggers[a][b]),a(this.eventInformation,f)};b.prototype.makePipe=function(a,b,f){var e=this,d=this.triggers[a];if(!d)throw Error("No trigger of label '"+a+"' defined.");return function(g){var h=g[b];f&&g.preventDefault instanceof Function&&g.preventDefault();d.hasOwnProperty(h)&&(e.isRecording()&&e.saveEventInformation([a,h]),e.callEvent(d[h],
h,g))}};b.prototype.makeEventCall=function(a){var b=this;return function(){b.callEvent(a[0],a[1]);b.isRecording()&&b.saveEventInformation(a)}};b.prototype.saveEventInformation=function(a){this.currentHistory[this.getTimestamp()|0]=a};return b}();k.InputWritr=l})(InputWritr||(InputWritr={}));var ItemsHoldr;
(function(h){var k=function(){function b(a,g,b){void 0===b&&(b={});this.ItemsHolder=a;a.proliferate(this,a.getDefaults());a.proliferate(this,b);this.key=g;this.hasOwnProperty("value")||(this.value=this.valueDefault);this.hasElement&&(this.element=a.createElement(this.elementTag||"div",{className:a.getPrefix()+"_value "+g}),this.element.appendChild(a.createElement("div",{textContent:g})),this.element.appendChild(a.createElement("div",{textContent:this.value})));this.storeLocally&&(a.getLocalStorage().hasOwnProperty(a.getPrefix()+g)?
(this.value=this.retrieveLocalStorage(),this.update()):this.updateLocalStorage())}b.prototype.getValue=function(){return this.transformGet?this.transformGet(this.value):this.value};b.prototype.setValue=function(a){this.value=this.transformSet?this.transformSet(a):a;this.update()};b.prototype.update=function(){this.hasOwnProperty("minimum")&&Number(this.value)<=Number(this.minimum)?(this.value=this.minimum,this.onMinimum&&this.onMinimum.apply(this,this.ItemsHolder.getCallbackArgs())):this.hasOwnProperty("maximum")&&
Number(this.value)<=Number(this.maximum)&&(this.value=this.maximum,this.onMaximum&&this.onMaximum.apply(this,this.ItemsHolder.getCallbackArgs()));this.modularity&&this.checkModularity();this.triggers&&this.checkTriggers();this.hasElement&&this.updateElement();this.storeLocally&&this.updateLocalStorage()};b.prototype.updateLocalStorage=function(a){if(a||this.ItemsHolder.getAutoSave())this.ItemsHolder.getLocalStorage()[this.ItemsHolder.getPrefix()+this.key]=JSON.stringify(this.value)};b.prototype.checkTriggers=
function(){this.triggers.hasOwnProperty(this.value)&&this.triggers[this.value].apply(this,this.ItemsHolder.getCallbackArgs())};b.prototype.checkModularity=function(){if(this.value.constructor===Number&&this.modularity)for(;this.value>=this.modularity;)this.value=Math.max(0,this.value-this.modularity),this.onModular&&this.onModular.apply(this,this.ItemsHolder.getCallbackArgs())};b.prototype.updateElement=function(){this.ItemsHolder.hasDisplayChange(this.value)?this.element.children[1].textContent=
this.ItemsHolder.getDisplayChange(this.value):this.element.children[1].textContent=this.value};b.prototype.retrieveLocalStorage=function(){var a=localStorage.getItem(this.ItemsHolder.getPrefix()+this.key);return"undefined"===a?void 0:a.constructor!==String?a:JSON.parse(a)};return b}();h.ItemValue=k;var l=function(){function b(a){void 0===a&&(a={});var b;this.prefix=a.prefix||"";this.autoSave=a.autoSave;this.callbackArgs=a.callbackArgs||[];this.allowNewItems=void 0===a.allowNewItems?!0:a.allowNewItems;
this.localStorage=a.localStorage?a.localStorage:"undefined"===typeof localStorage?this.createPlaceholderStorage():localStorage;this.defaults=a.defaults||{};this.displayChanges=a.displayChanges||{};this.items={};if(a.values)for(b in this.itemKeys=Object.keys(a.values),a.values)a.values.hasOwnProperty(b)&&this.addItem(b,a.values[b]);else this.itemKeys=[];a.doMakeContainer&&(this.containersArguments=a.containersArguments||[["div",{className:this.prefix+"_container"}]],this.container=this.makeContainer(a.containersArguments))}
b.prototype.key=function(a){return this.itemKeys[a]};b.prototype.getValues=function(){return this.items};b.prototype.getDefaults=function(){return this.defaults};b.prototype.getLocalStorage=function(){return this.localStorage};b.prototype.getAutoSave=function(){return this.autoSave};b.prototype.getPrefix=function(){return this.prefix};b.prototype.getContainer=function(){return this.container};b.prototype.getContainersArguments=function(){return this.containersArguments};b.prototype.getDisplayChanges=
function(){return this.displayChanges};b.prototype.getCallbackArgs=function(){return this.callbackArgs};b.prototype.getKeys=function(){return Object.keys(this.items)};b.prototype.getItem=function(a){this.checkExistence(a);return this.items[a].getValue()};b.prototype.getObject=function(a){return this.items[a]};b.prototype.hasKey=function(a){return this.items.hasOwnProperty(a)};b.prototype.exportItems=function(){var a={},b;for(b in this.items)this.items.hasOwnProperty(b)&&(a[b]=this.items[b].getValue());
return a};b.prototype.addItem=function(a,b){void 0===b&&(b={});this.items[a]=new k(this,a,b);this.itemKeys.push(a);return this.items[a]};b.prototype.removeItem=function(a){this.items.hasOwnProperty(a)&&(this.container&&this.items[a].hasElement&&this.container.removeChild(this.items[a].element),this.itemKeys.splice(this.itemKeys.indexOf(a),1),delete this.items[a])};b.prototype.clear=function(){var a;if(this.container)for(a in this.items)this.items[a].hasElement&&this.container.removeChild(this.items[a].element);
this.items={};this.itemKeys=[]};b.prototype.setItem=function(a,b){this.checkExistence(a);this.items[a].setValue(b)};b.prototype.increase=function(a,b){void 0===b&&(b=1);this.checkExistence(a);var e=this.items[a].getValue();this.items[a].setValue(e+b)};b.prototype.decrease=function(a,b){void 0===b&&(b=1);this.checkExistence(a);var e=this.items[a].getValue();this.items[a].setValue(e-b)};b.prototype.toggle=function(a){this.checkExistence(a);var b=this.items[a].getValue();this.items[a].setValue(b?!1:
!0)};b.prototype.checkExistence=function(a){if(!this.items.hasOwnProperty(a))if(this.allowNewItems)this.addItem(a);else throw Error("Unknown key given to ItemsHoldr: '"+a+"'.");};b.prototype.saveItem=function(a){if(!this.items.hasOwnProperty(a))throw Error("Unknown key given to ItemsHoldr: '"+a+"'.");this.items[a].updateLocalStorage(!0)};b.prototype.saveAll=function(){for(var a in this.items)this.items.hasOwnProperty(a)&&this.items[a].updateLocalStorage(!0)};b.prototype.hideContainer=function(){this.container.style.visibility=
"hidden"};b.prototype.displayContainer=function(){this.container.style.visibility="visible"};b.prototype.makeContainer=function(a){var b=this.createElement.apply(this,a[0]),e=b,c,d,f;for(f=1;f<a.length;++f)c=this.createElement.apply(this,a[f]),e.appendChild(c),e=c;for(d in this.items)this.items[d].hasElement&&c.appendChild(this.items[d].element);return b};b.prototype.hasDisplayChange=function(a){return this.displayChanges.hasOwnProperty(a)};b.prototype.getDisplayChange=function(a){return this.displayChanges[a]};
b.prototype.createElement=function(a){void 0===a&&(a="div");for(var b=[],e=1;e<arguments.length;e++)b[e-1]=arguments[e];var e=document.createElement(a),c;for(c=0;c<b.length;c+=1)this.proliferateElement(e,b[c]);return e};b.prototype.proliferate=function(a,b,e){var c,d;for(d in b)!b.hasOwnProperty(d)||e&&a.hasOwnProperty(d)||(c=b[d],"object"===typeof c?(a.hasOwnProperty(d)||(a[d]=new c.constructor),this.proliferate(a[d],c,e)):a[d]=c);return a};b.prototype.proliferateElement=function(a,b,e){var c,d,
f;for(d in b)if(b.hasOwnProperty(d)&&(!e||!a.hasOwnProperty(d)))switch(c=b[d],d){case "children":if("undefined"!==typeof c)for(f=0;f<c.length;f+=1)a.appendChild(c[f]);break;case "style":this.proliferate(a[d],c);break;default:"object"===typeof c?(a.hasOwnProperty(d)||(a[d]=new c.constructor),this.proliferate(a[d],c,e)):a[d]=c}return a};b.prototype.createPlaceholderStorage=function(){var a,b={keys:[],getItem:function(a){return this.localStorage[a]},setItem:function(a,b){this.localStorage[a]=b},clear:function(){for(a in this)this.hasOwnProperty(a)&&
delete this[a]},removeItem:function(a){delete this[a]},key:function(a){return this.keys[a]}};Object.defineProperties(b,{length:{get:function(){return b.keys.length}},remainingSpace:{get:function(){return 9001}}});return b};return b}();h.ItemsHoldr=l})(ItemsHoldr||(ItemsHoldr={}));(function(){function C(v,e){return(new ca(v,e)).beautify()}function ca(v,e){function C(a,c){var b=0;a&&(b=a.indentation_level,!H()&&a.lineIndent_level>b&&(b=a.lineIndent_level));return{mode:c,parent:a,last_text:a?a.last_text:"",last_word:a?a.last_word:"",declaration_statement:!1,declaration_assignment:!1,in_html_comment:!1,multiline_frame:!1,if_block:!1,else_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:b,lineIndent_level:a?a.lineIndent_level:b,start_lineIndex:q.length,
had_comment:!1,ternary_depth:0}}function y(a){a=void 0===a?!1:a;if(q.length)for(U(q[q.length-1]);a&&1<q.length&&0===q[q.length-1].text.length;)q.pop(),U(q[q.length-1])}function U(a){for(;a.text.length&&(" "===a.text[a.text.length-1]||a.text[a.text.length-1]===D||a.text[a.text.length-1]===I);)a.text.pop()}function R(a){return a.replace(/^\s+|\s+$/g,"")}function H(){return 0===q[q.length-1].text.length}function F(a){a=void 0===a?!1:a;if(k.wrap_line_length&&!a){var c=q[q.length-1],b=0;0<c.text.length&&
(b=c.text.join("").length+f.length+(g?1:0),b>=k.wrap_line_length&&(a=!0))}(k.preserve_newlines&&E||a)&&!H()&&h(!1,!0)}function h(m,c){g=!1;if(!c&&";"!==a.last_text&&","!==a.last_text&&"="!==a.last_text&&"TK_OPERATOR"!==d)for(;a.mode===l.Statement&&!a.if_block&&!a.do_block;)A();if(1!==q.length||!H())if(m||!H())a.multiline_frame=!0,q.push({text:[]})}function r(m){m=m||f;if(H()){var c=q[q.length-1];if(k.keep_arrayIndentation&&a.mode===l.ArrayLiteral&&E){c.text.push("");for(var b=0;b<G.length;b+=1)c.text.push(G[b])}else if(I&&
c.text.push(I),c=a.indentation_level,1<q.length){b=q[q.length-1];a.lineIndent_level=c;for(var d=0;d<c;d+=1)b.text.push(D)}}c=q[q.length-1];g&&c.text.length&&(b=c.text[c.text.length-1]," "!==b&&b!==D&&c.text.push(" "));g=!1;q[q.length-1].text.push(m)}function V(a){if(!a.multiline_frame){a=a.start_lineIndex;for(var c=0,b;a<q.length;)b=q[a],a++,0!==b.text.length&&(c=I&&b.text[0]===I?1:0,b.text[c]===D&&b.text.splice(c,1))}}function M(b){a?(P.push(a),w=a):w=C(null,b);a=C(w,b)}function N(a){return t(a,
[l.Expression,l.ForInitializer,l.Conditional])}function A(){0<P.length&&(w=a,a=P.pop(),w.mode===l.Statement&&V(w))}function Q(){return a.parent.mode===l.ObjectLiteral&&a.mode===l.Statement&&":"===a.last_text&&0===a.ternary_depth}function J(){return"TK_RESERVED"===d&&t(a.last_text,["var","let","const"])&&"TK_WORD"===p||"TK_RESERVED"===d&&"do"===a.last_text||"TK_RESERVED"===d&&"return"===a.last_text&&!E||"TK_RESERVED"===d&&"else"===a.last_text&&("TK_RESERVED"!==p||"if"!==f)||"TK_END_EXPR"===d&&(w.mode===
l.ForInitializer||w.mode===l.Conditional)||"TK_WORD"===d&&a.mode===l.BlockStatement&&!a.in_case&&"--"!==f&&"++"!==f&&"TK_WORD"!==p&&"TK_RESERVED"!==p||a.mode===l.ObjectLiteral&&":"===a.last_text&&0===a.ternary_depth?(M(l.Statement),a.indentation_level+=1,"TK_RESERVED"===d&&t(a.last_text,["var","let","const"])&&"TK_WORD"===p&&(a.declaration_statement=!0),Q()||F("TK_RESERVED"===p&&t(f,["do","for","if","while"])),!0):!1}function O(a){return t(a,"case return do if throw else".split(" "))}function t(a,
b){for(var d=0;d<b.length;d+=1)if(b[d]===a)return!0;return!1}function W(){var m;z=0;if(b>=u)return["","TK_EOF"];E=!1;G=[];var c=n.charAt(b);for(b+=1;t(c,S);){"\n"===c?(z+=1,G=[]):z&&(c===D?G.push(D):"\r"!==c&&G.push(" "));if(b>=u)return["","TK_EOF"];c=n.charAt(b);b+=1}if(T.isIdentifierChar(n.charCodeAt(b-1))){if(b<u)for(;T.isIdentifierChar(n.charCodeAt(b))&&(c+=n.charAt(b),b+=1,b!==u););if(b!==u&&c.match(/^[0-9]+[Ee]$/)&&("-"===n.charAt(b)||"+"===n.charAt(b))){var f=n.charAt(b);b+=1;var e=W(),c=c+
(f+e[0]);return[c,"TK_WORD"]}return"TK_DOT"===d||"TK_RESERVED"===d&&t(a.last_text,["set","get"])||!t(c,X)?[c,"TK_WORD"]:"in"===c?[c,"TK_OPERATOR"]:[c,"TK_RESERVED"]}if("("===c||"["===c)return[c,"TK_START_EXPR"];if(")"===c||"]"===c)return[c,"TK_END_EXPR"];if("{"===c)return[c,"TK_START_BLOCK"];if("}"===c)return[c,"TK_END_BLOCK"];if(";"===c)return[c,"TK_SEMICOLON"];if("/"===c){f="";e=!0;if("*"===n.charAt(b)){b+=1;if(b<u)for(;b<u&&("*"!==n.charAt(b)||!n.charAt(b+1)||"/"!==n.charAt(b+1));){c=n.charAt(b);
f+=c;if("\n"===c||"\r"===c)e=!1;b+=1;if(b>=u)break}b+=2;return e&&0===z?["/*"+f+"*/","TKInLINE_COMMENT"]:["/*"+f+"*/","TK_BLOCK_COMMENT"]}if("/"===n.charAt(b)){for(f=c;"\r"!==n.charAt(b)&&"\n"!==n.charAt(b)&&!(f+=n.charAt(b),b+=1,b>=u););return[f,"TK_COMMENT"]}}if("`"===c||"'"===c||'"'===c||("/"===c||k.e4x&&"<"===c&&n.slice(b-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&("TK_RESERVED"===d&&O(a.last_text)||"TK_END_EXPR"===
d&&t(w.mode,[l.Conditional,l.ForInitializer])||t(d,"TK_COMMENT TK_START_EXPR TK_START_BLOCK TK_END_BLOCK TK_OPERATOR TK_EQUALS TK_EOF TK_SEMICOLON TK_COMMA".split(" ")))){var f=c,g=e=!1;m=c;if(b<u)if("/"===f)for(c=!1;e||c||n.charAt(b)!==f;){if(m+=n.charAt(b),e?e=!1:(e="\\"===n.charAt(b),"["===n.charAt(b)?c=!0:"]"===n.charAt(b)&&(c=!1)),b+=1,b>=u)return[m,"TK_STRING"]}else if(k.e4x&&"<"===f){var e=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,
c=n.slice(b-1),h=e.exec(c);if(h&&0===h.index){f=h[2];for(m=0;h;){var g=!!h[1],p=h[2],r=!!h[h.length-1]||"![CDATA["===p.slice(0,8);p!==f||r||(g?--m:++m);if(0>=m)break;h=e.exec(c)}f=h?h.index+h[0].length:c.length;b+=f-1;return[c.slice(0,f),"TK_STRING"]}}else for(;e||n.charAt(b)!==f;){m+=n.charAt(b);if(e){if("x"===n.charAt(b)||"u"===n.charAt(b))g=!0;e=!1}else e="\\"===n.charAt(b);b+=1;if(b>=u)return[m,"TK_STRING"]}b+=1;m+=f;if(g&&k.unescape_strings)a:{c=m;e=!1;h="";m=0;g="";for(p=0;e||m<c.length;)if(r=
c.charAt(m),m++,e){e=!1;if("x"===r)g=c.substr(m,2),m+=2;else if("u"===r)g=c.substr(m,4),m+=4;else{h+="\\"+r;continue}if(!g.match(/^[0123456789abcdefABCDEF]+$/)){m=c;break a}p=parseInt(g,16);if(0<=p&&32>p)h="x"===r?h+("\\x"+g):h+("\\u"+g);else if(34===p||39===p||92===p)h+="\\"+String.fromCharCode(p);else if("x"===r&&126<p&&255>=p){m=c;break a}else h+=String.fromCharCode(p)}else"\\"===r?e=!0:h+=r;m=h}if("/"===f)for(;b<u&&t(n.charAt(b),Y);)m+=n.charAt(b),b+=1;return[m,"TK_STRING"]}if("#"===c){if(1===
q.length&&0===q[0].text.length&&"!"===n.charAt(b)){for(m=c;b<u&&"\n"!==c;)c=n.charAt(b),m+=c,b+=1;return[R(m)+"\n","TK_UNKNOWN"]}f="#";if(b<u&&t(n.charAt(b),Z)){do c=n.charAt(b),f+=c,b+=1;while(b<u&&"#"!==c&&"="!==c);"#"!==c&&("["===n.charAt(b)&&"]"===n.charAt(b+1)?(f+="[]",b+=2):"{"===n.charAt(b)&&"}"===n.charAt(b+1)&&(f+="{}",b+=2));return[f,"TK_WORD"]}}if("<"===c&&"\x3c!--"===n.substring(b-1,b+3)){b+=3;for(c="\x3c!--";"\n"!==n.charAt(b)&&b<u;)c+=n.charAt(b),b++;a.in_html_comment=!0;return[c,"TK_COMMENT"]}if("-"===
c&&a.in_html_comment&&"--\x3e"===n.substring(b-1,b+2))return a.in_html_comment=!1,b+=2,["--\x3e","TK_COMMENT"];if("."===c)return[c,"TK_DOT"];if(t(c,K)){for(;b<u&&t(c+n.charAt(b),K)&&!(c+=n.charAt(b),b+=1,b>=u););return","===c?[c,"TK_COMMA"]:"="===c?[c,"TK_EQUALS"]:[c,"TK_OPERATOR"]}return[c,"TK_UNKNOWN"]}function aa(){J()||!E||N(a.mode)||"TK_OPERATOR"===d&&"--"!==a.last_text&&"++"!==a.last_text||"TK_EQUALS"===d||!k.preserve_newlines&&"TK_RESERVED"===d&&t(a.last_text,["var","let","const","set","get"])||
h();if(a.do_block&&!a.do_while){if("TK_RESERVED"===p&&"while"===f){g=!0;r();g=!0;a.do_while=!0;return}h();a.do_block=!1}if(a.if_block)if(a.else_block||"TK_RESERVED"!==p||"else"!==f){for(;a.mode===l.Statement;)A();a.if_block=!1;a.else_block=!1}else a.else_block=!0;if("TK_RESERVED"===p&&("case"===f||"default"===f&&a.in_case_statement)){h();if(a.case_body||k.jslint_happy)0<a.indentation_level&&(!a.parent||a.indentation_level>a.parent.indentation_level)&&--a.indentation_level,a.case_body=!1;r();a.in_case=
!0;a.in_case_statement=!0}else{"TK_RESERVED"===p&&"function"===f&&(!(t(a.last_text,["}",";"])||H()&&!t(a.last_text,["[","{",":","=",","]))||H()&&(1===q.length||0===q[q.length-2].text.length)||a.had_comment||(h(),h(!0)),"TK_RESERVED"===d||"TK_WORD"===d?"TK_RESERVED"===d&&t(a.last_text,["get","set","new","return"])?g=!0:h():"TK_OPERATOR"===d||"="===a.last_text?g=!0:N(a.mode)||h());if("TK_COMMA"===d||"TK_START_EXPR"===d||"TK_EQUALS"===d||"TK_OPERATOR"===d)Q()||F();if("TK_RESERVED"===p&&"function"===
f)r(),a.last_word=f;else{x="NONE";"TK_END_BLOCK"===d?"TK_RESERVED"===p&&t(f,["else","catch","finally"])?"expand"===k.brace_style||"end-expand"===k.brace_style?x="NEWLINE":(x="SPACE",g=!0):x="NEWLINE":"TK_SEMICOLON"===d&&a.mode===l.BlockStatement?x="NEWLINE":"TK_SEMICOLON"===d&&N(a.mode)?x="SPACE":"TK_STRING"===d?x="NEWLINE":"TK_RESERVED"===d||"TK_WORD"===d||"*"===a.last_text&&"function"===B?x="SPACE":"TK_START_BLOCK"===d?x="NEWLINE":"TK_END_EXPR"===d&&(g=!0,x="NEWLINE");"TK_RESERVED"===p&&t(f,L)&&
")"!==a.last_text&&(x="else"===a.last_text?"SPACE":"NEWLINE");if("TK_RESERVED"===p&&t(f,["else","catch","finally"]))if("TK_END_BLOCK"!==d||"expand"===k.brace_style||"end-expand"===k.brace_style)h();else{y(!0);var b=q[q.length-1];"}"!==b.text[b.text.length-1]&&h();g=!0}else"NEWLINE"===x?"TK_RESERVED"===d&&O(a.last_text)?g=!0:"TK_END_EXPR"!==d?"TK_START_EXPR"===d&&"TK_RESERVED"===p&&t(f,["var","let","const"])||":"===a.last_text||("TK_RESERVED"===p&&"if"===f&&"else"===a.last_word&&"{"!==a.last_text?
g=!0:h()):"TK_RESERVED"===p&&t(f,L)&&")"!==a.last_text&&h():a.mode===l.ArrayLiteral&&","===a.last_text&&"}"===B?h():"SPACE"===x&&(g=!0);r();a.last_word=f;"TK_RESERVED"===p&&"do"===f&&(a.do_block=!0);"TK_RESERVED"===p&&"if"===f&&(a.if_block=!0)}}}var n,q,f,p,d,B,D,a,w,P,S,Y,K,b,L,X,Z,x,E,g,u,z,G,ba,l,k,I="";S=["\n","\r","\t"," "];Y="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");Z="0123456789".split("");K="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! ~ , : ? ^ ^= |= :: =>";
K+=" <%= <% %> <?= <? ?>";K=K.split(" ");L="continue try throw return var let const if switch case default for while break function yield".split(" ");X=L.concat("do in else get set new catch finally typeof".split(" "));l={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"};ba={TK_START_EXPR:function(){J();var b=l.Expression;if("["===f){if("TK_WORD"===d||")"===
a.last_text){"TK_RESERVED"===d&&t(a.last_text,L)&&(g=!0);M(b);r();a.indentation_level+=1;k.spaceIn_paren&&(g=!0);return}b=l.ArrayLiteral;a.mode!==l.ArrayLiteral||"["!==a.last_text&&(","!==a.last_text||"]"!==B&&"}"!==B)||k.keep_arrayIndentation||h()}else"TK_RESERVED"===d&&"for"===a.last_text?b=l.ForInitializer:"TK_RESERVED"===d&&t(a.last_text,["if","while"])&&(b=l.Conditional);";"===a.last_text||"TK_START_BLOCK"===d?h():"TK_END_EXPR"===d||"TK_START_EXPR"===d||"TK_END_BLOCK"===d||"."===a.last_text?
F(E):"TK_RESERVED"===d&&"("===f||"TK_WORD"===d||"TK_OPERATOR"===d?"TK_RESERVED"===d&&("function"===a.last_word||"typeof"===a.last_word)||"*"===a.last_text&&"function"===B?k.jslint_happy&&(g=!0):"TK_RESERVED"!==d||!t(a.last_text,L)&&"catch"!==a.last_text||k.space_before_conditional&&(g=!0):g=!0;"("!==f||"TK_EQUALS"!==d&&"TK_OPERATOR"!==d||Q()||F();M(b);r();k.spaceIn_paren&&(g=!0);a.indentation_level+=1},TK_END_EXPR:function(){for(;a.mode===l.Statement;)A();a.multiline_frame&&F("]"===f&&a.mode===l.ArrayLiteral&&
!k.keep_arrayIndentation);k.spaceIn_paren&&("TK_START_EXPR"!==d||k.spaceIn_empty_paren?g=!0:(y(),g=!1));"]"===f&&k.keep_arrayIndentation?(r(),A()):(A(),r());V(w);a.do_while&&w.mode===l.Conditional&&(w.mode=l.Expression,a.do_block=!1,a.do_while=!1)},TK_START_BLOCK:function(){M(l.BlockStatement);var m;a:{m=b;for(var c=n.charAt(m);t(c,S)&&"}"!==c;){m++;if(m>=u){m=!1;break a}c=n.charAt(m)}m="}"===c}m=m&&"function"===a.last_word&&"TK_END_EXPR"===d;"expand"===k.brace_style?"TK_OPERATOR"!==d&&(m||"TK_EQUALS"===
d||"TK_RESERVED"===d&&O(a.last_text)&&"else"!==a.last_text)?g=!0:h(!1,!0):"TK_OPERATOR"!==d&&"TK_START_EXPR"!==d?"TK_START_BLOCK"===d?h():g=!0:w.mode===l.ArrayLiteral&&","===a.last_text&&("}"===B?g=!0:h());r();a.indentation_level+=1},TK_END_BLOCK:function(){for(;a.mode===l.Statement;)A();var b="TK_START_BLOCK"===d;"expand"===k.brace_style?b||h():b||(a.mode===l.ArrayLiteral&&k.keep_arrayIndentation?(k.keep_arrayIndentation=!1,h(),k.keep_arrayIndentation=!0):h());A();r()},TK_WORD:aa,TK_RESERVED:aa,
TK_SEMICOLON:function(){for(J()&&(g=!1);a.mode===l.Statement&&!a.if_block&&!a.do_block;)A();r();a.mode===l.ObjectLiteral&&(a.mode=l.BlockStatement)},TK_STRING:function(){J()?g=!0:"TK_RESERVED"===d||"TK_WORD"===d?g=!0:"TK_COMMA"===d||"TK_START_EXPR"===d||"TK_EQUALS"===d||"TK_OPERATOR"===d?Q()||F():h();r()},TK_EQUALS:function(){J();a.declaration_statement&&(a.declaration_assignment=!0);g=!0;r();g=!0},TK_OPERATOR:function(){":"!==f||a.mode!==l.BlockStatement||"{"!==B||"TK_WORD"!==d&&"TK_RESERVED"!==
d||(a.mode=l.ObjectLiteral);J();var b=!0,c=!0;if("TK_RESERVED"===d&&O(a.last_text))g=!0,r();else if("*"!==f||"TK_DOT"!==d||B.match(/^\d+$/))if(":"===f&&a.in_case)a.case_body=!0,a.indentation_level+=1,r(),h(),a.in_case=!1;else if("::"===f)r();else{!E||"--"!==f&&"++"!==f||h(!1,!0);"TK_OPERATOR"===d&&F();if(t(f,["--","++","!","~"])||t(f,["-","+"])&&(t(d,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||t(a.last_text,L)||","===a.last_text)){c=b=!1;";"===a.last_text&&N(a.mode)&&(b=!0);if("TK_RESERVED"===
d||"TK_END_EXPR"===d)b=!0;a.mode!==l.BlockStatement&&a.mode!==l.Statement||"{"!==a.last_text&&";"!==a.last_text||h()}else":"===f?0===a.ternary_depth?(a.mode===l.BlockStatement&&(a.mode=l.ObjectLiteral),b=!1):--a.ternary_depth:"?"===f?a.ternary_depth+=1:"*"===f&&"TK_RESERVED"===d&&"function"===a.last_text&&(c=b=!1);g=g||b;r();g=c}else r()},TK_COMMA:function(){a.declaration_statement?(N(a.parent.mode)&&(a.declaration_assignment=!1),r(),a.declaration_assignment?(a.declaration_assignment=!1,h(!1,!0)):
g=!0):(r(),a.mode===l.ObjectLiteral||a.mode===l.Statement&&a.parent.mode===l.ObjectLiteral?(a.mode===l.Statement&&A(),h()):g=!0)},TK_BLOCK_COMMENT:function(){for(var a=f,a=a.replace(/\x0d/g,""),b=[],d=a.indexOf("\n");-1!==d;)b.push(a.substring(0,d)),a=a.substring(d+1),d=a.indexOf("\n");a.length&&b.push(a);var e,d=a=!1;e=G.join("");var k=e.length;h(!1,!0);if(1<b.length){var g;a:{g=b.slice(1);for(var l=0;l<g.length;l++)if("*"!==R(g[l]).charAt(0)){g=!1;break a}g=!0}if(g)a=!0;else{a:{g=b.slice(1);for(var l=
0,n=g.length,p;l<n;l++)if((p=g[l])&&0!==p.indexOf(e)){e=!1;break a}e=!0}e&&(d=!0)}}r(b[0]);for(e=1;e<b.length;e++)h(!1,!0),a?r(" "+R(b[e])):d&&b[e].length>k?r(b[e].substring(k)):q[q.length-1].text.push(b[e]);h(!1,!0)},TKInLINE_COMMENT:function(){g=!0;r();g=!0},TK_COMMENT:function(){E?h(!1,!0):y(!0);g=!0;r();h(!1,!0)},TK_DOT:function(){J();"TK_RESERVED"===d&&O(a.last_text)?g=!0:F(")"===a.last_text&&k.break_chained_methods);r()},TK_UNKNOWN:function(){r();"\n"===f[f.length-1]&&h()}};e=e?e:{};k={};void 0!==
e.spaceAfter_anon_function&&void 0===e.jslint_happy&&(e.jslint_happy=e.spaceAfter_anon_function);void 0!==e.braces_on_own_line&&(k.brace_style=e.braces_on_own_line?"expand":"collapse");k.brace_style=e.brace_style?e.brace_style:k.brace_style?k.brace_style:"collapse";"expand-strict"===k.brace_style&&(k.brace_style="expand");k.indent_size=e.indent_size?parseInt(e.indent_size,10):4;k.indent_char=e.indent_char?e.indent_char:" ";k.preserve_newlines=void 0===e.preserve_newlines?!0:e.preserve_newlines;k.break_chained_methods=
void 0===e.break_chained_methods?!1:e.break_chained_methods;k.max_preserve_newlines=void 0===e.max_preserve_newlines?0:parseInt(e.max_preserve_newlines,10);k.spaceIn_paren=void 0===e.spaceIn_paren?!1:e.spaceIn_paren;k.spaceIn_empty_paren=void 0===e.spaceIn_empty_paren?!1:e.spaceIn_empty_paren;k.jslint_happy=void 0===e.jslint_happy?!1:e.jslint_happy;k.keep_arrayIndentation=void 0===e.keep_arrayIndentation?!1:e.keep_arrayIndentation;k.space_before_conditional=void 0===e.space_before_conditional?!0:
e.space_before_conditional;k.unescape_strings=void 0===e.unescape_strings?!1:e.unescape_strings;k.wrap_line_length=void 0===e.wrap_line_length?0:parseInt(e.wrap_line_length,10);k.e4x=void 0===e.e4x?!1:e.e4x;e.indent_with_tabs&&(k.indent_char="\t",k.indent_size=1);for(D="";0<k.indent_size;)D+=k.indent_char,--k.indent_size;for(;v&&(" "===v.charAt(0)||"\t"===v.charAt(0));)I+=v.charAt(0),v=v.substring(1);n=v;u=v.length;d="TK_START_BLOCK";B="";q=[{text:[]}];g=!1;G=[];P=[];M(l.BlockStatement);b=0;this.beautify=
function(){for(var b;;){b=W();f=b[0];p=b[1];if("TK_EOF"===p){for(;a.mode===l.Statement;)A();break}b=k.keep_arrayIndentation&&a.mode===l.ArrayLiteral;E=0<z;if(b)for(b=0;b<z;b+=1)h(0<b);else if(k.max_preserve_newlines&&z>k.max_preserve_newlines&&(z=k.max_preserve_newlines),k.preserve_newlines&&1<z)for(h(),b=1;b<z;b+=1)h(!0);ba[p]();"TKInLINE_COMMENT"!==p&&"TK_COMMENT"!==p&&"TK_BLOCK_COMMENT"!==p&&"TK_UNKNOWN"!==p&&(B=a.last_text,d=p,a.last_text=f);a.had_comment="TKInLINE_COMMENT"===p||"TK_COMMENT"===
p||"TK_BLOCK_COMMENT"===p}b=q[0].text.join("");for(var c=1;c<q.length;c++)b+="\n"+q[c].text.join("");return b=b.replace(/[\r\n ]+$/,"")}}var T={};(function(v){var e=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),
C=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]");
v.isIdentifierStart=function(y){return 65>y?36===y:91>y?!0:97>y?95===y:123>y?!0:170<=y&&e.test(String.fromCharCode(y))};v.isIdentifierChar=function(e){return 48>e?36===e:58>e?!0:65>e?!1:91>e?!0:97>e?95===e:123>e?!0:170<=e&&C.test(String.fromCharCode(e))}})(T);"function"===typeof define&&define.amd?define([],function(){return{js_beautify:C}}):"undefined"!==typeof exports?exports.js_beautify=C:"undefined"!==typeof window?window.js_beautify=C:"undefined"!==typeof global&&(global.js_beautify=C)})();var LevelEditr;
(function(q){var r=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given to LevelEditr.");if("undefined"===typeof a.prethings)throw Error("No prethings given to LevelEditr.");if("undefined"===typeof a.thingGroups)throw Error("No thingGroups given to LevelEditr.");if("undefined"===typeof a.things)throw Error("No things given to LevelEditr.");if("undefined"===typeof a.macros)throw Error("No macros given to LevelEditr.");if("undefined"===typeof a.beautifier)throw Error("No beautifier given to LevelEditr.");this.enabled=
!1;this.GameStarter=a.GameStarter;this.prethings=a.prethings;this.thingGroups=a.thingGroups;this.things=a.things;this.macros=a.macros;this.beautifier=a.beautifier;this.mapNameDefault=a.mapNameDefault||"New Map";this.mapTimeDefault=a.mapTimeDefault||Infinity;this.mapSettingDefault=a.mapSettingDefault||"";this.mapEntrances=a.mapEntrances||[];this.mapDefault=a.mapDefault;this.blocksize=a.blocksize||1;this.keyUndefined=a.keyUndefined||"-none-";this.currentPreThings=[];this.currentMode="Build";this.currentClickMode=
"Thing";this.canClick=!0}b.prototype.getEnabled=function(){return this.enabled};b.prototype.getGameStarter=function(){return this.GameStarter};b.prototype.getOldInformation=function(){return this.oldInformation};b.prototype.getPreThings=function(){return this.prethings};b.prototype.getThingGroups=function(){return this.thingGroups};b.prototype.getThings=function(){return this.things};b.prototype.getMacros=function(){return this.macros};b.prototype.getMapNameDefault=function(){return this.mapNameDefault};
b.prototype.getMapTimeDefault=function(){return this.mapTimeDefault};b.prototype.getMapDefault=function(){return this.mapDefault};b.prototype.getDisplay=function(){return this.display};b.prototype.getCurrentMode=function(){return this.currentMode};b.prototype.getBlockSize=function(){return this.blocksize};b.prototype.getBeautifier=function(){return this.beautifier};b.prototype.getCurrentPreThings=function(){return this.currentPreThings};b.prototype.getCurrentTitle=function(){return this.currentTitle};
b.prototype.getCurrentArgs=function(){return this.currentArgs};b.prototype.getPageStylesAdded=function(){return this.pageStylesAdded};b.prototype.getKeyUndefined=function(){return this.keyUndefined};b.prototype.getCanClick=function(){return this.canClick};b.prototype.enable=function(){this.enabled||(this.enabled=!0,this.oldInformation={map:this.GameStarter.AreaSpawner.getMapName()},this.clearAllThings(),this.resetDisplay(),this.setCurrentMode("Build"),this.GameStarter.MapScreener.nokeys=!0,this.setTextareaValue(this.stringifySmart(this.mapDefault),
!0),this.resetDisplayMap(),this.disableAllThings(),this.GameStarter.ItemsHolder.setItem("lives",Infinity),this.pageStylesAdded||(this.GameStarter.addPageStyles(this.createPageStyles()),this.pageStylesAdded=!0),this.GameStarter.container.insertBefore(this.display.container,this.GameStarter.container.children[0]))};b.prototype.disable=function(){this.display&&this.enabled&&(this.GameStarter.container.removeChild(this.display.container),this.display=void 0,this.GameStarter.setMap(this.oldInformation.map),
this.GameStarter.ItemsHolder.setItem("lives",this.GameStarter.settings.statistics.values.lives.valueDefault),this.enabled=!1)};b.prototype.minimize=function(){this.display.minimizer.innerText="+";this.display.minimizer.onclick=this.maximize.bind(this);this.display.container.className+=" minimized";this.display.scrollers.container.style.opacity="0"};b.prototype.maximize=function(){this.display.minimizer.innerText="-";this.display.minimizer.onclick=this.minimize.bind(this);-1!==this.display.container.className.indexOf("minimized")&&
(this.display.container.className=this.display.container.className.replace(/ minimized/g,""));"Thing"===this.currentClickMode?this.setSectionClickToPlaceThings():"Macro"===this.currentClickMode&&this.setSectionClickToPlaceMacros();this.display.scrollers.container.style.opacity="1"};b.prototype.startBuilding=function(){this.setCurrentMode("Build");this.beautifyTextareaValue();this.setDisplayMap(!0);this.maximize()};b.prototype.startPlaying=function(){this.setCurrentMode("Play");this.beautifyTextareaValue();
this.setDisplayMap();this.minimize()};b.prototype.downloadCurrentJSON=function(){var a=this.downloadFile(this.getMapName()+".json",this.display.stringer.textarea.value||"");window.open(a.href)};b.prototype.setCurrentJSON=function(a){this.startBuilding();this.setTextareaValue(a,!0);this.getMapObjectAndTry()};b.prototype.loadCurrentJSON=function(){this.display.inputDummy.click()};b.prototype.beautify=function(a){return this.beautifier(a)};b.prototype.handleUploadCompletion=function(a){this.enable();
this.setCurrentJSON(a.currentTarget.result);this.setSectionJSON()};b.prototype.setCurrentMode=function(a){this.currentMode=a};b.prototype.setCurrentClickMode=function(a,d){this.currentClickMode=a;this.cancelEvent(d)};b.prototype.setCurrentThing=function(a,d,c){void 0===d&&(d=0);void 0===c&&(c=0);var b=this.generateCurrentArgs(),f=this.things[a],g=this.GameStarter.proliferate({outerok:2},this.getNormalizedThingArguments(b)),h=this.GameStarter.ObjectMaker.make(this.currentTitle,g);this.clearCurrentThings();
this.currentTitle=a;this.currentArgs=b;this.currentPreThings=[{xloc:0,yloc:0,top:-f.offsetTop||0,right:f.offsetLeft+h.width*this.GameStarter.unitsize,bottom:(-f.offsetTop||0)+h.height*this.GameStarter.unitsize,left:f.offsetLeft||0,title:this.currentTitle,reference:g,thing:h,spawned:!0}];this.addThingAndDisableEvents(this.currentPreThings[0].thing,d,c)};b.prototype.resetCurrentThings=function(a){var d,c;for(c=0;c<this.currentPreThings.length;c+=1)d=this.currentPreThings[c],d.thing.outerok=2,this.GameStarter.addThing(d.thing,
d.xloc||0,d.yloc||0),this.disableThing(d.thing);this.onMouseMoveEditing(a);this.GameStarter.TimeHandler.cancelAllEvents()};b.prototype.clearCurrentThings=function(){if(this.currentPreThings){for(var a=0;a<this.currentPreThings.length;a+=1)this.GameStarter.killNormal(this.currentPreThings[a].thing);this.currentPreThings=[]}};b.prototype.setCurrentArgs=function(a){if("Thing"===this.currentClickMode)this.setCurrentThing(this.currentTitle);else if("Macro"===this.currentClickMode)this.onMacroIconClick(this.currentTitle,
void 0,this.generateCurrentArgs(),a);a&&a.stopPropagation()};b.prototype.onMouseDownScrolling=function(a,d){var c=d.target,b=this;c.setAttribute("scrolling","1");this.GameStarter.TimeHandler.addEventInterval(function(){if("1"!==c.getAttribute("scrolling"))return!0;if(0>a&&0>=b.GameStarter.MapScreener.left)b.display.scrollers.left.style.opacity=".14";else{for(var d=0;d<b.currentPreThings.length;d+=1)b.GameStarter.shiftHoriz(b.currentPreThings[d].thing,a);b.GameStarter.scrollWindow(a);b.display.scrollers.left.style.opacity=
"1"}},1,Infinity)};b.prototype.onMouseUpScrolling=function(a){a.target.setAttribute("scrolling","0")};b.prototype.onMouseMoveEditing=function(a){var d=a.x||a.clientX||0;a=a.y||a.clientY||0;var c,b,f,g;for(g=0;g<this.currentPreThings.length;g+=1)c=this.currentPreThings[g],b=this.roundTo(d-this.GameStarter.container.offsetLeft,this.blocksize),f=this.roundTo(a-this.GameStarter.container.offsetTop,this.blocksize),c.left&&(b+=c.left*this.GameStarter.unitsize),c.top&&(f-=c.top*this.GameStarter.unitsize),
this.GameStarter.setLeft(c.thing,b),this.GameStarter.setTop(c.thing,f)};b.prototype.afterClick=function(){this.canClick=!1;setTimeout(function(){this.canClick=!0}.bind(this),70)};b.prototype.onClickEditingThing=function(a){if(this.canClick&&"Build"===this.currentMode&&this.currentPreThings.length){var d=this.getNormalizedMouseEventCoordinates(a,!0);a=d[0];d=d[1];this.addMapCreationThing(a,d)&&(this.onClickEditingGenericAdd(a,d,this.currentTitle,this.currentArgs),this.afterClick())}};b.prototype.onClickEditingMacro=
function(a){if(this.canClick&&"Build"===this.currentMode&&this.currentPreThings.length){var d=this.getNormalizedMouseEventCoordinates(a);a=d[0];var d=d[1],b,e;if(this.addMapCreationMacro(a,d)){for(e=0;e<this.currentPreThings.length;e+=1)b=this.currentPreThings[e],this.onClickEditingGenericAdd(a+(b.left||0)*this.GameStarter.unitsize,d-(b.top||0)*this.GameStarter.unitsize,b.thing.title||b.title,b.reference);this.afterClick()}}};b.prototype.onClickEditingGenericAdd=function(a,d,b,e){b=this.GameStarter.ObjectMaker.make(b,
this.GameStarter.proliferate({onThingMake:void 0,onThingAdd:void 0,onThingAdded:void 0,movement:void 0},this.getNormalizedThingArguments(e)));a-=this.GameStarter.container.offsetLeft;d-=this.GameStarter.container.offsetTop;"Build"===this.currentMode&&this.disableThing(b);this.addThingAndDisableEvents(b,a,d)};b.prototype.onThingIconClick=function(a,d){var b=d.x||d.clientX||0,e=d.y||d.clientY||0,f="DIV"===d.target.nodeName?d.target:d.target.parentNode;this.cancelEvent(d);this.killCurrentPreThings();
this.setVisualOptions(f.getAttribute("name"),void 0,f.options);this.generateCurrentArgs();this.setCurrentThing(a,b,e)};b.prototype.onMacroIconClick=function(a,d,b,e){d&&this.setVisualOptions(a,d,b);if(d=this.getMapObject())this.clearCurrentThings(),this.GameStarter.MapsCreator.analyzePreMacro(this.GameStarter.proliferate({macro:a,x:0,y:0},this.generateCurrentArgs()),this.createPrethingsHolder(this.currentPreThings),this.getCurrentAreaObject(d),d),this.currentTitle=a,this.resetCurrentThings(e)};b.prototype.createPrethingsHolder=
function(a){var d={};this.thingGroups.forEach(function(b){d[b]=a});return d};b.prototype.generateCurrentArgs=function(){var a={},d=this.display.sections.ClickToPlace.VisualOptions.getElementsByClassName("VisualOptionsList"),b,e,f;this.currentArgs=a;if(0===d.length)return a;d=d[0].childNodes;for(f=0;f<d.length;f+=1){b=d[f];e=b.querySelector(".VisualOptionLabel");b=b.querySelector(".VisualOptionValue");switch((b.getAttribute("data:type")||b.type).toLowerCase()){case "boolean":b="true"===b.value;break;
case "number":b=(Number(b.value)||0)*(Number(b.getAttribute("data:mod"))||1);break;default:b="Number"===b.getAttribute("typeReal")?Number(b.value):b.value}b!==this.keyUndefined&&(a[e.textContent]=b)}return a};b.prototype.setMapName=function(){var a=this.getMapName(),d=this.getMapObject();d&&d.name!==a&&(d.name=a,this.display.namer.value=a,this.setTextareaValue(this.stringifySmart(d),!0),this.GameStarter.ItemsHolder.setItem("world",a))};b.prototype.setMapTime=function(a){var d=this.getMapObject();
d&&(a?(a=Number(this.display.sections.MapSettings.Time.value),d.time=a):(a=d.time,this.display.sections.MapSettings.Time.value=a.toString()),this.setTextareaValue(this.stringifySmart(d),!0),this.GameStarter.ItemsHolder.setItem("time",a),this.GameStarter.TimeHandler.cancelAllEvents())};b.prototype.setMapSetting=function(a,d){var b=this.getMapObject(),e,f;b&&(e=this.getCurrentAreaObject(b),a?(f=this.display.sections.MapSettings.Setting.Primary.value,this.display.sections.MapSettings.Setting.Secondary.value&&
(f+=" "+this.display.sections.MapSettings.Setting.Secondary.value),this.display.sections.MapSettings.Setting.Tertiary.value&&(f+=" "+this.display.sections.MapSettings.Setting.Tertiary.value),e.setting=f):(f=e.setting.split(" "),this.display.sections.MapSettings.Setting.Primary.value=f[0],this.display.sections.MapSettings.Setting.Secondary.value=f[1],this.display.sections.MapSettings.Setting.Tertiary.value=f[2]),this.setTextareaValue(this.stringifySmart(b),!0),this.setDisplayMap(!0),this.resetCurrentThings(d))};
b.prototype.setLocationArea=function(){var a=this.getMapObject(),d;a&&(d=this.getCurrentLocationObject(a),d.area=this.getCurrentArea(),this.setTextareaValue(this.stringifySmart(a),!0),this.setDisplayMap(!0))};b.prototype.setMapEntry=function(a){var d=this.getMapObject(),b,e;d&&(b=this.getCurrentLocationObject(d),a?(e=this.display.sections.MapSettings.Entry.value,b.entry=e):this.display.sections.MapSettings.Entry.value=e,this.setTextareaValue(this.stringifySmart(d),!0),this.setDisplayMap(!0))};b.prototype.setCurrentLocation=
function(){var a=this.getMapObject(),b;a&&(b=this.getCurrentLocationObject(a),this.display.sections.MapSettings.Area.value=b.area?b.area.toString():"0",this.setTextareaValue(this.stringifySmart(a),!0),this.setDisplayMap(!0))};b.prototype.addLocationToMap=function(){var a=this.display.sections.MapSettings.Location.options.length.toString(),b=this.getMapObject();b&&(b.locations[a]={entry:this.mapEntrances[0]},this.resetAllVisualOptionSelects("VisualOptionLocation",Object.keys(b.locations)),this.setTextareaValue(this.stringifySmart(b),
!0),this.setDisplayMap(!0))};b.prototype.addAreaToMap=function(){var a=this.display.sections.MapSettings.Area.options.length.toString(),b=this.getMapObject();b&&(b.areas[a]={setting:this.mapSettingDefault,creation:[]},this.resetAllVisualOptionSelects("VisualOptionArea",Object.keys(b.areas)),this.setTextareaValue(this.stringifySmart(b),!0),this.setDisplayMap(!0))};b.prototype.resetAllVisualOptionSelects=function(a,b){var c=this.getMapObject(),e=this.display.container.getElementsByClassName(a),f={children:b.map(function(a){return new Option(a,
a)})},g,h;if(c)for(h=0;h<e.length;h+=1)c=e[h],g=c.value,c.textContent="",this.GameStarter.proliferateElement(c,f),c.value=g};b.prototype.getMapObject=function(){var a;try{a=this.parseSmart(this.display.stringer.textarea.value),this.display.stringer.messenger.textContent="",this.display.namer.value=a.name||this.mapNameDefault}catch(b){this.setSectionJSON(),this.display.stringer.messenger.textContent=b.message}return a};b.prototype.getMapObjectAndTry=function(a){var b=this.getMapName()+"::Temporary",
c=this.getMapObject();if(c){try{this.GameStarter.MapsCreator.storeMap(b,c),this.GameStarter.MapsCreator.getMap(b),this.setDisplayMap(!0)}catch(e){this.display.stringer.messenger.textContent=e.message}a&&a.stopPropagation()}};b.prototype.getCurrentArea=function(){return this.display.sections.MapSettings.Area.value};b.prototype.getCurrentAreaObject=function(a){void 0===a&&(a=this.getMapObject());var b=a.locations[this.getCurrentLocation()].area;return a.areas[b?b.toString():"0"]};b.prototype.getCurrentLocation=
function(){return this.display.sections.MapSettings.Location.value};b.prototype.getCurrentLocationObject=function(a){return a.locations[this.getCurrentLocation()]};b.prototype.addMapCreationThing=function(a,b){var c=this.getMapObject(),e=this.GameStarter.proliferate({thing:this.currentTitle,x:this.getNormalizedX(a)+this.GameStarter.MapScreener.left/this.GameStarter.unitsize,y:this.getNormalizedY(b)},this.currentArgs);if(!c)return!1;c.areas[this.getCurrentArea()].creation.push(e);this.setTextareaValue(this.stringifySmart(c),
!0);return!0};b.prototype.addMapCreationMacro=function(a,b){var c=this.getMapObject(),e=this.GameStarter.proliferate({macro:this.currentTitle,x:this.getNormalizedX(a)+this.GameStarter.MapScreener.left/this.GameStarter.unitsize,y:this.getNormalizedY(b)},this.generateCurrentArgs());if(!c)return!1;c.areas[this.getCurrentArea()].creation.push(e);this.setTextareaValue(this.stringifySmart(c),!0);return!0};b.prototype.resetDisplay=function(){this.display={container:this.GameStarter.createElement("div",{className:"LevelEditor",
onclick:this.cancelEvent.bind(this),ondragenter:this.handleDragEnter.bind(this),ondragover:this.handleDragOver.bind(this),ondrop:this.handleDragDrop.bind(this)}),scrollers:{},stringer:{},sections:{ClickToPlace:{},MapSettings:{Setting:{}},buttons:{ClickToPlace:{}}}};this.resetDisplayScrollers();this.resetDisplayGui();this.resetDisplayHead();this.resetDisplaySectionChoosers();this.resetDisplayOptionsList();this.resetDisplayMapSettings();setTimeout(this.resetDisplayThinCheck.bind(this))};b.prototype.resetDisplayThinCheck=
function(){var a=this.display.gui.clientWidth;385>=a?this.display.container.className+=" thin":560<=a&&(this.display.container.className+=" thick")};b.prototype.resetDisplayGui=function(){this.display.gui=this.GameStarter.createElement("div",{className:"EditorGui"});this.display.container.appendChild(this.display.gui)};b.prototype.resetDisplayScrollers=function(){this.display.scrollers={left:this.GameStarter.createElement("div",{className:"EditorScroller EditorScrollerLeft",onmousedown:this.onMouseDownScrolling.bind(this,
2*-this.GameStarter.unitsize),onmouseup:this.onMouseUpScrolling.bind(this),onmouseout:this.onMouseUpScrolling.bind(this),onclick:this.cancelEvent.bind(this),innerText:"<",style:{opacity:.14}}),right:this.GameStarter.createElement("div",{className:"EditorScroller EditorScrollerRight",onmousedown:this.onMouseDownScrolling.bind(this,2*this.GameStarter.unitsize),onmouseup:this.onMouseUpScrolling.bind(this),onmouseout:this.onMouseUpScrolling.bind(this),onclick:this.cancelEvent.bind(this),innerText:">"}),
container:this.GameStarter.createElement("div",{className:"EditorScrollers",onmousemove:this.onMouseMoveEditing.bind(this),onclick:this.onClickEditingThing.bind(this)})};this.display.scrollers.container.appendChild(this.display.scrollers.left);this.display.scrollers.container.appendChild(this.display.scrollers.right);this.display.container.appendChild(this.display.scrollers.container)};b.prototype.resetDisplayHead=function(){this.display.minimizer=this.GameStarter.createElement("div",{className:"EditorHeadButton EditorMinimizer",
onclick:this.minimize.bind(this),textContent:"-"});this.display.head=this.GameStarter.createElement("div",{className:"EditorHead",children:[this.GameStarter.createElement("div",{className:"EditorNameContainer",children:[this.display.namer=this.GameStarter.createElement("input",{className:"EditorNameInput",type:"text",placeholder:this.mapNameDefault,value:this.mapNameDefault,onkeyup:this.setMapName.bind(this),onchange:this.setMapName.bind(this)})]}),this.display.minimizer,this.GameStarter.createElement("div",
{className:"EditorHeadButton EditorCloser",textContent:"X",onclick:this.disable.bind(this)})]});this.display.gui.appendChild(this.display.head)};b.prototype.resetDisplaySectionChoosers=function(){var a=this.GameStarter.createElement("div",{className:"EditorSectionChoosers",onclick:this.cancelEvent.bind(this),children:[this.display.sections.buttons.ClickToPlace.container=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"white"},
textContent:"Visual",onclick:this.setSectionClickToPlace.bind(this)}),this.display.sections.buttons.MapSettings=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"gray"},textContent:"Map",onclick:this.setSectionMapSettings.bind(this)}),this.display.sections.buttons.JSON=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSectionChooser EditorMenuOptionThird",style:{background:"gray"},textContent:"JSON",
onclick:this.setSectionJSON.bind(this)})]});this.display.gui.appendChild(a)};b.prototype.resetDisplayOptionsList=function(){this.display.sections.ClickToPlace.container=this.GameStarter.createElement("div",{className:"EditorOptionsList EditorSectionMain",onclick:this.cancelEvent.bind(this)});this.resetDisplayOptionsListSubOptionsMenu();this.resetDisplayOptionsListSubOptions();this.display.gui.appendChild(this.display.sections.ClickToPlace.container)};b.prototype.resetDisplayOptionsListSubOptionsMenu=
function(){var a=this.GameStarter.createElement("div",{className:"EditorSubOptionsListsMenu"});this.display.sections.buttons.ClickToPlace.Things=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSubOptionsListChooser EditorMenuOptionHalf",textContent:"Things",onclick:this.setSectionClickToPlaceThings.bind(this),style:{background:"#CCC"}});this.display.sections.buttons.ClickToPlace.Macros=this.GameStarter.createElement("div",{className:"EditorMenuOption EditorSubOptionsListChooser EditorMenuOptionHalf",
textContent:"Macros",onclick:this.setSectionClickToPlaceMacros.bind(this),style:{background:"#777"}});a.appendChild(this.display.sections.buttons.ClickToPlace.Things);a.appendChild(this.display.sections.buttons.ClickToPlace.Macros);this.display.sections.ClickToPlace.container.appendChild(a)};b.prototype.resetDisplayMapSettings=function(){this.display.sections.MapSettings.container=this.GameStarter.createElement("div",{className:"EditorMapSettings EditorSectionMain",onclick:this.cancelEvent.bind(this),
style:{display:"none"},children:[this.GameStarter.createElement("div",{className:"EditorMenuOption",textContent:"+ Add Area",onclick:this.addAreaToMap.bind(this)}),this.GameStarter.createElement("div",{className:"EditorMenuOption",textContent:"+ Add Location",onclick:this.addLocationToMap.bind(this)})]});this.resetDisplayMapSettingsCurrent();this.resetDisplayMapSettingsMap();this.resetDisplayMapSettingsArea();this.resetDisplayMapSettingsLocation();this.resetDisplayJSON();this.resetDisplayVisualContainers();
this.resetDisplayButtons();this.display.gui.appendChild(this.display.sections.MapSettings.container)};b.prototype.resetDisplayMapSettingsCurrent=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Current Location"}),this.display.sections.MapSettings.Location=this.createSelect(["0"],{className:"VisualOptionLocation",onchange:this.setCurrentLocation.bind(this)})]}))};
b.prototype.resetDisplayMapSettingsMap=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsGroup",children:[this.GameStarter.createElement("h4",{textContent:"Map"}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{className:"EditorMapSettingsLabel",textContent:"Time"}),this.display.sections.MapSettings.Time=this.createSelect("100 200 300 400 500 1000 Infinity".split(" "),
{value:this.mapTimeDefault.toString(),onchange:this.setMapTime.bind(this,!0)})]})]}))};b.prototype.resetDisplayMapSettingsArea=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",{className:"EditorMapSettingsGroup",children:[this.GameStarter.createElement("h4",{textContent:"Area"}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Setting"}),this.display.sections.MapSettings.Setting.Primary=
this.createSelect(["Overworld","Underworld","Underwater","Castle"],{onchange:this.setMapSetting.bind(this,!0)}),this.display.sections.MapSettings.Setting.Secondary=this.createSelect(["","Night","Underwater","Alt"],{onchange:this.setMapSetting.bind(this,!0)}),this.display.sections.MapSettings.Setting.Tertiary=this.createSelect(["","Night","Underwater","Alt"],{onchange:this.setMapSetting.bind(this,!0)})]})]}))};b.prototype.resetDisplayMapSettingsLocation=function(){this.display.sections.MapSettings.container.appendChild(this.GameStarter.createElement("div",
{className:"EditorMapSettingsGroup",children:[this.GameStarter.createElement("h4",{textContent:"Location"}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",{textContent:"Area"}),this.display.sections.MapSettings.Area=this.createSelect(["0"],{className:"VisualOptionArea",onchange:this.setLocationArea.bind(this,!0)})]}),this.GameStarter.createElement("div",{className:"EditorMapSettingsSubGroup",children:[this.GameStarter.createElement("label",
{textContent:"Entrance"}),this.display.sections.MapSettings.Entry=this.createSelect(this.mapEntrances,{onchange:this.setMapEntry.bind(this,!0)})]})]}))};b.prototype.resetDisplayJSON=function(){this.display.sections.JSON=this.GameStarter.createElement("div",{className:"EditorJSON EditorSectionMain",onclick:this.cancelEvent.bind(this),style:{display:"none"},children:[this.display.stringer.textarea=this.GameStarter.createElement("textarea",{className:"EditorJSONInput",spellcheck:!1,onkeyup:this.getMapObjectAndTry.bind(this),
onchange:this.getMapObjectAndTry.bind(this),onkeydown:function(a){a.stopPropagation()}}),this.display.stringer.messenger=this.GameStarter.createElement("div",{className:"EditorJSONInfo"})]});this.display.gui.appendChild(this.display.sections.JSON)};b.prototype.resetDisplayVisualContainers=function(){this.display.sections.ClickToPlace.VisualOptions=this.GameStarter.createElement("div",{textContent:"Click an icon to view options.",className:"EditorVisualOptions",onclick:this.cancelEvent.bind(this)});
this.display.gui.appendChild(this.display.sections.ClickToPlace.VisualOptions)};b.prototype.resetDisplayButtons=function(){var a=this;this.display.gui.appendChild(this.GameStarter.createElement("div",{className:"EditorMenu",onclick:this.cancelEvent.bind(this),children:function(b){return Object.keys(b).map(function(c){return a.GameStarter.createElement("div",{className:"EditorMenuOption EditorMenuOptionFifth EditorMenuOption-"+c,textContent:c,onclick:b[c][0].bind(a),children:b[c][1]})})}({Build:[this.startBuilding.bind(this)],
Play:[this.startPlaying.bind(this)],Save:[this.downloadCurrentJSON.bind(this)],Load:[this.loadCurrentJSON.bind(this),this.display.inputDummy=this.GameStarter.createElement("input",{type:"file",style:{display:"none"},onchange:this.handleUploadStart.bind(this)})],Reset:[this.resetDisplayMap.bind(this)]})}))};b.prototype.resetDisplayOptionsListSubOptions=function(){this.resetDisplayOptionsListSubOptionsThings();this.resetDisplayOptionsListSubOptionsMacros()};b.prototype.resetDisplayOptionsListSubOptionsThings=
function(){var a=this,b=this.getPrethingSizeArguments.bind(this),c=this.onThingIconClick;this.display.sections.ClickToPlace.Things&&this.display.sections.ClickToPlace.container.removeChild(this.display.sections.ClickToPlace.Things);this.display.sections.ClickToPlace.Things=this.GameStarter.createElement("div",{className:"EditorSectionSecondary EditorOptions EditorOptions-Things",style:{display:"block"},children:function(){var e=0,f=Object.keys(a.prethings).map(function(e){var f=a.prethings[e],g=Object.keys(f).map(function(g){var k=
a.GameStarter.ObjectMaker.make(g,b(f[g])),m=a.GameStarter.createElement("div",{className:"EditorListOption",options:a.prethings[e][g].options,children:[k.canvas],onclick:c.bind(a,g)}),n=(70-k.width*a.GameStarter.unitsize)/2,p=(70-k.height*a.GameStarter.unitsize)/2;m.setAttribute("name",g);k.canvas.style.top=p+"px";k.canvas.style.right=n+"px";k.canvas.style.bottom=p+"px";k.canvas.style.left=n+"px";a.GameStarter.PixelDrawer.setThingSprite(k);return m});return a.GameStarter.createElement("div",{className:"EditorOptionContainer",
style:{display:"none"},children:g})}),g=a.createSelect(Object.keys(a.prethings),{className:"EditorOptionContainerSwitchers",onchange:function(){f[e+1].style.display="none";f[g.selectedIndex+1].style.display="block";e=g.selectedIndex}});f[0].style.display="block";f.unshift(g);return f}()});this.display.sections.ClickToPlace.container.appendChild(this.display.sections.ClickToPlace.Things)};b.prototype.resetDisplayOptionsListSubOptionsMacros=function(){var a=this;this.display.sections.ClickToPlace.Macros&&
this.display.sections.ClickToPlace.container.removeChild(this.display.sections.ClickToPlace.Macros);a.display.sections.ClickToPlace.Macros=a.GameStarter.createElement("div",{className:"EditorSectionSecondary EditorOptions EditorOptions-Macros",style:{display:"none"},children:Object.keys(a.macros).map(function(b){var c=a.macros[b];return a.GameStarter.createElement("div",{className:"EditorOptionContainer",children:[a.GameStarter.createElement("div",{className:"EditorOptionTitle EditorMenuOption",textContent:b,
onclick:a.onMacroIconClick.bind(a,b,c.description,c.options)})]})})});this.display.sections.ClickToPlace.container.appendChild(this.display.sections.ClickToPlace.Macros)};b.prototype.setSectionClickToPlace=function(){this.display.sections.ClickToPlace.VisualOptions.style.display="block";this.display.sections.ClickToPlace.container.style.display="block";this.display.sections.MapSettings.container.style.display="none";this.display.sections.JSON.style.display="none";this.display.sections.buttons.ClickToPlace.container.style.backgroundColor=
"white";this.display.sections.buttons.MapSettings.style.background="gray";this.display.sections.buttons.JSON.style.background="gray";"Thing"!==this.currentClickMode&&"Macro"!==this.currentClickMode&&this.display.sections.buttons.ClickToPlace.Things.click()};b.prototype.setSectionMapSettings=function(a){this.setCurrentClickMode("Map",a);this.display.sections.ClickToPlace.VisualOptions.style.display="none";this.display.sections.ClickToPlace.container.style.display="none";this.display.sections.MapSettings.container.style.display=
"block";this.display.sections.JSON.style.display="none";this.display.sections.buttons.ClickToPlace.container.style.background="gray";this.display.sections.buttons.MapSettings.style.background="white";this.display.sections.buttons.JSON.style.background="gray"};b.prototype.setSectionJSON=function(a){this.setCurrentClickMode("JSON",a);this.display.sections.ClickToPlace.VisualOptions.style.display="none";this.display.sections.ClickToPlace.container.style.display="none";this.display.sections.MapSettings.container.style.display=
"none";this.display.sections.JSON.style.display="block";this.display.sections.buttons.ClickToPlace.container.style.background="gray";this.display.sections.buttons.MapSettings.style.background="gray";this.display.sections.buttons.JSON.style.background="white"};b.prototype.setSectionClickToPlaceThings=function(a){this.setCurrentClickMode("Thing",a);this.display.container.onclick=this.onClickEditingThing.bind(this);this.display.scrollers.container.onclick=this.onClickEditingThing.bind(this);this.display.sections.ClickToPlace.VisualOptions.style.display=
"block";this.display.sections.ClickToPlace.Things.style.display="block";this.display.sections.ClickToPlace.Macros.style.display="none";this.display.sections.buttons.ClickToPlace.Things.style.background="#CCC";this.display.sections.buttons.ClickToPlace.Macros.style.background="#777"};b.prototype.setSectionClickToPlaceMacros=function(a){this.setCurrentClickMode("Macro",a);this.display.container.onclick=this.onClickEditingMacro.bind(this);this.display.scrollers.container.onclick=this.onClickEditingMacro.bind(this);
this.display.sections.ClickToPlace.VisualOptions.style.display="block";this.display.sections.ClickToPlace.Things.style.display="none";this.display.sections.ClickToPlace.Macros.style.display="block";this.display.sections.buttons.ClickToPlace.Things.style.background="#777";this.display.sections.buttons.ClickToPlace.Macros.style.background="#CCC"};b.prototype.setTextareaValue=function(a,b){void 0===b&&(b=!1);this.display.stringer.textarea.value=b?this.beautifier(a):a};b.prototype.beautifyTextareaValue=
function(){this.display.stringer.textarea.value=this.beautifier(this.display.stringer.textarea.value)};b.prototype.setVisualOptions=function(a,b,c){var e=this.display.sections.ClickToPlace.VisualOptions,f=this.createVisualOption.bind(this),g=this;e.textContent="";e.appendChild(this.GameStarter.createElement("h3",{className:"VisualOptionName",textContent:a.replace(/([A-Z][a-z])/g," $1")}));b&&e.appendChild(this.GameStarter.createElement("div",{className:"VisualOptionDescription",textContent:b}));c&&
e.appendChild(g.GameStarter.createElement("div",{className:"VisualOptionsList",children:Object.keys(c).map(function(a){return g.GameStarter.createElement("div",{className:"VisualOption",children:[g.GameStarter.createElement("div",{className:"VisualOptionLabel",textContent:a}),f(c[a])]})})}))};b.prototype.createVisualOption=function(a){a=this.createVisualOptionObject(a);switch(a.type){case "Boolean":return this.createVisualOptionBoolean();case "Number":return this.createVisualOptionNumber(a);case "Select":return this.createVisualOptionSelect(a);
case "String":return this.createVisualOptionString(a);case "Location":return this.createVisualOptionLocation(a);case "Area":return this.createVisualOptionArea(a);case "Everything":return this.createVisualOptionEverything(a);default:throw Error("Unknown type requested: '"+a.type+"'.");}};b.prototype.createVisualOptionObject=function(a){switch(a.constructor){case Number:a={type:"Number",mod:a};break;case String:a={type:a};break;case Array:a={type:"Select",options:a};break}return a};b.prototype.createVisualOptionBoolean=
function(){var a=this.createSelect(["false","true"],{className:"VisualOptionValue",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data:type","Boolean");return a};b.prototype.createVisualOptionNumber=function(a){var b=this;return this.GameStarter.createElement("div",{className:"VisualOptionHolder",children:function(){var c=a.mod||1,e=b.GameStarter.createElement("input",{type:"Number","data:type":"Number",value:void 0===a.value?1:a.value,className:"VisualOptionValue modReal"+
c,onkeyup:b.setCurrentArgs.bind(b),onchange:b.setCurrentArgs.bind(b)}),f=1<c&&b.GameStarter.createElement("div",{className:"VisualOptionRecommendation",textContent:"x"+a.mod}),g=[e];e.setAttribute("data:mod",c.toString());e.setAttribute("data:type","Number");e.setAttribute("typeReal","Number");if(a.Infinite){var h=void 0,l=b.createSelect(["Number","Infinite"],{className:"VisualOptionInfiniter",onchange:function(a){"Number"===l.value?(e.type="Number",e.disabled=!1,e.style.display="",f&&(f.style.display=
""),e.value=h):(e.type="Text",e.disabled=!0,e.style.display="none",f&&(f.style.display="none"),h=e.value,e.value="Infinity");e.onchange(a)}});Infinity===a.value&&(l.value="Infinite",l.onchange(void 0));g.push(l)}f&&g.push(f);return g}()})};b.prototype.createVisualOptionSelect=function(a){a=this.createSelect(a.options,{className:"VisualOptionValue","data:type":"Select",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data:type","Select");return a};b.prototype.createVisualOptionString=
function(a){a=this.createSelect(a.options,{className:"VisualOptionValue","data:type":"String",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data:type","String");return a};b.prototype.createVisualOptionLocation=function(a){a=this.getMapObject();if(!a)return this.GameStarter.createElement("div",{className:"VisualOptionValue VisualOptionLocation EditorComplaint",text:"Fix map compilation to get locations!"});a=Object.keys(a.locations);a.unshift(this.keyUndefined);
a=this.createSelect(a,{className:"VisualOptionValue VisualOptionLocation","data-type":"String",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data-type","String");return a};b.prototype.createVisualOptionArea=function(a){a=this.getMapObject();if(!a)return this.GameStarter.createElement("div",{className:"VisualOptionValue VisualOptionArea EditorComplaint",text:"Fix map compilation to get areas!"});a=Object.keys(a.areas);a.unshift(this.keyUndefined);
a=this.createSelect(a,{className:"VisualOptionValue VisualOptionArea","data-type":"String",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data-type","String");return a};b.prototype.createVisualOptionEverything=function(a){a=this.createSelect(Object.keys(this.things),{className:"VisualOptionValue VisualOptionEverything","data-type":"String",onkeyup:this.setCurrentArgs.bind(this),onchange:this.setCurrentArgs.bind(this)});a.setAttribute("data-type","String");
return a};b.prototype.resetDisplayMap=function(){this.setTextareaValue(this.stringifySmart(this.mapDefault),!0);this.setDisplayMap(!0)};b.prototype.setDisplayMap=function(a){var b=this.display.stringer.textarea.value,c=this.getMapName(),e;try{e=this.parseSmart(b),this.setTextareaValue(this.display.stringer.textarea.value)}catch(f){this.setSectionJSON();this.display.stringer.messenger.textContent=f.message;return}try{this.GameStarter.MapsCreator.storeMap(c,e),this.GameStarter.MapsCreator.getMap(c)}catch(f){this.setSectionJSON();
this.display.stringer.messenger.textContent=f.message;return}this.display.stringer.messenger.textContent="";this.setTextareaValue(this.display.stringer.textarea.value);this.GameStarter.setMap(c,this.getCurrentLocation());this.resetDisplayOptionsListSubOptionsThings();a&&this.disableAllThings()};b.prototype.getMapName=function(){return this.display.namer.value||this.mapNameDefault};b.prototype.roundTo=function(a,b){return Math.round(a/b)*b};b.prototype.stringifySmart=function(a){void 0===a&&(a={});
return JSON.stringify(a,this.jsonReplacerSmart)};b.prototype.parseSmart=function(a){a=JSON.parse(a,this.jsonReplacerSmart);var b=a.areas,c;for(c in b)b.hasOwnProperty(c)&&(b[c].editor=!0);return a};b.prototype.jsonReplacerSmart=function(a,b){return b!==b?"NaN":Infinity===b?"Infinity":-Infinity===b?"-Infinity":b};b.prototype.disableThing=function(a,b){void 0===b&&(b=1);a.movement=void 0;a.nofall=!0;a.nocollide=!0;a.outerok=2;a.xvel=0;a.yvel=0;a.opacity=b};b.prototype.disableAllThings=function(){var a=
this,b=this.GameStarter.GroupHolder.getGroups(),c;for(c in b)b.hasOwnProperty(c)&&b[c].forEach(function(b){a.disableThing(b)});this.GameStarter.TimeHandler.cancelAllEvents()};b.prototype.addThingAndDisableEvents=function(a,b,c){b=this.roundTo(b,this.GameStarter.scale);c=this.roundTo(c,this.GameStarter.scale);this.GameStarter.addThing(a,b,c);this.disableThing(a);this.GameStarter.TimeHandler.cancelAllEvents();if(a.hasOwnProperty("hidden")&&a.hidden||0===a.opacity)a.hidden=!1,a.opacity=.35};b.prototype.clearAllThings=
function(){var a=this,b=this.GameStarter.GroupHolder.getGroups(),c;for(c in b)b.hasOwnProperty(c)&&b[c].forEach(function(b){a.GameStarter.killNormal(b)})};b.prototype.getNormalizedX=function(a){return a/this.GameStarter.unitsize};b.prototype.getNormalizedY=function(a){return this.GameStarter.MapScreener.floor-a/this.GameStarter.unitsize+3*this.GameStarter.unitsize};b.prototype.getNormalizedThingArguments=function(a){a=this.GameStarter.proliferate({},a);Infinity===a.height&&(a.height=this.GameStarter.MapScreener.height);
Infinity===a.width&&(a.width=this.GameStarter.MapScreener.width);return a};b.prototype.getNormalizedMouseEventCoordinates=function(a,b){var c=this.roundTo(a.x||a.clientX||0,this.blocksize),e=this.roundTo(a.y||a.clientY||0,this.blocksize),f;b&&(f=this.things[this.currentTitle],f.offsetLeft&&(c+=f.offsetLeft*this.GameStarter.unitsize),f.offsetTop&&(e+=f.offsetTop*this.GameStarter.unitsize));return[c,e]};b.prototype.getPrethingSizeArguments=function(a){var b={},c=this.getPrethingSizeArgument(a.width);
a=this.getPrethingSizeArgument(a.height);c&&(b.width=c);a&&(b.height=a);return b};b.prototype.getPrethingSizeArgument=function(a){if(a){if(a.real)return a.real;var b=a.value||1;a=a.mod||1;return isFinite(b)?b*a:a||8}};b.prototype.createSelect=function(a,b){var c=this.GameStarter.createElement("select",b),e;for(e=0;e<a.length;e+=1)c.appendChild(this.GameStarter.createElement("option",{value:a[e],textContent:a[e]}));"undefined"!==typeof b.value&&(c.value=b.value);this.applyElementAttributes(c,b);return c};
b.prototype.applyElementAttributes=function(a,b){for(var c in b)b.hasOwnProperty(c)&&0===c.indexOf("data:")&&a.setAttribute(c,b[c])};b.prototype.downloadFile=function(a,b){var c=this.GameStarter.createElement("a",{download:a,href:"data:text/json;charset=utf-8,"+encodeURIComponent(b)});this.display.container.appendChild(c);c.click();this.display.container.removeChild(c);return c};b.prototype.killCurrentPreThings=function(){for(var a=0;a<this.currentPreThings.length-1;a+=1)this.GameStarter.killNormal(this.currentPreThings[a].thing)};
b.prototype.handleUploadStart=function(a){var b;this.cancelEvent(a);a&&a.dataTransfer?a=a.dataTransfer.files[0]:(a=this.display.inputDummy.files[0],new FileReader);a&&(b=new FileReader,b.onloadend=this.handleUploadCompletion.bind(this),b.readAsText(a))};b.prototype.handleDragEnter=function(a){this.setSectionJSON()};b.prototype.handleDragOver=function(a){this.cancelEvent(a)};b.prototype.handleDragDrop=function(a){this.handleUploadStart(a)};b.prototype.cancelEvent=function(a){a&&("function"===typeof a.preventDefault&&
a.preventDefault(),"function"===typeof a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)};b.prototype.createPageStyles=function(){return{".LevelEditor":{position:"absolute",top:"0",right:"0",bottom:"0",left:"0"},".LevelEditor h4":{margin:"14px 0 7px 0"},".LevelEditor select, .LevelEditor input":{margin:"7px",padding:"3px 7px","font-size":"1.17em"},".LevelEditor .EditorGui":{position:"absolute",top:"0",right:"0",bottom:"0",width:"50%",background:"rgba(0, 7, 14, .84)",overflow:"hidden","user-select":"none",
"box-sizing":"border-box","z-index":"70",transition:"117ms all"},".LevelEditor .EditorMenuContainer":{position:"absolute",top:"0",right:"0",bottom:"0",width:"50%",background:"rgba(0, 7, 14, .84)",overflow:"hidden","user-select":"none","box-sizing":"border-box","z-index":"70",transition:"117ms all"},".LevelEditor .EditorScrollers":{position:"absolute",top:"0",right:"50%",bottom:"0",left:"0",transition:"117ms all"},".EditorScroller":{position:"absolute",top:"50%","margin-top":"-35px",width:"70px",cursor:"pointer",
"box-sizing":"border-box","font-size":"70px","text-align":"center",transition:"280ms all"},".EditorScrollerRight":{right:"0","padding-left":".084em"},".EditorScrollerLeft":{left:"0"},".LevelEditor.minimized .EditorGui":{width:"117px"},".LevelEditor.minimized .EditorMenuContainer":{width:"117px"},".LevelEditor.minimized .EditorScrollers":{right:"117px","padding-right":"117px"},".LevelEditor .EditorHead":{position:"relative",height:"35px"},".LevelEditor .EditorHead .EditorNameContainer":{position:"absolute",
top:"1px",right:"73px",left:"2px",height:"35px"},".LevelEditor .EditorHead .EditorNameInput":{display:"block",margin:"0",padding:"3px 7px",width:"100%",background:"white",border:"1px solid black","font-size":"1.4em","box-sizing":"border-box"},".LevelEditor .EditorHead .EditorHeadButton":{position:"absolute",top:"2px",width:"32px",height:"32px",background:"rgb(35,35,35)",border:"1px solid silver","box-sizing":"border-box","text-align":"center","padding-top":"7px",cursor:"pointer"},".LevelEditor .EditorHead .EditorMinimizer":{right:"38px"},
".LevelEditor .EditorHead .EditorCloser":{right:"3px"},".LevelEditor .EditorSectionChooser":{width:"50%","box-sizing":"border-box",height:"35px",background:"white",border:"3px solid black",color:"black",cursor:"pointer"},".LevelEditor .EditorSectionChooser.Inactive":{background:"gray"},".LevelEditor.minimized .EditorSectionChoosers":{opacity:"0"},".LevelEditor .EditorSectionMain":{position:"absolute",top:"70px",right:"0",bottom:"35px",left:"0","overflow-y":"auto"},".LevelEditor.minimized .EditorSectionMain":{display:"none"},
".LevelEditor .EditorSectionSecondary":{position:"absolute",top:"35px",right:"203px",bottom:"0px",left:"0","min-width":"182px","overflow-y":"auto","overflow-x":"hidden"},".LevelEditor .EditorJSON":{"font-family":"Courier"},".LevelEditor .EditorJSONInput":{display:"block",width:"100%",height:"84%",background:"rgba(0, 3, 7, .91)",color:"rgba(255, 245, 245, .91)","box-sizing":"border-box","overflow-y":"auto",resize:"none"},".LevelEditor .EditorJSONInfo":{height:"1.75em",padding:"3px 7px"},".LevelEditor.minimized .EditorJSON":{opacity:"0"},
".LevelEditor .EditorOptions, .LevelEditor .EditorOptionContainer":{"padding-left":"3px",clear:"both"},".LevelEditor.minimized .EditorOptionsList":{opacity:"0"},".LevelEditor .EditorListOption":{position:"relative","float":"left",margin:"0 7px 7px 0",width:"70px",height:"70px",background:"rgba(77, 77, 77, .7)",border:"2px solid black",overflow:"hidden",cursor:"pointer"},".LevelEditor .EditorListOption canvas":{position:"absolute"},".LevelEditor .EditorVisualOptions":{position:"absolute",top:"105px",
right:"0",bottom:"35px",padding:"7px 11px",width:"203px","border-left":"1px solid silver",background:"rgba(0, 7, 14, .84)","overflow-x":"visible","overflow-y":"auto","line-height":"140%",opacity:"1","box-sizing":"border-box",transition:"117ms opacity, 70ms left"},".LevelEditor.thin .EditorVisualOptions":{left:"185px"},".LevelEditor.thin .EditorVisualOptions:hover":{left:"70px",right:"0",width:"auto","overflow-x":"hidden"},".LevelEditor.thick .EditorVisualOptions":{width:"350px"},".LevelEditor.thick .EditorSectionSecondary":{right:"350px"},
".LevelEditor.minimized .EditorVisualOptions":{left:"100%"},".LevelEditor .EditorVisualOptions .VisualOption":{padding:"14px 0"},".LevelEditor .EditorVisualOptions .VisualOptionName":{margin:"3px 0 7px 0"},".LevelEditor .EditorVisualOptions .VisualOptionDescription":{"padding-bottom":"14px"},".LevelEditor .EditorVisualOptions .VisualOptionValue":{"max-width":"117px"},".LevelEditor .EditorVisualOptions select.VisualOptionValue":{"max-width":"156px"},".LevelEditor .EditorVisualOptions .VisualOptionInfiniter, .LevelEditor .EditorVisualOptions .VisualOptionRecommendation":{display:"inline"},
".LevelEditor .EditorMenu":{position:"absolute",right:"0",bottom:"0",left:"0"},".LevelEditor .EditorMenuOption":{display:"inline-block",padding:"7px 14px",background:"white",border:"3px solid black","box-sizing":"border-box",color:"black","text-align":"center",overflow:"hidden",cursor:"pointer"},".LevelEditor.minimized .EditorMenuOption:not(:first-of-type)":{display:"none"},".LevelEditor.minimized .EditorMenuOption:first-of-type":{width:"auto"},".LevelEditor .EditorMenuOption:hover":{opacity:".91"},
".LevelEditor .EditorMenuOption.EditorMenuOptionHalf":{width:"50%"},".LevelEditor .EditorMenuOption.EditorMenuOptionThird":{width:"33%"},".LevelEditor .EditorMenuOption.EditorMenuOptionFifth":{width:"20%"},".LevelEditor .EditorMapSettingsGroup":{"padding-left":"7px"},".LevelEditor .EditorMapSettingsSubGroup":{"padding-left":"14px"},".LevelEditor.minimized .EditorMapSettings":{opacity:"0"}}};return b}();q.LevelEditr=r})(LevelEditr||(LevelEditr={}));var MapsCreatr;(function(k){var l=function(){return function(c,a,b){this.thing=c;this.title=c.title;this.reference=a;this.spawned=!1;this.left=a.x||0;this.top=a.y||0;this.right=this.left+(a.width||b.getFullPropertiesOf(this.title).width);this.bottom=this.top+(a.height||b.getFullPropertiesOf(this.title).height);a.position&&(this.position=a.position)}}();k.PreThing=l})(MapsCreatr||(MapsCreatr={}));
(function(k){var l=function(){function c(a){if(!a)throw Error("No settings object given to MapsCreatr.");if(!a.ObjectMaker)throw Error("No ObjectMakr given to MapsCreatr.");if("undefined"===typeof a.ObjectMaker.getFullProperties())throw Error("MapsCreatr's ObjectMaker must store full properties.");if(!a.groupTypes)throw Error("No groupTypes given to MapsCreatr.");this.ObjectMaker=a.ObjectMaker;this.groupTypes=a.groupTypes;this.keyGroupType=a.keyGroupType||"groupType";this.keyEntrance=a.keyEntrance||
"entrance";this.macros=a.macros||{};this.scope=a.scope||this;this.entrances=a.entrances;this.requireEntrance=a.requireEntrance;this.mapsRaw={};this.maps={};a.maps&&this.storeMaps(a.maps)}c.prototype.getObjectMaker=function(){return this.ObjectMaker};c.prototype.getGroupTypes=function(){return this.groupTypes};c.prototype.getKeyGroupType=function(){return this.keyGroupType};c.prototype.getKeyEntrance=function(){return this.keyEntrance};c.prototype.getMacros=function(){return this.macros};c.prototype.getScope=
function(){return this.scope};c.prototype.getRequireEntrance=function(){return this.requireEntrance};c.prototype.getMapsRaw=function(){return this.mapsRaw};c.prototype.getMaps=function(){return this.maps};c.prototype.getMapRaw=function(a){var b=this.mapsRaw[a];if(!b)throw Error("No map found under: "+a);return b};c.prototype.getMap=function(a){var b=this.maps[a];if(!b)throw Error("No map found under: "+a);b.initialized||this.initializeMap(b);return b};c.prototype.storeMaps=function(a){for(var b in a)a.hasOwnProperty(b)&&
this.storeMap(b,a[b])};c.prototype.storeMap=function(a,b){if(!a)throw Error("Maps cannot be created with no name.");var e=this.ObjectMaker.make("Map",b);this.mapsRaw[a]=b;if(!e.areas)throw Error("Maps cannot be used with no areas: "+a);if(!e.locations)throw Error("Maps cannot be used with no locations: "+a);return this.maps[a]=e};c.prototype.getPreThings=function(a){var b=a.map,e=a.creation,f=this.createObjectFromStringArray(this.groupTypes),d;a.collections={};for(d=0;d<e.length;d+=1)this.analyzePreSwitch(e[d],
f,a,b);return this.processPreThingsArrays(f)};c.prototype.analyzePreSwitch=function(a,b,e,f){return a.macro?this.analyzePreMacro(a,b,e,f):this.analyzePreThing(a,b,e,f)};c.prototype.analyzePreMacro=function(a,b,e,f){var d=this.macros[a.macro];if(!d)throw Error("A non-existent macro is referenced: '"+a.macro+"'.");if(a=d(a,b,e,f,this.scope))if(a instanceof Array)for(d=0;d<a.length;d+=1)this.analyzePreSwitch(a[d],b,e,f);else this.analyzePreSwitch(a,b,e,f);return a};c.prototype.analyzePreThing=function(a,
b,e,f){var d=a.thing,c,g;if(!this.ObjectMaker.hasFunction(d))throw Error("A non-existent Thing type is referenced: '"+d+"'.");g=new k.PreThing(this.ObjectMaker.make(d,a),a,this.ObjectMaker);c=g.thing;if(!g.thing[this.keyGroupType])throw Error("A Thing of type '"+d+"' does not contain a "+this.keyGroupType+".");if(-1===this.groupTypes.indexOf(g.thing[this.keyGroupType]))throw Error("A Thing of type '"+d+"' contains an unknown "+this.keyGroupType+".");b[g.thing[this.keyGroupType]].push(g);!c.noBoundaryStretch&&
e.boundaries&&this.stretchAreaBoundaries(g,e);void 0!==c[this.keyEntrance]&&"object"!==typeof c[this.keyEntrance]&&"undefined"!==typeof f.locations[c[this.keyEntrance]]&&("undefined"===typeof f.locations[c[this.keyEntrance]].xloc&&(f.locations[c[this.keyEntrance]].xloc=g.left),"undefined"===typeof f.locations[c[this.keyEntrance]].yloc&&(f.locations[c[this.keyEntrance]].yloc=g.top),f.locations[c[this.keyEntrance]].entrance=g.thing);a.collectionName&&e.collections&&this.ensureThingCollection(c,a.collectionName,
a.collectionKey,e);return g};c.prototype.initializeMap=function(a){this.setMapAreas(a);this.setMapLocations(a);a.initialized=!0};c.prototype.setMapAreas=function(a){var b=a.areas,e=a.locations,c=new b.constructor,d=new e.constructor,h,g;for(g in b)b.hasOwnProperty(g)&&(h=this.ObjectMaker.make("Area",b[g]),c[g]=h,h.map=a,h.name=g,h.boundaries={top:0,right:0,bottom:0,left:0});for(g in e)if(e.hasOwnProperty(g)){b=this.ObjectMaker.make("Location",e[g]);d[g]=b;b.entryRaw=e[g].entry;b.name=g;b.area=e[g].area||
0;if(this.requireEntrance&&!this.entrances.hasOwnProperty(b.entryRaw))throw Error("Location "+g+" has unknown entry string: "+b.entryRaw);this.entrances&&b.entryRaw?b.entry=this.entrances[b.entryRaw]:b.entry&&b.entry.constructor===String&&(b.entry=this.entrances[String(b.entry)])}a.areas=c;a.locations=d};c.prototype.setMapLocations=function(a){var b=a.locations,e=new b.constructor,c,d;for(d in b)if(b.hasOwnProperty(d)&&(c=this.ObjectMaker.make("Location",b[d]),e[d]=c,c.area=a.areas[b[d].area||0],
!e[d].area))throw Error("Location "+d+" references an invalid area:"+b[d].area);a.locations=e};c.prototype.stretchAreaBoundaries=function(a,b){var e=b.boundaries;e.top=Math.min(a.top,e.top);e.right=Math.max(a.right,e.right);e.bottom=Math.max(a.bottom,e.bottom);e.left=Math.min(a.left,e.left)};c.prototype.ensureThingCollection=function(a,b,e,c){var d=c.collections[b];d||(d=c.collections[b]={});a.collection=d;d[e]=a};c.prototype.processPreThingsArrays=function(a){var b=this,c={},f;for(f in a)if(a.hasOwnProperty(f)){var d=
a[f],h={xInc:this.getArraySorted(d,this.sortPreThingsXInc),xDec:this.getArraySorted(d,this.sortPreThingsXDec),yInc:this.getArraySorted(d,this.sortPreThingsYInc),yDec:this.getArraySorted(d,this.sortPreThingsYDec),push:function(a){b.addArraySorted(h.xInc,a,b.sortPreThingsXInc);b.addArraySorted(h.xDec,a,b.sortPreThingsXDec);b.addArraySorted(h.yInc,a,b.sortPreThingsYInc);b.addArraySorted(h.yDec,a,b.sortPreThingsYDec)}};c[f]=h}return c};c.prototype.createObjectFromStringArray=function(a){var b={},c;for(c=
0;c<a.length;c+=1)b[a[c]]=[];return b};c.prototype.getArraySorted=function(a,b){var c=a.slice();c.sort(b);return c};c.prototype.addArraySorted=function(a,b,c){for(var f=0,d=a.length,h;f!==d;)h=(f+d)/2|0,0>c(b,a[h])?d=h:f=h+1;f===d&&a.splice(f,0,b)};c.prototype.sortPreThingsXInc=function(a,b){return a.left===b.left?a.top-b.top:a.left-b.left};c.prototype.sortPreThingsXDec=function(a,b){return b.right===a.right?b.bottom-a.bottom:b.right-a.right};c.prototype.sortPreThingsYInc=function(a,b){return a.top===
b.top?a.left-b.left:a.top-b.top};c.prototype.sortPreThingsYDec=function(a,b){return b.bottom===a.bottom?b.right-a.right:b.bottom-a.bottom};return c}();k.MapsCreatr=l})(MapsCreatr||(MapsCreatr={}));var MapScreenr;
(function(c){var d=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given to MapScreenr.");if("undefined"===typeof a.width)throw Error("No width given to MapScreenr.");if("undefined"===typeof a.height)throw Error("No height given to MapScreenr.");for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.variables=a.variables||{};this.variableArgs=a.variableArgs||[]}b.prototype.clearScreen=function(){this.top=this.left=0;this.right=this.width;this.bottom=this.height;
this.setMiddleX();this.setMiddleY();this.setVariables()};b.prototype.setMiddleX=function(){this.middleX=(this.left+this.right)/2};b.prototype.setMiddleY=function(){this.middleY=(this.top+this.bottom)/2};b.prototype.setVariables=function(){for(var a in this.variables)this.variables.hasOwnProperty(a)&&this.setVariable(a)};b.prototype.setVariable=function(a,b){this[a]=1===arguments.length?this.variables[a].apply(this,this.variableArgs):b};b.prototype.shift=function(a,b){a&&this.shiftX(a);b&&this.shiftY(b)};
b.prototype.shiftX=function(a){this.left+=a;this.right+=a};b.prototype.shiftY=function(a){this.top+=a;this.bottom+=a};return b}();c.MapScreenr=d})(MapScreenr||(MapScreenr={}));var MathDecidr;
(function(d){var e=function(){function c(a){void 0===a&&(a={});var b;this.constants=a.constants||{};this.equations={};for(b in this.equationsRaw=a.equations||{},this.equationsRaw)this.equationsRaw.hasOwnProperty(b)&&this.addEquation(b,this.equationsRaw[b])}c.prototype.getConstants=function(){return this.constants};c.prototype.getConstant=function(a){return this.constants[a]};c.prototype.getEquations=function(){return this.equations};c.prototype.getRawEquations=function(){return this.equationsRaw};c.prototype.getEquation=
function(a){return this.equations[a]};c.prototype.getRawEquation=function(a){return this.equationsRaw[a]};c.prototype.addConstant=function(a,b){this.constants[a]=b};c.prototype.addEquation=function(a,b){this.equationsRaw[a]=b;this.equations[a]=b.bind(this,this.constants,this.equations)};c.prototype.compute=function(a){for(var b=1;b<arguments.length;b++);return this.equations[a].apply(this,Array.prototype.slice.call(arguments,1))};return c}();d.MathDecidr=e})(MathDecidr||(MathDecidr={}));var ModAttachr;
(function(f){var g=function(){function d(a){this.mods={};this.events={};a&&(this.scopeDefault=a.scopeDefault,a.ItemsHoldr?this.ItemsHolder=a.ItemsHoldr:a.storeLocally&&(this.ItemsHolder=new ItemsHoldr.ItemsHoldr),a.mods&&this.addMods.apply(this,a.mods))}d.prototype.getMods=function(){return this.mods};d.prototype.getMod=function(a){return this.mods[a]};d.prototype.getEvents=function(){return this.events};d.prototype.getEvent=function(a){return this.events[a]};d.prototype.getItemsHolder=function(){return this.ItemsHolder};
d.prototype.getScopeDefault=function(){return this.scopeDefault};d.prototype.addMod=function(a){var c=a.events,b;for(b in c)c.hasOwnProperty(b)&&(this.events.hasOwnProperty(b)?this.events[b].push(a):this.events[b]=[a]);a.scope=a.scope||this.scopeDefault;this.mods[a.name]=a;a.enabled&&a.events.hasOwnProperty("onModEnable")&&this.fireModEvent("onModEnable",a.name,arguments);if(this.ItemsHolder&&(this.ItemsHolder.addItem(a.name,{valueDefault:0,storeLocally:!0}),this.ItemsHolder.getItem(a.name)))return this.enableMod(a.name)};
d.prototype.addMods=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];var c=[],b;for(b=0;b<a.length;b+=1)c.push(this.addMod(a[b]));return c};d.prototype.enableMod=function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];b=this.mods[a];if(!b)throw Error("No mod of name: '"+a+"'");c=[].slice.call(c);c.unshift(b,a);b.enabled=!0;this.ItemsHolder&&this.ItemsHolder.setItem(a,!0);if(b.events.hasOwnProperty("onModEnable"))return this.fireModEvent("onModEnable",b.name,arguments)};
d.prototype.enableMods=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];var c=[],b;for(b=0;b<a.length;b+=1)c.push(this.enableMod(a[b]));return c};d.prototype.disableMod=function(a){var c=this.mods[a],b;if(!this.mods[a])throw Error("No mod of name: '"+a+"'");this.mods[a].enabled=!1;b=Array.prototype.slice.call(arguments);b[0]=c;this.ItemsHolder&&this.ItemsHolder.setItem(a,!1);if(c.events.hasOwnProperty("onModDisable"))return this.fireModEvent("onModDisable",c.name,b)};d.prototype.disableMods=
function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];var c=[],b;for(b=0;b<a.length;b+=1)c.push(this.disableMod(a[b]));return c};d.prototype.toggleMod=function(a){var c=this.mods[a];if(!c)throw Error("No mod found under "+a);return c.enabled?this.disableMod(a):this.enableMod(a)};d.prototype.toggleMods=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];var c=[],b;for(b=0;b<a.length;b+=1)c.push(this.toggleMod(a[b]));return c};d.prototype.fireEvent=function(a){for(var c=
[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];var b=this.events[a],d,e;if(b)for(c=[].slice.call(c),c.unshift(void 0,a),e=0;e<b.length;e+=1)d=b[e],d.enabled&&(c[0]=d,d.events[a].apply(d.scope,c))};d.prototype.fireModEvent=function(a,c){for(var b=[],d=2;d<arguments.length;d++)b[d-2]=arguments[d];var d=this.mods[c],e;if(!d)throw Error("Unknown mod requested: '"+c+"'");b=[].slice.call(b);b.unshift(d,a);e=d.events[a];if(!e)throw Error("Mod does not contain event: '"+a+"'");return e.apply(d.scope,b)};
return d}();f.ModAttachr=g})(ModAttachr||(ModAttachr={}));var NumberMakr;
(function(g){var h=function(){function a(b){void 0===b&&(b={});this.stateLength=b.stateLength||624;this.statePeriod=b.statePeriod||397;this.matrixA=b.matrixA||2567483615;this.maskUpper=b.maskUpper||2147483648;this.maskLower=b.maskLower||2147483647;this.stateVector=Array(this.stateLength);this.stateIndex=this.stateLength+1;this.matrixAMagic=[0,this.matrixA];this.resetFromSeed(b.seed||(new Date).getTime())}a.prototype.getSeed=function(){return this.seed};a.prototype.getStateLength=function(){return this.stateLength};a.prototype.getStatePeriod=
function(){return this.statePeriod};a.prototype.getMatrixA=function(){return this.matrixA};a.prototype.getMaskUpper=function(){return this.maskUpper};a.prototype.getMaskLower=function(){return this.maskLower};a.prototype.resetFromSeed=function(b){var c;this.stateVector[0]=b>>>0;for(this.stateIndex=1;this.stateIndex<this.stateLength;this.stateIndex+=1)c=this.stateVector[this.stateIndex-1]^this.stateVector[this.stateIndex-1]>>>30,this.stateVector[this.stateIndex]=(1812433253*((c&4294901760)>>>16)<<
16)+1812433253*(c&65535)+this.stateIndex>>>0;this.seed=b};a.prototype.resetFromArray=function(b,c){void 0===c&&(c=b.length);var a=1,d=0,f,e;this.resetFromSeed(19650218);"undefined"===typeof c&&(c=b.length);for(f=this.stateLength>c?this.stateLength:c;0<f;)e=this.stateVector[a-1]^this.stateVector[a-1]>>>30,this.stateVector[a]=(this.stateVector[a]^(1664525*((e&4294901760)>>>16)<<16)+1664525*(e&65535)+b[d]+d)>>>0,a+=1,d+=1,a>=this.stateLength&&(this.stateVector[0]=this.stateVector[this.stateLength-1],
a=1),d>=c&&(d=0);for(f=this.stateLength-1;f;--f)e=this.stateVector[a-1]^this.stateVector[a-1]>>>30,this.stateVector[a]=(this.stateVector[a]^(1566083941*((e&4294901760)>>>16)<<16)+1566083941*(e&65535))-a>>>0,a+=1,a>=this.stateLength&&(this.stateVector[0]=this.stateVector[this.stateLength-1],a=1);this.stateVector[0]=2147483648;this.seed=b};a.prototype.randomInt32=function(){var b,a;if(this.stateIndex>=this.stateLength){this.stateIndex===this.stateLength+1&&this.resetFromSeed(5489);for(a=0;a<this.stateLength-
this.statePeriod;a+=1)b=this.stateVector[a]&this.maskUpper|this.stateVector[a+1]&this.maskLower,this.stateVector[a]=this.stateVector[a+this.statePeriod]^b>>>1^this.matrixAMagic[b&1];for(;a<this.stateLength-1;a+=1)b=this.stateVector[a]&this.maskUpper|this.stateVector[a+1]&this.maskLower,this.stateVector[a]=this.stateVector[a+(this.statePeriod-this.stateLength)]^b>>>1^this.matrixAMagic[b&1];b=this.stateVector[this.stateLength-1]&this.maskUpper|this.stateVector[0]&this.maskLower;this.stateVector[this.stateLength-
1]=this.stateVector[this.statePeriod-1]^b>>>1^this.matrixAMagic[b&1];this.stateIndex=0}b=this.stateVector[this.stateIndex];this.stateIndex+=1;b^=b>>>11;b^=b<<7&2636928640;b^=b<<15&4022730752;return(b^b>>>18)>>>0};a.prototype.random=function(){return this.randomInt32()*(1/4294967296)};a.prototype.randomInt31=function(){return this.randomInt32()>>>1};a.prototype.randomReal1=function(){return this.randomInt32()*(1/4294967295)};a.prototype.randomReal3=function(){return(this.randomInt32()+.5)*(1/4294967296)};
a.prototype.randomReal53Bit=function(){var b=this.randomInt32()>>>5,a=this.randomInt32()>>>6;return 1.1102230246251565E-16*(67108864*b+a)};a.prototype.randomUnder=function(a){return this.random()*a};a.prototype.randomWithin=function(a,c){return this.randomUnder(c-a)+a};a.prototype.randomInt=function(a){return this.randomUnder(a)|0};a.prototype.randomIntWithin=function(a,c){return this.randomUnder(c-a)+a|0};a.prototype.randomBoolean=function(){return 1===this.randomInt(2)};a.prototype.randomBooleanProbability=
function(a){return this.random()<a};a.prototype.randomBooleanFraction=function(a,c){return this.random()<=a/c};a.prototype.randomArrayIndex=function(a){return this.randomIntWithin(0,a.length)};a.prototype.randomArrayMember=function(a){return a[this.randomArrayIndex(a)]};return a}();g.NumberMakr=h})(NumberMakr||(NumberMakr={}));var ObjectMakr;
(function(g){var h=function(){function f(a){if("undefined"===typeof a)throw Error("No settings object given to ObjectMakr.");if("undefined"===typeof a.inheritance)throw Error("No inheritance given to ObjectMakr.");this.inheritance=a.inheritance;this.properties=a.properties||{};this.doPropertiesFull=a.doPropertiesFull;this.indexMap=a.indexMap;this.onMake=a.onMake;this.functions={};this.doPropertiesFull&&(this.propertiesFull={});this.indexMap&&this.processProperties(this.properties);this.processFunctions(this.inheritance,
Object,"Object")}f.prototype.getInheritance=function(){return this.inheritance};f.prototype.getProperties=function(){return this.properties};f.prototype.getPropertiesOf=function(a){return this.properties[a]};f.prototype.getFullProperties=function(){return this.propertiesFull};f.prototype.getFullPropertiesOf=function(a){return this.doPropertiesFull?this.propertiesFull[a]:void 0};f.prototype.getFunctions=function(){return this.functions};f.prototype.getFunction=function(a){return this.functions[a]};
f.prototype.hasFunction=function(a){return this.functions.hasOwnProperty(a)};f.prototype.getIndexMap=function(){return this.indexMap};f.prototype.make=function(a,e){var c;if(!this.functions.hasOwnProperty(a))throw Error("Unknown type given to ObjectMakr: "+a);c=new this.functions[a];e&&this.proliferate(c,e);if(this.onMake&&c[this.onMake])c[this.onMake](c,a,e,(this.doPropertiesFull?this.propertiesFull:this.properties)[a]);return c};f.prototype.processProperties=function(a){for(var e in a)a.hasOwnProperty(e)&&
a[e]instanceof Array&&(a[e]=this.processPropertyArray(a[e]))};f.prototype.processPropertyArray=function(a){var e={},c;for(c=a.length-1;0<=c;--c)e[this.indexMap[c]]=a[c];return e};f.prototype.processFunctions=function(a,e,c){var b,d;for(b in a)if(a.hasOwnProperty(b)){this.functions[b]=new Function;this.functions[b].prototype=new e;this.functions[b].prototype.constructor=this.functions[b];for(d in this.properties[b])this.properties[b].hasOwnProperty(d)&&(this.functions[b].prototype[d]=this.properties[b][d]);
if(this.doPropertiesFull){this.propertiesFull[b]={};if(c)for(d in this.propertiesFull[c])this.propertiesFull[c].hasOwnProperty(d)&&(this.propertiesFull[b][d]=this.propertiesFull[c][d]);for(d in this.properties[b])this.properties[b].hasOwnProperty(d)&&(this.propertiesFull[b][d]=this.properties[b][d])}this.processFunctions(a[b],this.functions[b],b)}};f.prototype.proliferate=function(a,e,c){var b,d;for(d in e)c&&a.hasOwnProperty(d)||(b=e[d],"object"===typeof b?(a.hasOwnProperty(d)||(a[d]=new b.constructor),
this.proliferate(a[d],b,c)):a[d]=b);return a};return f}();g.ObjectMakr=h})(ObjectMakr||(ObjectMakr={}));var PixelDrawr;
(function(w){var x=function(){function c(a){if(!a)throw Error("No settings object given to PixelDrawr.");if("undefined"===typeof a.PixelRender)throw Error("No PixelRender given to PixelDrawr.");if("undefined"===typeof a.MapScreener)throw Error("No MapScreener given to PixelDrawr.");if("undefined"===typeof a.createCanvas)throw Error("No createCanvas given to PixelDrawr.");this.PixelRender=a.PixelRender;this.MapScreener=a.MapScreener;this.createCanvas=a.createCanvas;this.unitsize=a.unitsize||1;this.noRefill=
a.noRefill;this.spriteCacheCutoff=a.spriteCacheCutoff||0;this.groupNames=a.groupNames;this.framerateSkip=a.framerateSkip||1;this.framesDrawn=0;this.epsilon=a.epsilon||.007;this.keyWidth=a.keyWidth||"width";this.keyHeight=a.keyHeight||"height";this.keyTop=a.keyTop||"top";this.keyRight=a.keyRight||"right";this.keyBottom=a.keyBottom||"bottom";this.keyLeft=a.keyLeft||"left";this.keyOffsetX=a.keyOffsetX;this.keyOffsetY=a.keyOffsetY;this.generateObjectKey=a.generateObjectKey||function(a){return a.toString()};
this.resetBackground()}c.prototype.getFramerateSkip=function(){return this.framerateSkip};c.prototype.getThingArray=function(){return this.thingArrays};c.prototype.getCanvas=function(){return this.canvas};c.prototype.getContext=function(){return this.context};c.prototype.getBackgroundCanvas=function(){return this.backgroundCanvas};c.prototype.getBackgroundContext=function(){return this.backgroundContext};c.prototype.getNoRefill=function(){return this.noRefill};c.prototype.getEpsilon=function(){return this.epsilon};
c.prototype.setFramerateSkip=function(a){this.framerateSkip=a};c.prototype.setThingArrays=function(a){this.thingArrays=a};c.prototype.setCanvas=function(a){this.canvas=a;this.context=a.getContext("2d")};c.prototype.setNoRefill=function(a){this.noRefill=a};c.prototype.setEpsilon=function(a){this.epsilon=a};c.prototype.resetBackground=function(){this.backgroundCanvas=this.createCanvas(this.MapScreener[this.keyWidth],this.MapScreener[this.keyHeight]);this.backgroundContext=this.backgroundCanvas.getContext("2d")};
c.prototype.setBackground=function(a){this.backgroundContext.fillStyle=a;this.backgroundContext.fillRect(0,0,this.MapScreener[this.keyWidth],this.MapScreener[this.keyHeight])};c.prototype.drawBackground=function(){this.context.drawImage(this.backgroundCanvas,0,0)};c.prototype.setThingSprite=function(a){a.hidden||(a.sprite=this.PixelRender.decode(this.generateObjectKey(a),a),a.sprite.constructor===PixelRendr.SpriteMultiple?(a.numSprites=0,this.refillThingCanvasMultiple(a)):(a.numSprites=1,this.refillThingCanvasSingle(a)))};
c.prototype.refillGlobalCanvas=function(){this.framesDrawn+=1;if(0===this.framesDrawn%this.framerateSkip){this.noRefill||this.drawBackground();for(var a=0;a<this.thingArrays.length;a+=1)this.refillThingArray(this.thingArrays[a])}};c.prototype.refillThingArray=function(a){for(var b=0;b<a.length;b+=1)this.drawThingOnContext(this.context,a[b])};c.prototype.drawThingOnContext=function(a,b){b.hidden||b.opacity<this.epsilon||1>b[this.keyHeight]||1>b[this.keyWidth]||this.getTop(b)>this.MapScreener[this.keyHeight]||
0>this.getRight(b)||0>this.getBottom(b)||this.getLeft(b)>this.MapScreener[this.keyWidth]||("undefined"===typeof b.numSprites&&this.setThingSprite(b),0<b.canvas[this.keyWidth]?this.drawThingOnContextSingle(a,b.canvas,b,this.getLeft(b),this.getTop(b)):this.drawThingOnContextMultiple(a,b.canvases,b,this.getLeft(b),this.getTop(b)))};c.prototype.refillThingCanvasSingle=function(a){if(!(1>a[this.keyWidth]||1>a[this.keyHeight])){var b=a.canvas,d=a.context,b=d.getImageData(0,0,b[this.keyWidth],b[this.keyHeight]);
this.PixelRender.memcpyU8(a.sprite,b.data);d.putImageData(b,0,0)}};c.prototype.refillThingCanvasMultiple=function(a){if(!(1>a[this.keyWidth]||1>a[this.keyHeight])){var b=a.sprite,d=a.canvases={direction:b.direction,multiple:!0},c,e,f,g;a.numSprites=1;for(g in b.sprites)b.sprites.hasOwnProperty(g)&&(c=this.createCanvas(a.spritewidth*this.unitsize,a.spriteheight*this.unitsize),e=c.getContext("2d"),f=e.getImageData(0,0,c[this.keyWidth],c[this.keyHeight]),this.PixelRender.memcpyU8(b.sprites[g],f.data),
e.putImageData(f,0,0),d[g]={canvas:c,context:e},a.numSprites+=1);a[this.keyWidth]*a[this.keyHeight]<this.spriteCacheCutoff?(a.canvas[this.keyWidth]=a[this.keyWidth]*this.unitsize,a.canvas[this.keyHeight]=a[this.keyHeight]*this.unitsize,this.drawThingOnContextMultiple(a.context,a.canvases,a,0,0)):a.canvas[this.keyWidth]=a.canvas[this.keyHeight]=0}};c.prototype.drawThingOnContextSingle=function(a,b,d,c,e){d.repeat?this.drawPatternOnContext(a,b,c,e,d.unitwidth,d.unitheight,d.opacity||1):1!==d.opacity?
(a.globalAlpha=d.opacity,a.drawImage(b,c,e,b.width*d.scale,b.height*d.scale),a.globalAlpha=1):a.drawImage(b,c,e,b.width*d.scale,b.height*d.scale)};c.prototype.drawThingOnContextMultiple=function(a,b,d,c,e){var f=d.sprite,g=e,l=c;c+=d.unitwidth;e+=d.unitheight;var m=d.unitwidth,n=d.unitheight,t=d.spritewidthpixels,u=d.spriteheightpixels,q=Math.min(m,t),r=Math.min(n,u);d=d.opacity;var k,h,p;switch(b.direction){case "vertical":if(p=b[this.keyBottom])h=f.bottomheight?f.bottomheight*this.unitsize:u,this.drawPatternOnContext(a,
p.canvas,l,e-h,m,r,d),e-=h,n-=h;if(p=b[this.keyTop])h=f.topheight?f.topheight*this.unitsize:u,this.drawPatternOnContext(a,p.canvas,l,g,m,r,d),g+=h,n-=h;break;case "horizontal":if(p=b[this.keyLeft])k=f.leftwidth?f.leftwidth*this.unitsize:t,this.drawPatternOnContext(a,p.canvas,l,g,q,n,d),l+=k,m-=k;if(p=b[this.keyRight])k=f.rightwidth?f.rightwidth*this.unitsize:t,this.drawPatternOnContext(a,p.canvas,c-k,g,q,n,d),c-=k,m-=k;break;case "corners":h=f.topheight?f.topheight*this.unitsize:u;k=f.leftwidth?f.leftwidth*
this.unitsize:t;this.drawPatternOnContext(a,b.topLeft.canvas,l,g,q,r,d);this.drawPatternOnContext(a,b[this.keyLeft].canvas,l,g+h,q,n-2*h,d);this.drawPatternOnContext(a,b.bottomLeft.canvas,l,e-h,q,r,d);l+=k;m-=k;k=f.rightwidth?f.rightwidth*this.unitsize:t;this.drawPatternOnContext(a,b[this.keyTop].canvas,l,g,m-k,r,d);this.drawPatternOnContext(a,b.topRight.canvas,c-k,g,q,r,d);g+=h;n-=h;h=f.bottomheight?f.bottomheight*this.unitsize:u;this.drawPatternOnContext(a,b[this.keyRight].canvas,c-k,g,q,n-h,d);
this.drawPatternOnContext(a,b.bottomRight.canvas,c-k,e-h,q,r,d);this.drawPatternOnContext(a,b[this.keyBottom].canvas,l,e-h,m-k,r,d);c-=k;m-=k;e-=h;n-=h;break;default:throw Error("Unknown or missing direction given in SpriteMultiple.");}(p=b.middle)&&g<e&&l<c&&(f.middleStretch?(a.globalAlpha=d,a.drawImage(p.canvas,l,g,m,n),a.globalAlpha=1):this.drawPatternOnContext(a,p.canvas,l,g,m,n,d))};c.prototype.getTop=function(a){return this.keyOffsetY?a[this.keyTop]+a[this.keyOffsetY]:a[this.keyTop]};c.prototype.getRight=
function(a){return this.keyOffsetX?a[this.keyRight]+a[this.keyOffsetX]:a[this.keyRight]};c.prototype.getBottom=function(a){return this.keyOffsetX?a[this.keyBottom]+a[this.keyOffsetY]:a[this.keyBottom]};c.prototype.getLeft=function(a){return this.keyOffsetX?a[this.keyLeft]+a[this.keyOffsetX]:a[this.keyLeft]};c.prototype.drawPatternOnContext=function(a,b,c,v,e,f,g){a.globalAlpha=g;a.translate(c,v);a.fillStyle=a.createPattern(b,"repeat");a.fillRect(0,0,e,f);a.translate(-c,-v);a.globalAlpha=1};return c}();
w.PixelDrawr=x})(PixelDrawr||(PixelDrawr={}));var PixelRendr;(function(k){var m=function(){return function(f,a){var d=a.source[2];this.sprites=f;this.direction=a.source[1];if("vertical"===this.direction||"corners"===this.direction)this.topheight=d.topheight|0,this.bottomheight=d.bottomheight|0;if("horizontal"===this.direction||"corners"===this.direction)this.rightwidth=d.rightwidth|0,this.leftwidth=d.leftwidth|0;this.middleStretch=d.middleStretch||!1}}();k.SpriteMultiple=m})(PixelRendr||(PixelRendr={}));
(function(k){var m=function(){return function(f,a){this.source=f;this.filter=a;this.sprites={};this.containers=[]}}();k.Render=m})(PixelRendr||(PixelRendr={}));
(function(k){var m=function(){function f(a){if(!a)throw Error("No settings given to PixelRendr.");if(!a.paletteDefault)throw Error("No paletteDefault given to PixelRendr.");this.paletteDefault=a.paletteDefault;this.digitsizeDefault=this.getDigitSizeFromArray(this.paletteDefault);this.digitsplit=new RegExp(".{1,"+this.digitsizeDefault+"}","g");this.library={raws:a.library||{}};this.scale=a.scale||1;this.filters=a.filters||{};this.flipVert=a.flipVert||"flip-vert";this.flipHoriz=a.flipHoriz||"flip-horiz";
this.spriteWidth=a.spriteWidth||"spriteWidth";this.spriteHeight=a.spriteHeight||"spriteHeight";this.Uint8ClampedArray=a.Uint8ClampedArray||window.Uint8ClampedArray||window.Uint8Array;this.ProcessorBase=new ChangeLinr.ChangeLinr({transforms:{spriteUnravel:this.spriteUnravel.bind(this),spriteApplyFilter:this.spriteApplyFilter.bind(this),spriteExpand:this.spriteExpand.bind(this),spriteGetArray:this.spriteGetArray.bind(this)},pipeline:["spriteUnravel","spriteApplyFilter","spriteExpand","spriteGetArray"]});
this.ProcessorDims=new ChangeLinr.ChangeLinr({transforms:{spriteRepeatRows:this.spriteRepeatRows.bind(this),spriteFlipDimensions:this.spriteFlipDimensions.bind(this)},pipeline:["spriteRepeatRows","spriteFlipDimensions"]});this.ProcessorEncode=new ChangeLinr.ChangeLinr({transforms:{imageGetData:this.imageGetData.bind(this),imageGetPixels:this.imageGetPixels.bind(this),imageMapPalette:this.imageMapPalette.bind(this),imageCombinePixels:this.imageCombinePixels.bind(this)},pipeline:["imageGetData","imageGetPixels",
"imageMapPalette","imageCombinePixels"],doUseCache:!1});this.library.sprites=this.libraryParse(this.library.raws);this.BaseFiler=new StringFilr.StringFilr({library:this.library.sprites,normal:"normal"});this.commandGenerators={multiple:this.generateSpriteCommandMultipleFromRender.bind(this),same:this.generateSpriteCommandSameFromRender.bind(this),filter:this.generateSpriteCommandFilterFromRender.bind(this)}}f.prototype.getBaseLibrary=function(){return this.BaseFiler.getLibrary()};f.prototype.getBaseFiler=
function(){return this.BaseFiler};f.prototype.getProcessorBase=function(){return this.ProcessorBase};f.prototype.getProcessorDims=function(){return this.ProcessorDims};f.prototype.getProcessorEncode=function(){return this.ProcessorEncode};f.prototype.getSpriteBase=function(a){return this.BaseFiler.get(a)};f.prototype.decode=function(a,d){var c=this.BaseFiler.get(a);if(!c)throw Error("No sprite found for "+a+".");c.sprites.hasOwnProperty(a)||this.generateRenderSprite(c,a,d);c=c.sprites[a];if(!c||c.constructor===
this.Uint8ClampedArray&&0===c.length)throw Error("Could not generate sprite for "+a+".");return c};f.prototype.encode=function(a,d){for(var c=[],b=2;b<arguments.length;b++)c[b-2]=arguments[b];b=this.ProcessorEncode.process(a);d&&d.apply(void 0,[b,a].concat(c));return b};f.prototype.encodeUri=function(a,d){var c=document.createElement("img");c.onload=this.encode.bind(this,c,d);c.src=a};f.prototype.generatePaletteFromRawData=function(a,d,c){var b={},h=[],g=[],e;for(e=0;e<a.length;e+=4)0===a[e+3]?d=
!0:b[a[e]]&&b[a[e]][a[e+1]]&&b[a[e]][a[e+1]][a[e+2]]&&b[a[e]][a[e+1]][a[e+2]][a[e+3]]||(b[a[e]]||(b[a[e]]={}),b[a[e]][a[e+1]]||(b[a[e]][a[e+1]]={}),b[a[e]][a[e+1]][a[e+2]]||(b[a[e]][a[e+1]][a[e+2]]={}),b[a[e]][a[e+1]][a[e+2]][a[e+3]]||(b[a[e]][a[e+1]][a[e+2]][a[e+3]]=!0,a[e]===a[e+1]&&a[e+1]===a[e+2]?g.push(a.subarray(e,e+4)):h.push(a.subarray(e,e+4))));g.sort(function(a,b){return a[0]-b[0]});h.sort(function(a,b){for(e=0;4>e;e+=1)if(a[e]!==b[e])return b[e]-a[e]});a=d?[new this.Uint8ClampedArray([0,
0,0,0])].concat(g).concat(h):g.concat(h);if(!c)return a;for(e=0;e<a.length;e+=1)a[e]=Array.prototype.slice.call(a[e]);return a};f.prototype.memcpyU8=function(a,d,c,b,h){void 0===c&&(c=0);void 0===b&&(b=0);void 0===h&&(h=Math.max(0,Math.min(a.length,d.length)));h+=0;b+=0;for(c+=0;h--;)d[b++]=a[c++]};f.prototype.libraryParse=function(a){var d={},c,b;for(b in a)if(a.hasOwnProperty(b)){c=a[b];switch(c.constructor){case String:d[b]=new k.Render(c);break;case Array:d[b]=new k.Render(c,c[1]);break;default:d[b]=
this.libraryParse(c)}d[b].constructor===k.Render&&d[b].containers.push({container:d,key:b})}return d};f.prototype.generateRenderSprite=function(a,d,c){c=a.source.constructor===String?this.generateSpriteSingleFromRender(a,d,c):this.commandGenerators[a.source[0]](a,d,c);a.sprites[d]=c};f.prototype.generateSpriteSingleFromRender=function(a,d,c){a=this.ProcessorBase.process(a.source,d,a.filter);return this.ProcessorDims.process(a,d,c)};f.prototype.generateSpriteCommandMultipleFromRender=function(a,d,
c){var b=a.source[2],h={},g,e,f=new k.SpriteMultiple(h,a),l;for(l in b)b.hasOwnProperty(l)&&(e=d+" "+l,g=this.ProcessorBase.process(b[l],e,a.filter),h[l]=this.ProcessorDims.process(g,e,c));return f};f.prototype.generateSpriteCommandSameFromRender=function(a,d,c){var b=this.followPath(this.library.sprites,a.source[1],0);this.replaceRenderInContainers(a,b);this.BaseFiler.clearCached(d);return this.decode(d,c)};f.prototype.generateSpriteCommandFilterFromRender=function(a,d,c){var b=this.filters[a.source[2]],
h=this.followPath(this.library.sprites,a.source[1],0);b||console.warn("Invalid filter provided: "+a.source[2]);h.constructor===k.Render?(b=new k.Render(h.source,{filter:b}),this.generateRenderSprite(b,d,c)):b=this.generateRendersFromFilter(h,b);this.replaceRenderInContainers(a,b);if(b.constructor===k.Render)return b.sprites[d];this.BaseFiler.clearCached(d);return this.decode(d,c)};f.prototype.generateRendersFromFilter=function(a,d){var c={},b,h;for(h in a)a.hasOwnProperty(h)&&(b=a[h],c[h]=b.constructor===
k.Render?new k.Render(b.source,{filter:d}):this.generateRendersFromFilter(b,d));return c};f.prototype.replaceRenderInContainers=function(a,d){var c,b;for(b=0;b<a.containers.length;b+=1)c=a.containers[b],c.container[c.key]=d,d.constructor===k.Render&&d.containers.push(c)};f.prototype.spriteUnravel=function(a){var d=this.getPaletteReferenceStarting(this.paletteDefault),c=this.digitsizeDefault,b=a.length,h,g,e,f="";for(g=0;g<b;)switch(a[g]){case "x":e=a.indexOf(",",++g);h=this.makeDigit(d[a.slice(g,
g+=c)],this.digitsizeDefault);for(g=Number(a.slice(g,e));g--;)f+=h;g=e+1;break;case "p":"["===a[++g]?(e=a.indexOf("]"),d=this.getPaletteReference(a.slice(g+1,e).split(",")),g=e+1,c=this.getDigitSizeFromObject(d)):(d=this.getPaletteReference(this.paletteDefault),c=this.digitsizeDefault);break;default:f+=this.makeDigit(d[a.slice(g,g+=c)],this.digitsizeDefault)}return f};f.prototype.spriteExpand=function(a){for(var d="",c=a.length,b=0,h,g;b<c;)for(g=a.slice(b,b+=this.digitsizeDefault),h=0;h<this.scale;++h)d+=
g;return d};f.prototype.spriteApplyFilter=function(a,d,c){if(!c||!c.filter)return a;d=c.filter;c=d[0];if(!c)return a;switch(c){case "palette":a=a.match(this.digitsplit);for(var b in d[1])d[1].hasOwnProperty(b)&&this.arrayReplace(a,b,d[1][b]);return a.join("");default:console.warn("Unknown filter: '"+c+"'.")}return a};f.prototype.spriteGetArray=function(a){var d=a.length/this.digitsizeDefault;a=a.match(this.digitsplit);var c=new this.Uint8ClampedArray(4*d),b,h,g,e;for(g=h=0;h<d;++h){b=this.paletteDefault[Number(a[h])];
for(e=0;4>e;++e)c[g+e]=b[e];g+=4}return c};f.prototype.spriteRepeatRows=function(a,d,c){d=new this.Uint8ClampedArray(a.length*this.scale);var b=4*c[this.spriteWidth];c=c[this.spriteHeight]/this.scale;var h=0,g=0,e,f;for(e=0;e<c;++e){for(f=0;f<this.scale;++f)this.memcpyU8(a,d,h,g,b),g+=b;h+=b}return d};f.prototype.spriteFlipDimensions=function(a,d,c){return-1!==d.indexOf(this.flipHoriz)?-1!==d.indexOf(this.flipVert)?this.flipSpriteArrayBoth(a):this.flipSpriteArrayHoriz(a,c):-1!==d.indexOf(this.flipVert)?
this.flipSpriteArrayVert(a,c):a};f.prototype.flipSpriteArrayHoriz=function(a,d){var c=a.length+0,b=d[this.spriteWidth]+0,h=new this.Uint8ClampedArray(c),b=4*b,g,e,f,l,k;for(f=0;f<c;f+=b)for(g=f,e=f+b-4,l=0;l<b;l+=4){for(k=0;4>k;++k)h[g+k]=a[e+k];g+=4;e-=4}return h};f.prototype.flipSpriteArrayVert=function(a,d){for(var c=a.length,b=d[this.spriteWidth]+0,f=new this.Uint8ClampedArray(c),b=4*b,g=0,e=c-b,k,l;g<c;){for(k=0;k<b;k+=4)for(l=0;4>l;++l)f[g+k+l]=a[e+k+l];g+=b;e-=b}return f};f.prototype.flipSpriteArrayBoth=
function(a){for(var d=a.length,c=new this.Uint8ClampedArray(d),b=a.length-4,f=0,g;f<d;){for(g=0;4>g;++g)c[f+g]=a[b+g];f+=4;b-=4}return c};f.prototype.imageGetData=function(a){var d=document.createElement("canvas"),c=d.getContext("2d");d.width=a.width;d.height=a.height;c.drawImage(a,0,0);return c.getImageData(0,0,a.width,a.height).data};f.prototype.imageGetPixels=function(a){var d=Array(a.length/4),c={},b,f,g;for(g=f=0;f<a.length;f+=4,g+=1)b=this.getClosestInPalette(this.paletteDefault,a.subarray(f,
f+4)),d[g]=b,c.hasOwnProperty(b)?c[b]+=1:c[b]=1;return[d,c]};f.prototype.imageMapPalette=function(a){var d=a[0];a=Object.keys(a[1]);var c=this.getDigitSizeFromArray(a),b=this.getValueIndices(a),d=d.map(function(a){return b[a]});return[a,d,c]};f.prototype.imageCombinePixels=function(a){var d=a[1],c=a[2],b=Math.max(3,Math.round(4/c)),f,g,e=0,k;for(a="p["+a[0].map(this.makeSizedDigit.bind(this,c)).join(",")+"]";e<d.length;){k=e+1;f=d[e];for(g=this.makeDigit(f,c);f===d[k];)k+=1;if(k-e>b)a+="x"+g+String(k-
e)+",",e=k;else{do a+=g,e+=1;while(e<k)}}return a};f.prototype.getDigitSizeFromArray=function(a){var d=0;for(a=a.length;1<=a;a/=10)d+=1;return d};f.prototype.getDigitSizeFromObject=function(a){return this.getDigitSizeFromArray(Object.keys(a))};f.prototype.getPaletteReference=function(a){var d={},c=this.getDigitSizeFromArray(a),b;for(b=0;b<a.length;b+=1)d[this.makeDigit(b,c)]=this.makeDigit(a[b],c);return d};f.prototype.getPaletteReferenceStarting=function(a){var d={},c,b;for(b=0;b<a.length;b+=1)c=
this.makeDigit(b,this.digitsizeDefault),d[c]=c;return d};f.prototype.getClosestInPalette=function(a,d){var c=Infinity,b,f,g;for(g=a.length-1;0<=g;--g)b=this.arrayDifference(a[g],d),b<c&&(c=b,f=g);return f};f.prototype.stringOf=function(a,d){return 0===d?"":Array(1+(d||1)).join(a)};f.prototype.makeDigit=function(a,d,c){void 0===c&&(c="0");return this.stringOf(c,Math.max(0,d-String(a).length))+a};f.prototype.makeSizedDigit=function(a,d){return this.makeDigit(d,a,"0")};f.prototype.arrayReplace=function(a,
d,c){for(var b=0;b<a.length;b+=1)a[b]===d&&(a[b]=c);return a};f.prototype.arrayDifference=function(a,d){var c=0,b;for(b=a.length-1;0<=b;--b)c+=Math.abs(a[b]-d[b])|0;return c};f.prototype.getValueIndices=function(a){var d={},c;for(c=0;c<a.length;c+=1)d[a[c]]=c;return d};f.prototype.followPath=function(a,d,c){return c<d.length&&a.hasOwnProperty(d[c])?this.followPath(a[d[c]],d,c+1):a};return f}();k.PixelRendr=m})(PixelRendr||(PixelRendr={}));var QuadsKeepr;
(function(g){var h=function(){function e(a){if(!a)throw Error("No settings object given to QuadsKeepr.");if(!a.ObjectMaker)throw Error("No ObjectMaker given to QuadsKeepr.");if(!a.numRows)throw Error("No numRows given to QuadsKeepr.");if(!a.numCols)throw Error("No numCols given to QuadsKeepr.");if(!a.quadrantWidth)throw Error("No quadrantWidth given to QuadsKeepr.");if(!a.quadrantHeight)throw Error("No quadrantHeight given to QuadsKeepr.");if(!a.groupNames)throw Error("No groupNames given to QuadsKeepr.");this.ObjectMaker=
a.ObjectMaker;this.numRows=a.numRows|0;this.numCols=a.numCols|0;this.quadrantWidth=a.quadrantWidth|0;this.quadrantHeight=a.quadrantHeight|0;this.groupNames=a.groupNames;this.onAdd=a.onAdd;this.onRemove=a.onRemove;this.startLeft=a.startLeft|0;this.startTop=a.startTop|0;this.keyTop=a.keyTop||"top";this.keyLeft=a.keyLeft||"left";this.keyBottom=a.keyBottom||"bottom";this.keyRight=a.keyRight||"right";this.keyNumQuads=a.keyNumQuads||"numquads";this.keyQuadrants=a.keyQuadrants||"quadrants";this.keyChanged=
a.keyChanged||"changed";this.keyToleranceX=a.keyToleranceX||"tolx";this.keyToleranceY=a.keyToleranceY||"toly";this.keyGroupName=a.keyGroupName||"group";this.keyOffsetX=a.keyOffsetX;this.keyOffsetY=a.keyOffsetY}e.prototype.getQuadrantRows=function(){return this.quadrantRows};e.prototype.getQuadrantCols=function(){return this.quadrantCols};e.prototype.getNumRows=function(){return this.numRows};e.prototype.getNumCols=function(){return this.numCols};e.prototype.getQuadrantWidth=function(){return this.quadrantWidth};
e.prototype.getQuadrantHeight=function(){return this.quadrantHeight};e.prototype.resetQuadrants=function(){var a=this.startLeft,b=this.startTop,c,d,e;this.top=this.startTop;this.right=this.startLeft+this.quadrantWidth*this.numCols;this.bottom=this.startTop+this.quadrantHeight*this.numRows;this.left=this.startLeft;this.quadrantRows=[];this.quadrantCols=[];for(d=this.offsetY=this.offsetX=0;d<this.numRows;d+=1)this.quadrantRows.push({left:this.startLeft,top:b,quadrants:[]}),b+=this.quadrantHeight;for(e=
0;e<this.numCols;e+=1)this.quadrantCols.push({left:a,top:this.startTop,quadrants:[]}),a+=this.quadrantWidth;b=this.startTop;for(d=0;d<this.numRows;d+=1){a=this.startLeft;for(e=0;e<this.numCols;e+=1)c=this.createQuadrant(a,b),this.quadrantRows[d].quadrants.push(c),this.quadrantCols[e].quadrants.push(c),a+=this.quadrantWidth;b+=this.quadrantHeight}if(this.onAdd)this.onAdd("xInc",this.top,this.right,this.bottom,this.left)};e.prototype.shiftQuadrants=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
var c,d;a|=0;b|=0;this.offsetX+=a;this.offsetY+=b;this.top+=b;this.right+=a;this.bottom+=b;this.left+=a;for(c=0;c<this.numRows;c+=1)this.quadrantRows[c].left+=a,this.quadrantRows[c].top+=b;for(d=0;d<this.numCols;d+=1)this.quadrantCols[d].left+=a,this.quadrantCols[d].top+=b;for(c=0;c<this.numRows;c+=1)for(d=0;d<this.numCols;d+=1)this.shiftQuadrant(this.quadrantRows[c].quadrants[d],a,b);this.adjustOffsets()};e.prototype.pushQuadrantRow=function(a){var b=this.createQuadrantRow(this.left,this.bottom),
c;this.numRows+=1;this.quadrantRows.push(b);for(c=0;c<this.quadrantCols.length;c+=1)this.quadrantCols[c].quadrants.push(b.quadrants[c]);this.bottom+=this.quadrantHeight;if(a&&this.onAdd)this.onAdd("yInc",this.bottom,this.right,this.bottom-this.quadrantHeight,this.left);return b};e.prototype.pushQuadrantCol=function(a){var b=this.createQuadrantCol(this.right,this.top),c;this.numCols+=1;this.quadrantCols.push(b);for(c=0;c<this.quadrantRows.length;c+=1)this.quadrantRows[c].quadrants.push(b.quadrants[c]);
this.right+=this.quadrantWidth;if(a&&this.onAdd)this.onAdd("xInc",this.top,this.right-this.offsetY,this.bottom,this.right-this.quadrantWidth-this.offsetY);return b};e.prototype.popQuadrantRow=function(a){for(var b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.pop();--this.numRows;this.quadrantRows.pop();if(a&&this.onRemove)this.onRemove("yInc",this.bottom,this.right,this.bottom-this.quadrantHeight,this.left);this.bottom-=this.quadrantHeight};e.prototype.popQuadrantCol=function(a){for(var b=
0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.pop();--this.numCols;this.quadrantCols.pop();if(a&&this.onRemove)this.onRemove("xDec",this.top,this.right-this.offsetY,this.bottom,this.right-this.quadrantWidth-this.offsetY);this.right-=this.quadrantWidth};e.prototype.unshiftQuadrantRow=function(a){var b=this.createQuadrantRow(this.left,this.top-this.quadrantHeight),c;this.numRows+=1;this.quadrantRows.unshift(b);for(c=0;c<this.quadrantCols.length;c+=1)this.quadrantCols[c].quadrants.unshift(b.quadrants[c]);
this.top-=this.quadrantHeight;if(a&&this.onAdd)this.onAdd("yDec",this.top,this.right,this.top+this.quadrantHeight,this.left);return b};e.prototype.unshiftQuadrantCol=function(a){var b=this.createQuadrantCol(this.left-this.quadrantWidth,this.top),c;this.numCols+=1;this.quadrantCols.unshift(b);for(c=0;c<this.quadrantRows.length;c+=1)this.quadrantRows[c].quadrants.unshift(b.quadrants[c]);this.left-=this.quadrantWidth;if(a&&this.onAdd)this.onAdd("xDec",this.top,this.left,this.bottom,this.left+this.quadrantWidth);
return b};e.prototype.shiftQuadrantRow=function(a){for(var b=0;b<this.quadrantCols.length;b+=1)this.quadrantCols[b].quadrants.shift();--this.numRows;this.quadrantRows.pop();if(a&&this.onRemove)this.onRemove("yInc",this.top,this.right,this.top+this.quadrantHeight,this.left);this.top+=this.quadrantHeight};e.prototype.shiftQuadrantCol=function(a){for(var b=0;b<this.quadrantRows.length;b+=1)this.quadrantRows[b].quadrants.shift();--this.numCols;this.quadrantCols.pop();if(a&&this.onRemove)this.onRemove("xInc",
this.top,this.left+this.quadrantWidth,this.bottom,this.left);this.left+=this.quadrantWidth};e.prototype.determineAllQuadrants=function(a,b){var c,d;for(c=0;c<this.numRows;c+=1)for(d=0;d<this.numCols;d+=1)this.quadrantRows[c].quadrants[d].numthings[a]=0;b.forEach(this.determineThingQuadrants.bind(this))};e.prototype.determineThingQuadrants=function(a){var b=a[this.keyGroupName],c=this.findQuadrantRowStart(a),d=this.findQuadrantColStart(a),e=this.findQuadrantRowEnd(a),g=this.findQuadrantColEnd(a),f;
a[this.keyChanged]&&this.markThingQuadrantsChanged(a);for(a[this.keyNumQuads]=0;c<=e;c+=1)for(f=d;f<=g;f+=1)this.setThingInQuadrant(a,this.quadrantRows[c].quadrants[f],b);a[this.keyChanged]=!1};e.prototype.setThingInQuadrant=function(a,b,c){a[this.keyQuadrants][a[this.keyNumQuads]]=b;a[this.keyNumQuads]+=1;b.things[c][b.numthings[c]]=a;b.numthings[c]+=1;a[this.keyChanged]&&(b[this.keyChanged]=!0)};e.prototype.adjustOffsets=function(){for(;-this.offsetX>this.quadrantWidth;)this.shiftQuadrantCol(!0),
this.pushQuadrantCol(!0),this.offsetX+=this.quadrantWidth;for(;this.offsetX>this.quadrantWidth;)this.popQuadrantCol(!0),this.unshiftQuadrantCol(!0),this.offsetX-=this.quadrantWidth;for(;-this.offsetY>this.quadrantHeight;)this.unshiftQuadrantRow(!0),this.pushQuadrantRow(!0),this.offsetY+=this.quadrantHeight;for(;this.offsetY>this.quadrantHeight;)this.popQuadrantRow(!0),this.unshiftQuadrantRow(!0),this.offsetY-=this.quadrantHeight};e.prototype.shiftQuadrant=function(a,b,c){a.top+=c;a.right+=b;a.bottom+=
c;a.left+=b;a[this.keyChanged]=!0};e.prototype.createQuadrant=function(a,b){var c=this.ObjectMaker.make("Quadrant"),d;c[this.keyChanged]=!0;c.things={};c.numthings={};for(d=0;d<this.groupNames.length;d+=1)c.things[this.groupNames[d]]=[],c.numthings[this.groupNames[d]]=0;c.left=a;c.top=b;c.right=a+this.quadrantWidth;c.bottom=b+this.quadrantHeight;return c};e.prototype.createQuadrantRow=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);var c={left:a,top:b,quadrants:[]},d;for(d=0;d<this.numCols;d+=1)c.quadrants.push(this.createQuadrant(a,
b)),a+=this.quadrantWidth;return c};e.prototype.createQuadrantCol=function(a,b){var c={left:a,top:b,quadrants:[]},d;for(d=0;d<this.numRows;d+=1)c.quadrants.push(this.createQuadrant(a,b)),b+=this.quadrantHeight;return c};e.prototype.getTop=function(a){return this.keyOffsetY?a[this.keyTop]-Math.abs(a[this.keyOffsetY]):a[this.keyTop]};e.prototype.getRight=function(a){return this.keyOffsetX?a[this.keyRight]+Math.abs(a[this.keyOffsetX]):a[this.keyRight]};e.prototype.getBottom=function(a){return this.keyOffsetX?
a[this.keyBottom]+Math.abs(a[this.keyOffsetY]):a[this.keyBottom]};e.prototype.getLeft=function(a){return this.keyOffsetX?a[this.keyLeft]-Math.abs(a[this.keyOffsetX]):a[this.keyLeft]};e.prototype.markThingQuadrantsChanged=function(a){for(var b=0;b<a[this.keyNumQuads];b+=1)a[this.keyQuadrants][b][this.keyChanged]=!0};e.prototype.findQuadrantRowStart=function(a){return Math.max(Math.floor((this.getTop(a)-this.top)/this.quadrantHeight),0)};e.prototype.findQuadrantRowEnd=function(a){return Math.min(Math.floor((this.getBottom(a)-
this.top)/this.quadrantHeight),this.numRows-1)};e.prototype.findQuadrantColStart=function(a){return Math.max(Math.floor((this.getLeft(a)-this.left)/this.quadrantWidth),0)};e.prototype.findQuadrantColEnd=function(a){return Math.min(Math.floor((this.getRight(a)-this.left)/this.quadrantWidth),this.numCols-1)};return e}();g.QuadsKeepr=h})(QuadsKeepr||(QuadsKeepr={}));var ScenePlayr;
(function(f){var g=function(){function a(b){void 0===b&&(b={});this.cutscenes=b.cutscenes||{};this.cutsceneArguments=b.cutsceneArguments||[]}a.prototype.getCutscenes=function(){return this.cutscenes};a.prototype.getCutscene=function(){return this.cutscene};a.prototype.getOtherCutscene=function(b){return this.cutscenes[b]};a.prototype.getRoutine=function(){return this.routine};a.prototype.getOtherRoutine=function(b){return this.cutscene.routines[b]};a.prototype.getCutsceneName=function(){return this.cutsceneName};a.prototype.getCutsceneSettings=
function(){return this.cutsceneSettings};a.prototype.addCutsceneSetting=function(b,a){this.cutsceneSettings[b]=a};a.prototype.startCutscene=function(b,a,c){void 0===a&&(a={});if(!b)throw Error("No name given to ScenePlayr.playScene.");this.cutsceneName&&this.stopCutscene();this.cutscene=this.cutscenes[b];this.cutsceneName=b;this.cutsceneSettings=a||{};this.cutsceneSettings.cutscene=this.cutscene;this.cutsceneSettings.cutsceneName=b;this.cutsceneArguments.push(this.cutsceneSettings);this.cutscene.firstRoutine&&
this.playRoutine.apply(this,[this.cutscene.firstRoutine].concat(c))};a.prototype.bindCutscene=function(b,a,c){return this.startCutscene.bind(this,b,c)};a.prototype.stopCutscene=function(){this.cutsceneSettings=this.cutsceneName=this.cutscene=this.routine=void 0;this.cutsceneArguments.pop()};a.prototype.playRoutine=function(b){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];if(!this.cutscene)throw Error("No cutscene is currently playing.");if(!this.cutscene.routines[b])throw Error("The "+
this.cutsceneName+" cutscene does not contain a "+b+" routine.");c=this.cutsceneArguments.slice();c.push.apply(c,a);this.routine=this.cutscene.routines[b];this.cutsceneSettings.routine=this.routine;this.cutsceneSettings.routineName=b;this.cutsceneSettings.routineArguments=a;this.routine.apply(this,c)};a.prototype.bindRoutine=function(a){for(var d=[],c=1;c<arguments.length;c++)d[c-1]=arguments[c];return(e=this.playRoutine).bind.apply(e,[this,a].concat(d));var e};return a}();f.ScenePlayr=g})(ScenePlayr||
(ScenePlayr={}));var StringFilr;
(function(f){var g=function(){function b(a){if(!a)throw Error("No settings given to StringFilr.");if(!a.library)throw Error("No library given to StringFilr.");this.library=a.library;this.normal=a.normal;this.requireNormalKey=a.requireNormalKey;this.cache={};if(this.requireNormalKey){if("undefined"===typeof this.normal)throw Error("StringFilr is given requireNormalKey, but no normal class.");this.ensureLibraryNormal()}}b.prototype.getLibrary=function(){return this.library};b.prototype.getNormal=function(){return this.normal};
b.prototype.getCache=function(){return this.cache};b.prototype.getCached=function(a){return this.cache[a]};b.prototype.clearCache=function(){this.cache={}};b.prototype.clearCached=function(a){delete this.cache[a];this.normal&&delete this.cache[a.replace(this.normal,"")]};b.prototype.get=function(a){var c,b;c=this.normal?a.replace(this.normal,""):a;if(this.cache.hasOwnProperty(c))return this.cache[c];b=this.followClass(c.split(/\s+/g),this.library);return this.cache[c]=this.cache[a]=b};b.prototype.followClass=
function(a,c){var b,d;if(!a||!a.length)return c;for(d=0;d<a.length;d+=1)if(b=a[d],c.hasOwnProperty(b))return a.splice(d,1),this.followClass(a,c[b]);return this.normal&&c.hasOwnProperty(this.normal)?this.followClass(a,c[this.normal]):c};b.prototype.findLackingNormal=function(a,b,e){var d;a.hasOwnProperty(this.normal)||e.push(b);if("object"===typeof a[d])for(d in a)a.hasOwnProperty(d)&&this.findLackingNormal(a[d],b+" "+d,e);return e};b.prototype.ensureLibraryNormal=function(){var a=this.findLackingNormal(this.library,
"base",[]);if(a.length)throw Error("Found "+a.length+" library sub-directories missing the normal: \r\n  "+a.join("\r\n  "));};return b}();f.StringFilr=g})(StringFilr||(StringFilr={}));var ThingHittr;
(function(ThingHittr_1){var ThingHittr=function(){function ThingHittr(settings){if(typeof settings==="undefined")throw new Error("No settings object given to ThingHittr.");if(typeof settings.globalCheckGenerators==="undefined")throw new Error("No globalCheckGenerators given to ThingHittr.");if(typeof settings.hitCheckGenerators==="undefined")throw new Error("No hitCheckGenerators given to ThingHittr.");if(typeof settings.hitCallbackGenerators==="undefined")throw new Error("No hitCallbackGenerators given to ThingHittr.");this.keyNumQuads=
settings.keyNumQuads||"numquads";this.keyQuadrants=settings.keyQuadrants||"quadrants";this.keyGroupName=settings.keyGroupName||"group";this.keyTypeName=settings.keyTypeName||"type";this.globalCheckGenerators=settings.globalCheckGenerators;this.hitCheckGenerators=settings.hitCheckGenerators;this.hitCallbackGenerators=settings.hitCallbackGenerators;this.generatedHitChecks={};this.generatedHitCallbacks={};this.generatedGlobalChecks={};this.generatedHitsChecks={};this.groupHitLists=this.generateGroupHitLists(this.hitCheckGenerators)}
ThingHittr.prototype.cacheChecksForType=function(typeName,groupName){if(!this.generatedGlobalChecks.hasOwnProperty(typeName)&&this.globalCheckGenerators.hasOwnProperty(groupName)){this.generatedGlobalChecks[typeName]=this.globalCheckGenerators[groupName]();this.generatedHitsChecks[typeName]=this.generateHitsCheck(typeName)}};ThingHittr.prototype.checkHitsForThing=function(thing){this.generatedHitsChecks[thing[this.keyTypeName]](thing)};ThingHittr.prototype.checkHitForThings=function(thing,other){return this.runThingsFunctionSafely(this.generatedHitChecks,
thing,other,this.hitCheckGenerators)};ThingHittr.prototype.runHitCallbackForThings=function(thing,other){this.runThingsFunctionSafely(this.generatedHitCallbacks,thing,other,this.hitCallbackGenerators)};ThingHittr.prototype.generateHitsCheck=function(typeName){var _this=this;return function(thing){if(!_this.generatedGlobalChecks[typeName](thing))return;var groupNames=_this.groupHitLists[thing[_this.keyGroupName]],groupName,others,other,i,j,k;for(i=0;i<thing[_this.keyNumQuads];i+=1)for(j=0;j<groupNames.length;j+=
1){groupName=groupNames[j];others=thing[_this.keyQuadrants][i].things[groupName];for(k=0;k<others.length;k+=1){other=others[k];if(thing===other)break;if(!_this.generatedGlobalChecks[other[_this.keyTypeName]](other))continue;if(_this.checkHitForThings(thing,other))_this.runHitCallbackForThings(thing,other)}}}};ThingHittr.prototype.runThingsFunctionSafely=function(group,thing,other,generators){var typeThing=thing[this.keyTypeName],typeOther=other[this.keyTypeName],container=group[typeThing],check;if(!container)container=
group[typeThing]={};check=container[typeOther];if(!check)check=container[typeOther]=generators[thing[this.keyGroupName]][other[this.keyGroupName]]();return check(thing,other)};ThingHittr.prototype.generateGroupHitLists=function(group){var output={},i;for(i in group)if(group.hasOwnProperty(i))output[i]=Object.keys(group[i]);return output};return ThingHittr}();ThingHittr_1.ThingHittr=ThingHittr})(ThingHittr||(ThingHittr={}));var TimeHandlr;(function(f){var g=function(){function c(a,b,d,h,e){this.count=0;this.callback=a;this.repeat=b;this.timeRepeat=h;this.time=d+c.runCalculator(h,this);this.args=e}c.runCalculator=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];return a.constructor===Number?a:a.apply(void 0,b)};c.prototype.scheduleNextRepeat=function(){return this.time+=c.runCalculator(this.timeRepeat)};return c}();f.TimeEvent=g})(TimeHandlr||(TimeHandlr={}));
(function(f){var g=function(){function c(a){void 0===a&&(a={});this.time=0;this.events={};this.timingDefault=a.timingDefault||1;this.keyCycles=a.keyCycles||"cycles";this.keyClassName=a.keyClassName||"className";this.keyOnClassCycleStart=a.keyOnClassCycleStart||"onClassCycleStart";this.keyDoClassCycleStart=a.keyDoClassCycleStart||"doClassCycleStart";this.keyCycleCheckValidity=a.keyCycleCheckValidity;this.copyCycleSettings="undefined"===typeof a.copyCycleSettings?!0:a.copyCycleSettings;this.classAdd=
a.classAdd||this.classAddGeneric;this.classRemove=a.classRemove||this.classRemoveGeneric}c.prototype.getTime=function(){return this.time};c.prototype.getEvents=function(){return this.events};c.prototype.addEvent=function(a,b){for(var d=[],c=2;c<arguments.length;c++)d[c-2]=arguments[c];d=new f.TimeEvent(a,1,this.time,b||1,d);this.insertEvent(d);return d};c.prototype.addEventInterval=function(a,b,d){for(var c=[],e=3;e<arguments.length;e++)c[e-3]=arguments[e];c=new f.TimeEvent(a,d||1,this.time,b||1,
c);this.insertEvent(c);return c};c.prototype.addEventIntervalSynched=function(a,b,d){for(var c=[],e=3;e<arguments.length;e++)c[e-3]=arguments[e];b=b||1;d=d||1;e=f.TimeEvent.runCalculator(b||this.timingDefault);e*=Math.ceil(this.time/e);return e===this.time?this.addEventInterval.apply(this,[a,b,d].concat(c)):this.addEvent.apply(this,[this.addEventInterval,e-this.time,a,b,d].concat(c))};c.prototype.addClassCycle=function(a,b,d,c){a[this.keyCycles]||(a[this.keyCycles]={});this.cancelClassCycle(a,d);
b=a[this.keyCycles][d||"0"]=this.setClassCycle(a,b,c);this.cycleClass(a,b);return b};c.prototype.addClassCycleSynched=function(a,b,d,c){a[this.keyCycles]||(a[this.keyCycles]={});this.cancelClassCycle(a,d);b=a[this.keyCycles][d||"0"]=this.setClassCycle(a,b,c,!0);this.cycleClass(a,b);return b};c.prototype.handleEvents=function(){var a,b;this.time+=1;if(a=this.events[this.time]){for(b=0;b<a.length;b+=1)this.handleEvent(a[b]);delete this.events[this.time]}};c.prototype.handleEvent=function(a){if(!(0>=
a.repeat||a.callback.apply(this,a.args))){if("function"===typeof a.repeat){if(!a.repeat.apply(this,a.args))return}else{if(!a.repeat)return;--a.repeat;if(0>=a.repeat)return}a.scheduleNextRepeat();this.insertEvent(a);return a.time}};c.prototype.cancelEvent=function(a){a.repeat=0};c.prototype.cancelAllEvents=function(){this.events={}};c.prototype.cancelClassCycle=function(a,b){var d;a[this.keyCycles]&&a[this.keyCycles][b]&&(d=a[this.keyCycles][b],d.event.repeat=0,delete a[this.keyCycles][b])};c.prototype.cancelAllCycles=
function(a){a=a[this.keyCycles];var b,d;for(d in a)a.hasOwnProperty(d)&&(b=a[d],b.length=1,b[0]=!1,delete a[d])};c.prototype.setClassCycle=function(a,b,d,c){var e=this;d=f.TimeEvent.runCalculator(d||this.timingDefault);this.copyCycleSettings&&(b=this.makeSettingsCopy(b));b.location=b.oldclass=-1;a[this.keyOnClassCycleStart]=c?function(){var c=b.length*d,c=Math.ceil(e.time/c)*c-e.time,c=0===c?e.addEventInterval(e.cycleClass,d,Infinity,a,b):e.addEvent(e.addEventInterval,c,e.cycleClass,d,Infinity,a,
b);b.event=c}:function(){b.event=e.addEventInterval(e.cycleClass,d,Infinity,a,b)};if(a[this.keyDoClassCycleStart])a[this.keyOnClassCycleStart]();return b};c.prototype.cycleClass=function(a,b){if(!a||!b||!b.length||this.keyCycleCheckValidity&&!a[this.keyCycleCheckValidity])return!0;var c;-1!==b.oldclass&&"string"===typeof b[b.oldclass]&&this.classRemove(a,b[b.oldclass]);b.location=(b.location+=1)%b.length;c=b[b.location];if(!c)return!1;c=c.constructor===Function?c(a,b):c;b.oldclass=b.location;return"string"===
typeof c?(this.classAdd(a,c),!1):!!c};c.prototype.insertEvent=function(a){this.events[a.time]?this.events[a.time].push(a):this.events[a.time]=[a]};c.prototype.makeSettingsCopy=function(a){var b=new a.constructor,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};c.prototype.classAddGeneric=function(a,b){a[this.keyClassName]+=" "+b};c.prototype.classRemoveGeneric=function(a,b){a[this.keyClassName]=a[this.keyClassName].replace(b,"")};return c}();f.TimeHandlr=g})(TimeHandlr||(TimeHandlr={}));var __extends=this&&this.__extends||function(e,g){function b(){this.constructor=e}for(var a in g)g.hasOwnProperty(a)&&(e[a]=g[a]);e.prototype=null===g?Object.create(g):(b.prototype=g.prototype,new b)},TouchPassr;
(function(e){var g=function(){function b(a,f,d){this.InputWriter=a;this.schema=f;this.resetElement(d)}b.prototype.getElement=function(){return this.element};b.prototype.getElementInner=function(){return this.elementInner};b.prototype.createElement=function(a){for(var f=[],d=1;d<arguments.length;d++)f[d-1]=arguments[d];var d=document.createElement(a||"div"),c;for(c=0;c<f.length;c+=1)this.proliferateElement(d,f[c]);return d};b.prototype.proliferateElement=function(a,f,d){void 0===d&&(d=!1);var c,h,
b;for(h in f)if(f.hasOwnProperty(h)&&(!d||!a.hasOwnProperty(h)))switch(c=f[h],h){case "children":case "children":if("undefined"!==typeof c)for(b=0;b<c.length;b+=1)a.appendChild(c[b]);break;case "style":this.proliferateElement(a[h],c);break;default:null===c?a[h]=null:"object"===typeof c?(a.hasOwnProperty(h)||(a[h]=new c.constructor),this.proliferateElement(a[h],c,d)):a[h]=c}return a};b.prototype.resetElement=function(a,f){var d=this,c=this.schema.position,b=c.offset;this.element=this.createElement("div",
{className:"control",style:{position:"absolute",width:0,height:0,boxSizing:"border-box",opacity:".84"}});this.elementInner=this.createElement("div",{className:"control-inner",textContent:this.schema.label||"",style:{position:"absolute",boxSizing:"border-box",textAlign:"center"}});this.element.appendChild(this.elementInner);"left"===c.horizontal?this.element.style.left="0":"right"===c.horizontal?this.element.style.right="0":"center"===c.horizontal&&(this.element.style.left="50%");"top"===c.vertical?
this.element.style.top="0":"bottom"===c.vertical?this.element.style.bottom="0":"center"===c.vertical&&(this.element.style.top="50%");this.passElementStyles(a.global);this.passElementStyles(a[f]);this.passElementStyles(this.schema.styles);b.left&&(this.elementInner.style.marginLeft=this.createPixelMeasurement(b.left));b.top&&(this.elementInner.style.marginTop=this.createPixelMeasurement(b.top));setTimeout(function(){"center"===c.horizontal&&(d.elementInner.style.left=d.createHalfSizeMeasurement(d.elementInner,
"width","offsetWidth"));"center"===c.vertical&&(d.elementInner.style.top=d.createHalfSizeMeasurement(d.elementInner,"height","offsetHeight"))})};b.prototype.createPixelMeasurement=function(a){return a?"number"===typeof a||a.constructor===Number?a+"px":a:"0"};b.prototype.createHalfSizeMeasurement=function(a,f,d){f=a.style[f]||d&&a[d];if(!f)return"0px";a=Number(f.replace(/[^\d]/g,""))||0;f=f.replace(/[\d]/g,"")||"px";return Math.round(a/-2)+f};b.prototype.passElementStyles=function(a){a&&(a.element&&
this.proliferateElement(this.element,a.element),a.elementInner&&this.proliferateElement(this.elementInner,a.elementInner))};b.prototype.setRotation=function(a,f){a.style.transform="rotate("+f+"deg)"};b.prototype.getOffsets=function(a){var f;a.offsetParent&&a!==a.offsetParent?(f=this.getOffsets(a.offsetParent),f[0]+=a.offsetLeft,f[1]+=a.offsetTop):f=[a.offsetLeft,a.offsetTop];return f};return b}();e.Control=g})(TouchPassr||(TouchPassr={}));
(function(e){var g=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.resetElement=function(a){var d=this.onEvent.bind(this,"activated"),c=this.onEvent.bind(this,"deactivated");b.prototype.resetElement.call(this,a,"Button");this.element.addEventListener("mousedown",d);this.element.addEventListener("touchstart",d);this.element.addEventListener("mouseup",c);this.element.addEventListener("touchend",c)};a.prototype.onEvent=function(a,d){var c=this.schema.pipes[a],b,l;if(c)for(b in c)if(c.hasOwnProperty(b))for(l=
0;l<c[b].length;l+=1)this.InputWriter.callEvent(b,c[b][l],d)};return a}(e.Control);e.ButtonControl=g})(TouchPassr||(TouchPassr={}));
(function(e){var g=function(b){function a(){b.apply(this,arguments)}__extends(a,b);a.prototype.resetElement=function(a){b.prototype.resetElement.call(this,a,"Joystick");var d=this.schema.directions,c,h,l,e,g,k;this.proliferateElement(this.elementInner,{style:{"border-radius":"100%"}});this.elementCircle=this.createElement("div",{className:"control-inner control-joystick-circle",style:{position:"absolute",background:"red",borderRadius:"100%"}});this.proliferateElement(this.elementCircle,a.Joystick.circle);
for(k=0;k<d.length;k+=1)h=d[k].degrees,c=Math.sin(h*Math.PI/180),l=Math.cos(h*Math.PI/180),e=50*l+50,g=50*c+50,c=this.createElement("div",{className:"control-joystick-tick",style:{position:"absolute",left:e+"%",top:g+"%",marginLeft:5*-l-5+"px",marginTop:2*-c-1+"px"}}),this.proliferateElement(c,a.Joystick.tick),this.setRotation(c,h),this.elementCircle.appendChild(c);this.elementDragLine=this.createElement("div",{className:"control-joystick-drag-line",style:{position:"absolute",opacity:"0",top:".77cm",
left:".77cm"}});this.proliferateElement(this.elementDragLine,a.Joystick.dragLine);this.elementCircle.appendChild(this.elementDragLine);this.elementDragShadow=this.createElement("div",{className:"control-joystick-drag-shadow",style:{position:"absolute",opacity:"1",top:"14%",right:"14%",bottom:"14%",left:"14%",marginLeft:"0",marginTop:"0",borderRadius:"100%"}});this.proliferateElement(this.elementDragShadow,a.Joystick.dragShadow);this.elementCircle.appendChild(this.elementDragShadow);this.elementInner.appendChild(this.elementCircle);
this.elementInner.addEventListener("click",this.triggerDragger.bind(this));this.elementInner.addEventListener("touchmove",this.triggerDragger.bind(this));this.elementInner.addEventListener("mousemove",this.triggerDragger.bind(this));this.elementInner.addEventListener("mouseover",this.positionDraggerEnable.bind(this));this.elementInner.addEventListener("touchstart",this.positionDraggerEnable.bind(this));this.elementInner.addEventListener("mouseout",this.positionDraggerDisable.bind(this));this.elementInner.addEventListener("touchend",
this.positionDraggerDisable.bind(this))};a.prototype.positionDraggerEnable=function(){this.dragEnabled=!0;this.elementDragLine.style.opacity="1"};a.prototype.positionDraggerDisable=function(){this.dragEnabled=!1;this.elementDragLine.style.opacity="0";this.elementDragShadow.style.top="14%";this.elementDragShadow.style.right="14%";this.elementDragShadow.style.bottom="14%";this.elementDragShadow.style.left="14%";if(this.currentDirection){if(this.currentDirection.pipes&&this.currentDirection.pipes.deactivated)this.onEvent(this.currentDirection.pipes.deactivated,
event);this.currentDirection=void 0}};a.prototype.triggerDragger=function(a){a.preventDefault();if(this.dragEnabled){var d=this.getEventCoordinates(a),c=d[0],d=d[1],b=this.getOffsets(this.elementInner),c=this.getThetaRaw(c-(b[0]+this.elementInner.offsetWidth/2)|0,b[1]+this.elementInner.offsetHeight/2-d|0),c=this.findClosestDirection(c),c=this.schema.directions[c],d=c.degrees,e=this.getThetaComponents(d),b=e[0],e=-e[1];this.elementDragLine.style.marginLeft=(77*b|0)+"%";this.elementDragLine.style.marginTop=
(77*e|0)+"%";this.elementDragShadow.style.top=(14+10*e|0)+"%";this.elementDragShadow.style.right=(14-10*b|0)+"%";this.elementDragShadow.style.bottom=(14-10*e|0)+"%";this.elementDragShadow.style.left=(14+10*b|0)+"%";this.setRotation(this.elementDragLine,(d+450)%360);this.positionDraggerEnable();this.setCurrentDirection(c,a)}};a.prototype.getEventCoordinates=function(a){return"touchmove"===a.type?(a=a.touches[0],[a.pageX,a.pageY]):[a.x,a.y]};a.prototype.getThetaRaw=function(a,b){return 0<a?0<b?180*
Math.atan(a/b)/Math.PI:180*-Math.atan(b/a)/Math.PI+90:0>b?180*Math.atan(a/b)/Math.PI+180:180*-Math.atan(b/a)/Math.PI+270};a.prototype.getThetaComponents=function(a){a=a*Math.PI/180;return[Math.sin(a),Math.cos(a)]};a.prototype.findClosestDirection=function(a){var b=this.schema.directions,c=Math.abs(b[0].degrees-a),e=b[0].degrees,g=0,n=0,m,k;for(k=1;k<b.length;k+=1)m=Math.abs(b[k].degrees-a),m<c&&(c=m,n=k),b[k].degrees<e&&(e=b[k].degrees,g=k);m=Math.abs(e+360-a);m<c&&(n=g);return n};a.prototype.setCurrentDirection=
function(a,b){if(this.currentDirection!==a){if(this.currentDirection&&this.currentDirection.pipes&&this.currentDirection.pipes.deactivated)this.onEvent(this.currentDirection.pipes.deactivated,b);if(a.pipes&&a.pipes.activated)this.onEvent(a.pipes.activated,b);this.currentDirection=a}};a.prototype.onEvent=function(a,b){var c,e;for(c in a)if(a.hasOwnProperty(c))for(e=0;e<a[c].length;e+=1)this.InputWriter.callEvent(c,a[c][e],b)};return a}(e.Control);e.JoystickControl=g})(TouchPassr||(TouchPassr={}));
(function(e){var g=function(){function b(a){if("undefined"===typeof a)throw Error("No settings object given to TouchPassr.");if("undefined"===typeof a.InputWriter)throw Error("No InputWriter given to TouchPassr.");this.InputWriter=a.InputWriter;this.styles=a.styles||{};this.resetContainer(a.container);this.controls={};a.controls&&this.addControls(a.controls);(this.enabled="undefined"===typeof a.enabled?!0:a.enabled)?this.enable():this.disable()}b.prototype.getInputWriter=function(){return this.InputWriter};
b.prototype.getEnabled=function(){return this.enabled};b.prototype.getStyles=function(){return this.styles};b.prototype.getControls=function(){return this.controls};b.prototype.getContainer=function(){return this.container};b.prototype.getParentContainer=function(){return this.parentContainer};b.prototype.enable=function(){this.enabled=!0;this.container.style.display="block"};b.prototype.disable=function(){this.enabled=!1;this.container.style.display="none"};b.prototype.setParentContainer=function(a){this.parentContainer=
a;this.parentContainer.appendChild(this.container)};b.prototype.addControls=function(a){for(var b in a)a.hasOwnProperty(b)&&this.addControl(a[b])};b.prototype.addControl=function(a){if(!b.controlClasses.hasOwnProperty(a.control))throw Error("Unknown control schema: '"+a.control+"'.");var e=new b.controlClasses[a.control](this.InputWriter,a,this.styles);this.controls[a.name]=e;this.container.appendChild(e.getElement())};b.prototype.resetContainer=function(a){this.container=e.Control.prototype.createElement("div",
{className:"touch-passer-container",style:{position:"absolute",top:0,right:0,bottom:0,left:0}});a&&this.setParentContainer(a)};b.controlClasses={Button:e.ButtonControl,Joystick:e.JoystickControl};return b}();e.TouchPassr=g})(TouchPassr||(TouchPassr={}));var UsageHelpr;
(function(f){var g=function(){function c(a){void 0===a&&(a={});this.openings=a.openings||[];this.options=a.options||{};this.optionHelp=a.optionHelp||"";this.aliases=a.aliases||[];this.logger=a.logger||console.log.bind(console)}c.prototype.displayHelpMenu=function(){var a=this;this.openings.forEach(function(b){return a.logHelpText(b)})};c.prototype.displayHelpOptions=function(){var a=this;this.logHelpText([this.optionHelp,"code"]);Object.keys(this.options).forEach(function(b){return a.displayHelpGroupSummary(b)});this.logHelpText(["\r\n"+
this.optionHelp,"code"])};c.prototype.displayHelpGroupSummary=function(a){var b=this.options[a],e=0,d;this.logger("\r\n%c"+a,c.styles.head);for(d=0;d<b.length;d+=1)e=Math.max(e,this.filterHelpText(b[d].title).length);for(d=0;d<b.length;d+=1)a=b[d],this.logger("%c"+this.padTextRight(this.filterHelpText(a.title),e)+"%c  // "+a.description,c.styles.code,c.styles.comment)};c.prototype.displayHelpOption=function(a){var b=this.options[a],e,d,c;this.logHelpText(["\r\n\r\n%c"+a+"\r\n-------\r\n\r\n","head"]);
for(d=0;d<b.length;d+=1){a=b[d];this.logHelpText(["%c"+a.title+"%c  ---  "+a.description,"head","italic"]);a.usage&&this.logHelpText(["%cUsage: %c"+a.usage,"comment","code"]);if(a.examples)for(c=0;c<a.examples.length;c+=1)e=a.examples[c],this.logger("\r\n"),this.logHelpText(["%c// "+e.comment,"comment"]),this.logHelpText(["%c"+this.padTextRight(this.filterHelpText(e.code),0),"code"]);this.logger("\r\n")}};c.prototype.logHelpText=function(a){if("string"===typeof a)return this.logHelpText([a]);var b=
a[0];a=a.slice(1).filter(function(a){return c.styles.hasOwnProperty(a)}).map(function(a){return c.styles[a]});this.logger.apply(this,[this.filterHelpText(b)].concat(a,[""]))};c.prototype.filterHelpText=function(a){if(a.constructor===Array)return this.filterHelpText(a[0]);var b;for(b=0;b<this.aliases.length;b+=1)a=a.replace(new RegExp(this.aliases[b][0],"g"),this.aliases[b][1]);return a};c.prototype.padTextRight=function(a,b,c){void 0===c&&(c=" ");b=1+b-a.length;return 0>=b?a:a+Array.call(Array,b).join(c)};
c.styles={code:"color: #000077; font-weight: bold; font-family: Consolas, Courier New, monospace;",comment:"color: #497749; font-style: italic;",head:"font-weight: bold; font-size: 117%;",italic:"font-style: italic;",none:""};return c}();f.UsageHelpr=g})(UsageHelpr||(UsageHelpr={}));var __extends=this&&this.__extends||function(d,h){function c(){this.constructor=d}for(var a in h)h.hasOwnProperty(a)&&(d[a]=h[a]);d.prototype=null===h?Object.create(h):(c.prototype=h.prototype,new c)},UserWrappr;
(function(d){(function(d){var c=function(){function a(a){this.UserWrapper=a;this.GameStarter=this.UserWrapper.getGameStarter()}a.prototype.getParentControlElement=function(a){return"control"!==a.className&&a.parentNode?this.getParentControlElement(a.parentElement):a};return a}();d.OptionsGenerator=c})(d.UISchemas||(d.UISchemas={}))})(UserWrappr||(UserWrappr={}));
(function(d){(function(d){var c=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.generate=function(f){var g=document.createElement("div"),a=f.options instanceof Function?f.options.call(self,this.GameStarter):f.options,e=this,k,b,c;g.className="select-options select-options-buttons";for(c=0;c<a.length;c+=1)k=a[c],b=document.createElement("div"),b.className="select-option options-button-option",b.textContent=k.title,b.onclick=function(g,f){"on"===e.getParentControlElement(f).getAttribute("active")&&
(g.callback.call(e,e.GameStarter,g,f),"true"===f.getAttribute("option-enabled")?(f.setAttribute("option-enabled","false"),f.className="select-option options-button-option option-disabled"):(f.setAttribute("option-enabled","true"),f.className="select-option options-button-option option-enabled"))}.bind(this,f,b),this.ensureLocalStorageButtonValue(b,k,f),k[f.keyActive||"active"]?(b.className+=" option-enabled",b.setAttribute("option-enabled","true")):f.assumeInactive?(b.className+=" option-disabled",
b.setAttribute("option-enabled","false")):b.setAttribute("option-enabled","true"),g.appendChild(b);return g};b.prototype.ensureLocalStorageButtonValue=function(f,g,a){var e=a.title+"::"+g.title,b=g.source.call(this,this.GameStarter).toString();f.setAttribute("localStorageKey",e);this.GameStarter.ItemsHolder.addItem(e,{storeLocally:!0,valueDefault:b});"true"===this.GameStarter.ItemsHolder.getItem(e).toString().toLowerCase()&&(g[a.keyActive||"active"]=!0,a.callback.call(this,this.GameStarter,a,f))};
return b}(d.OptionsGenerator);d.ButtonsGenerator=c})(d.UISchemas||(d.UISchemas={}))})(UserWrappr||(UserWrappr={}));
(function(d){(function(d){var c=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.generate=function(f){var g=document.createElement("div"),a=document.createElement("div"),e=document.createElement("div"),b=document.createElement("div"),c=this.createUploaderDiv();f=this.createMapSelectorDiv(f);var d=this;g.className="select-options select-options-level-editor";a.className="select-option select-option-large options-button-option";a.innerHTML="Start the <br /> Level Editor!";
a.onclick=function(){d.GameStarter.LevelEditor.enable()};e.className=b.className="select-option-title";e.innerHTML=b.innerHTML="<em>- or -</em><br />";g.appendChild(a);g.appendChild(e);g.appendChild(c);g.appendChild(b);g.appendChild(f);return g};b.prototype.createUploaderDiv=function(){var f=document.createElement("div"),g=document.createElement("input");f.className="select-option select-option-large options-button-option";f.innerHTML="Continue an<br />editor file!";f.setAttribute("textOld",f.textContent);
g.type="file";g.className="select-upload-input";g.onchange=this.handleFileDrop.bind(this,g,f);f.ondragenter=this.handleFileDragEnter.bind(this,f);f.ondragover=this.handleFileDragOver.bind(this,f);f.ondragleave=g.ondragend=this.handleFileDragLeave.bind(this,f);f.ondrop=this.handleFileDrop.bind(this,g,f);f.onclick=g.click.bind(g);f.appendChild(g);return f};b.prototype.createMapSelectorDiv=function(f){var g=!0,a=this.GameStarter.createElement("div",{className:"select-options-group select-options-editor-maps-selector"}),
b=this.GameStarter.createElement("div",{className:"select-option select-option-large options-button-option"}),k=this.GameStarter.createElement("div",{className:"select-options-holder select-options-editor-maps-holder"}),c=this.UserWrapper.getGenerators().MapsGrid.generate(this.GameStarter.proliferate({callback:f.callback},f.maps));b.onclick=function(f){(g=!g)?(b.textContent="(cancel)",k.style.position="",c.style.height=""):(b.innerHTML="Edit a <br />built-in map!",k.style.position="absolute",c.style.height=
"0");a.parentElement&&[].slice.call(a.parentElement.children).forEach(function(f){f!==a&&(f.style.display=g?"none":"block")})};b.onclick(null);k.appendChild(c);a.appendChild(b);a.appendChild(k);return a};b.prototype.handleFileDragEnter=function(f,g){g.dataTransfer&&(g.dataTransfer.dropEffect="copy");f.className+=" hovering"};b.prototype.handleFileDragOver=function(f,g){g.preventDefault();return!1};b.prototype.handleFileDragLeave=function(f,g){g.dataTransfer&&(g.dataTransfer.dropEffect="none");f.className=
f.className.replace(" hovering","")};b.prototype.handleFileDrop=function(f,g,a){var b=(f.files||a.dataTransfer.files)[0],k=new FileReader;this.handleFileDragLeave(f,a);a.preventDefault();a.stopPropagation();k.onprogress=this.handleFileUploadProgress.bind(this,b,g);k.onloadend=this.handleFileUploadCompletion.bind(this,b,g);k.readAsText(b)};b.prototype.handleFileUploadProgress=function(f,g,a){a.lengthComputable&&(a=Math.round(a.loaded/a.total*100),100<a&&(a=100),g.innerText="Uploading '"+f.name+"' ("+
a+"%)...")};b.prototype.handleFileUploadCompletion=function(f,g,a){this.GameStarter.LevelEditor.handleUploadCompletion(a);g.innerText=g.getAttribute("textOld")};return b}(d.OptionsGenerator);d.LevelEditorGenerator=c})(d.UISchemas||(d.UISchemas={}))})(UserWrappr||(UserWrappr={}));
(function(d){(function(d){var c=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.generate=function(f){var a=document.createElement("div");a.className="select-options select-options-maps-grid";f.rangeX&&f.rangeY&&a.appendChild(this.generateRangedTable(f));f.extras&&this.appendExtras(a,f);return a};b.prototype.generateRangedTable=function(f){var a=this,b=document.createElement("table"),e=f.rangeX,k=f.rangeY,c,d,l,h;for(l=k[0];l<=k[1];l+=1){c=document.createElement("tr");c.className=
"maps-grid-row";for(h=e[0];h<=e[1];h+=1)d=document.createElement("td"),d.className="select-option maps-grid-option maps-grid-option-range",d.textContent=l+"-"+h,d.onclick=function(f){"on"===a.getParentControlElement(d).getAttribute("active")&&f()}.bind(a,f.callback.bind(a,a.GameStarter,f,d)),c.appendChild(d);b.appendChild(c)}return b};b.prototype.appendExtras=function(a,g){var b,e,k;for(k=0;k<g.extras.length;k+=1)if(e=g.extras[k],b=document.createElement("div"),b.className="select-option maps-grid-option maps-grid-option-extra",
b.textContent=e.title,b.setAttribute("value",e.title),b.onclick=e.callback.bind(this,this.GameStarter,g,b),a.appendChild(b),e.extraElements)for(b=0;b<e.extraElements.length;b+=1)a.appendChild(this.GameStarter.createElement(e.extraElements[b].tag,e.extraElements[b].options))};return b}(d.OptionsGenerator);d.MapsGridGenerator=c})(d.UISchemas||(d.UISchemas={}))})(UserWrappr||(UserWrappr={}));
(function(d){(function(d){var c=function(a){function b(){a.apply(this,arguments)}__extends(b,a);b.prototype.generate=function(a){var g=document.createElement("div"),c=document.createElement("table"),e,k,d,h,l;g.className="select-options select-options-table";if(a.options)for(l=0;l<a.options.length;l+=1)k=document.createElement("tr"),d=document.createElement("td"),h=document.createElement("td"),e=a.options[l],d.className="options-label-"+e.type,d.textContent=e.title,h.className="options-cell-"+e.type,
k.appendChild(d),k.appendChild(h),d=b.optionTypes[a.options[l].type].call(this,h,e,a),e.storeLocally&&this.ensureLocalStorageInputValue(d,e,a),c.appendChild(k);g.appendChild(c);if(a.actions)for(l=0;l<a.actions.length;l+=1)k=document.createElement("div"),c=a.actions[l],k.className="select-option options-button-option",k.textContent=c.title,k.onclick=c.action.bind(this,this.GameStarter),g.appendChild(k);return g};b.prototype.setBooleanInput=function(a,b,c){c=b.source.call(this,this.GameStarter);var e=
this;a.className="select-option options-button-option option-"+(c?"enabled":"disabled");a.textContent=c?"on":"off";a.onclick=function(){a.setValue("off"===a.textContent)};a.setValue=function(c){if(c.constructor===String)if("false"===c||"off"===c)c=!1;else if("true"===c||"on"===c)c=!0;c?(b.enable.call(e,e.GameStarter),a.textContent="on",a.className=a.className.replace("disabled","enabled")):(b.disable.call(e,e.GameStarter),a.textContent="off",a.className=a.className.replace("enabled","disabled"));
b.storeLocally&&e.storeLocalStorageValue(a,c.toString())};return a};b.prototype.setKeyInput=function(a,b,c){c=b.source.call(this,this.GameStarter);var e=this.UserWrapper.getAllPossibleKeys(),k=[],d,h=this,l,n,m;for(n=0;n<c.length;n+=1){l=c[n].toLowerCase();d=document.createElement("select");d.className="options-key-option";d.value=d.valueOld=l;for(m=0;m<e.length;m+=1)d.appendChild(new Option(e[m])),e[m]===l&&(d.selectedIndex=m);d.onchange=function(a){b.callback.call(h,h.GameStarter,a.valueOld,a.value);
b.storeLocally&&h.storeLocalStorageValue(a,a.value)}.bind(void 0,d);k.push(d);a.appendChild(d)}return k};b.prototype.setNumberInput=function(a,b,c){var e=document.createElement("input"),d=this;e.type="number";e.value=Number(b.source.call(d,d.GameStarter)).toString();e.min=(b.minimum||0).toString();e.max=(b.maximum||Math.max(b.minimum+10,10)).toString();e.onchange=e.oninput=function(){e.checkValidity()&&b.update.call(d,d.GameStarter,e.value);b.storeLocally&&d.storeLocalStorageValue(e,e.value)};a.appendChild(e);
return e};b.prototype.setSelectInput=function(a,b,c){var e=document.createElement("select");c=b.options(this.GameStarter);var d=this,h;for(h=0;h<c.length;h+=1)e.appendChild(new Option(c[h]));e.value=b.source.call(d,d.GameStarter);e.onchange=function(){b.update.call(d,d.GameStarter,e.value);e.blur();b.storeLocally&&d.storeLocalStorageValue(e,e.value)};a.appendChild(e);return e};b.prototype.setScreenSizeInput=function(a,b,c){var e=this;b.options=function(){return Object.keys(e.UserWrapper.getSizes())};
b.source=function(){return e.UserWrapper.getCurrentSize().name};b.update=function(a,b){b!==e.UserWrapper.getCurrentSize()&&e.UserWrapper.setCurrentSize(b)};return e.setSelectInput(a,b,c)};b.prototype.ensureLocalStorageInputValue=function(a,b,c){if(a.constructor===Array)this.ensureLocalStorageValues(a,b,c);else if(c=c.title+"::"+b.title,b=b.source.call(this,this.GameStarter).toString(),a.setAttribute("localStorageKey",c),this.GameStarter.ItemsHolder.addItem(c,{storeLocally:!0,valueDefault:b}),b=this.GameStarter.ItemsHolder.getItem(c),
""!==b&&b!==a.value)if(a.value=b,a.setValue)a.setValue(b);else if(a.onchange)a.onchange(void 0);else if(a.onclick)a.onclick(void 0)};b.prototype.ensureLocalStorageValues=function(a,b,c){c=c.title+"::"+b.title;b=b.source.call(this,this.GameStarter);var e,d,h;for(h=0;h<a.length;h+=1)if(e=c+"::"+h,d=a[h],d.setAttribute("localStorageKey",e),this.GameStarter.ItemsHolder.addItem(e,{storeLocally:!0,valueDefault:b[h]}),e=this.GameStarter.ItemsHolder.getItem(e),""!==e&&e!==d.value)if(d.value=e,d.onchange)d.onchange(void 0);
else if(d.onclick)d.onclick(void 0)};b.prototype.storeLocalStorageValue=function(a,b){var c=a.getAttribute("localStorageKey");c&&(this.GameStarter.ItemsHolder.setItem(c,b),this.GameStarter.ItemsHolder.saveItem(c))};b.optionTypes={Boolean:b.prototype.setBooleanInput,Keys:b.prototype.setKeyInput,Number:b.prototype.setNumberInput,Select:b.prototype.setSelectInput,ScreenSize:b.prototype.setScreenSizeInput};return b}(d.OptionsGenerator);d.TableGenerator=c})(d.UISchemas||(d.UISchemas={}))})(UserWrappr||
(UserWrappr={}));
(function(d){var h=function(){function c(a){this.documentElement=document.documentElement;this.requestFullScreen=(this.documentElement.requestFullScreen||this.documentElement.webkitRequestFullScreen||this.documentElement.mozRequestFullScreen||this.documentElement.msRequestFullscreen||function(){alert("Not able to request full screen...")}).bind(this.documentElement);this.cancelFullScreen=(this.documentElement.cancelFullScreen||this.documentElement.webkitCancelFullScreen||this.documentElement.mozCancelFullScreen||this.documentElement.msCancelFullScreen||
function(){alert("Not able to cancel full screen...")}).bind(document);if("undefined"===typeof a)throw Error("No settings object given to UserWrappr.");if("undefined"===typeof a.GameStartrConstructor)throw Error("No GameStartrConstructor given to UserWrappr.");if("undefined"===typeof a.globalName)throw Error("No globalName given to UserWrappr.");if("undefined"===typeof a.sizes)throw Error("No sizes given to UserWrappr.");if("undefined"===typeof a.sizeDefault)throw Error("No sizeDefault given to UserWrappr.");
if("undefined"===typeof a.schemas)throw Error("No schemas given to UserWrappr.");this.settings=a;this.GameStartrConstructor=a.GameStartrConstructor;this.globalName=a.globalName;this.sizes=this.importSizes(a.sizes);this.customs=a.customs||{};this.gameElementSelector=a.gameElementSelector||"#game";this.gameControlsSelector=a.gameControlsSelector||"#controls";this.logger=a.logger||console.log.bind(console);this.isFullScreen=!1;this.setCurrentSize(this.sizes[a.sizeDefault]);this.allPossibleKeys=a.allPossibleKeys||
c.allPossibleKeys;this.GameStartrConstructor.prototype.proliferate(this.customs,this.currentSize,!0);this.resetGameStarter(a,this.customs)}c.prototype.resetGameStarter=function(a,b){void 0===b&&(b={});this.loadGameStarter(this.fixCustoms(b));window[a.globalName]=this.GameStarter;this.GameStarter.UserWrapper=this;this.loadGenerators();this.loadControls(a.schemas);a.styleSheet&&this.GameStarter.addPageStyles(a.styleSheet);this.resetPageVisibilityHandlers();this.GameStarter.gameStart();this.startCheckingDevices()};
c.prototype.getGameStartrConstructor=function(){return this.GameStartrConstructor};c.prototype.getGameStarter=function(){return this.GameStarter};c.prototype.getItemsHolder=function(){return this.ItemsHolder};c.prototype.getSettings=function(){return this.settings};c.prototype.getCustoms=function(){return this.customs};c.prototype.getAllPossibleKeys=function(){return this.allPossibleKeys};c.prototype.getSizes=function(){return this.sizes};c.prototype.getCurrentSize=function(){return this.currentSize};
c.prototype.getIsFullScreen=function(){return this.isFullScreen};c.prototype.getIsPageHidden=function(){return this.isPageHidden};c.prototype.getLogger=function(){return this.logger};c.prototype.getGenerators=function(){return this.generators};c.prototype.getDocumentElement=function(){return this.documentElement};c.prototype.getRequestFullScreen=function(){return this.requestFullScreen};c.prototype.getCancelFullScreen=function(){return this.cancelFullScreen};c.prototype.getDeviceChecker=function(){return this.deviceChecker};
c.prototype.setCurrentSize=function(a){if("string"===typeof a||a.constructor===String){if(!this.sizes.hasOwnProperty(a))throw Error("Size "+a+" does not exist on the UserWrappr.");a=this.sizes[a]}this.customs=this.fixCustoms(this.customs);a.full?(this.requestFullScreen(),this.isFullScreen=!0):this.isFullScreen&&(this.cancelFullScreen(),this.isFullScreen=!1);this.currentSize=a;this.GameStarter&&(this.GameStarter.container.parentNode.removeChild(this.GameStarter.container),this.resetGameStarter(this.settings,
this.customs))};c.prototype.startCheckingDevices=function(){this.checkDevices()};c.prototype.checkDevices=function(){this.deviceChecker=setTimeout(this.checkDevices.bind(this),this.GameStarter.GamesRunner.getPaused()?117:this.GameStarter.GamesRunner.getInterval()/this.GameStarter.GamesRunner.getSpeed());this.GameStarter.DeviceLayer.checkNavigatorGamepads();this.GameStarter.DeviceLayer.activateAllGamepadTriggers()};c.prototype.importSizes=function(a){a=this.GameStartrConstructor.prototype.proliferate({},
a);for(var b in a)a.hasOwnProperty(b)&&(a[b].name=a[b].name||b);return a};c.prototype.fixCustoms=function(a){a=this.GameStartrConstructor.prototype.proliferate({},a);this.GameStartrConstructor.prototype.proliferate(a,this.currentSize);isFinite(a.width)||(a.width=document.body.clientWidth);isFinite(a.height)||(a.height=a.full?screen.height:this.isFullScreen?window.innerHeight-140:window.innerHeight,a.height-=126);return a};c.prototype.resetPageVisibilityHandlers=function(){document.addEventListener("visibilitychange",
this.handleVisibilityChange.bind(this))};c.prototype.handleVisibilityChange=function(){switch(document.visibilityState){case "hidden":this.onPageHidden();break;case "visible":this.onPageVisible()}};c.prototype.onPageHidden=function(){this.GameStarter.GamesRunner.getPaused()||(this.isPageHidden=!0,this.GameStarter.GamesRunner.pause())};c.prototype.onPageVisible=function(){this.isPageHidden&&(this.isPageHidden=!1,this.GameStarter.GamesRunner.play())};c.prototype.loadGameStarter=function(a){var b=document.querySelector(this.gameElementSelector);
this.GameStarter&&this.GameStarter.GamesRunner.pause();this.GameStarter=new this.GameStartrConstructor(a);b.textContent="";b.appendChild(this.GameStarter.container);this.GameStarter.proliferate(document.body,{onkeydown:this.GameStarter.InputWriter.makePipe("onkeydown","keyCode"),onkeyup:this.GameStarter.InputWriter.makePipe("onkeyup","keyCode")});this.GameStarter.proliferate(b,{onmousedown:this.GameStarter.InputWriter.makePipe("onmousedown","which"),oncontextmenu:this.GameStarter.InputWriter.makePipe("oncontextmenu",
null,!0)})};c.prototype.loadGenerators=function(){this.generators={OptionsButtons:new d.UISchemas.ButtonsGenerator(this),OptionsTable:new d.UISchemas.TableGenerator(this),LevelEditor:new d.UISchemas.LevelEditorGenerator(this),MapsGrid:new d.UISchemas.MapsGridGenerator(this)}};c.prototype.loadControls=function(a){var b=document.querySelector(this.gameControlsSelector),c=a.length,d;this.ItemsHolder=new ItemsHoldr.ItemsHoldr({prefix:this.globalName+"::UserWrapper::ItemsHolder"});b.textContent="";b.className=
"length-"+c;for(d=0;d<c;d+=1)b.appendChild(this.loadControlDiv(a[d]))};c.prototype.loadControlDiv=function(a){var b=document.createElement("div"),c=document.createElement("h4"),d=document.createElement("div");b.className="control";b.id="control-"+a.title;c.textContent=a.title;d.className="control-inner";d.appendChild(this.generators[a.generator].generate(a));b.appendChild(c);b.appendChild(d);b.onmouseover=function(){setTimeout(function(){b.setAttribute("active","on")},35)};b.onmouseout=function(){b.setAttribute("active",
"off")};return b};c.allPossibleKeys="a b c d e f g h i j k l m n o p q r s t u v w x y z up right down left space shift ctrl".split(" ");return c}();d.UserWrappr=h})(UserWrappr||(UserWrappr={}));var WorldSeedr;
(function(l){var m=function(){function k(f,h){this.randomBetween=f;this.chooseAmong=h}k.prototype.calculateFromSpacing=function(f){if(!f)return 0;switch(f.constructor){case Array:return f[0].constructor===Number?this.randomBetween(f[0],f[1]):this.calculateFromPossibilities(f);case Object:return this.calculateFromPossibility(f);case Number:return f;default:throw Error("Unknown spacing requested: '"+f+"'.");}};k.prototype.calculateFromPossibility=function(f){var h=f.units||1;return this.randomBetween(f.min/h,
f.max/h)*h};k.prototype.calculateFromPossibilities=function(f){return this.calculateFromPossibility(this.chooseAmong(f).value)};return k}();l.SpacingCalculator=m})(WorldSeedr||(WorldSeedr={}));
(function(l){var m={top:"bottom",right:"left",bottom:"top",left:"right"},k={top:"height",right:"width",bottom:"height",left:"width"},f=["top","right","bottom","left"],h=["width","height"],n=function(){function e(a){if("undefined"===typeof a)throw Error("No settings object given to WorldSeedr.");if("undefined"===typeof a.possibilities)throw Error("No possibilities given to WorldSeedr.");this.possibilities=a.possibilities;this.random=a.random||Math.random.bind(Math);this.onPlacement=a.onPlacement||
console.log.bind(console,"Got:");this.spacingCalculator=new l.SpacingCalculator(this.randomBetween.bind(this),this.chooseAmong.bind(this));this.clearGeneratedCommands()}e.prototype.getPossibilities=function(){return this.possibilities};e.prototype.setPossibilities=function(a){this.possibilities=a};e.prototype.getOnPlacement=function(){return this.onPlacement};e.prototype.setOnPlacement=function(a){this.onPlacement=a};e.prototype.clearGeneratedCommands=function(){this.generatedCommands=[]};e.prototype.runGeneratedCommands=
function(){this.onPlacement(this.generatedCommands)};e.prototype.generate=function(a,b){var c=this.possibilities[a];if(!c)throw Error("No possibility exists under '"+a+"'");if(!c.contents)throw Error("Possibility '"+a+"' has no possibile outcomes.");return this.generateChildren(c,this.objectCopy(b))};e.prototype.generateFull=function(a){a=this.generate(a.title,a);var b,c;if(a&&a.children)for(c=0;c<a.children.length;c+=1)switch(b=a.children[c],b.type){case "Known":this.generatedCommands.push(b);break;
case "Random":this.generateFull(b);break;default:throw Error("Unknown child type: "+b.type);}};e.prototype.generateChildren=function(a,b,c){var d=a.contents,e=d.spacing||0;a=this.objectMerge(a,b);c=d.direction||c;switch(d.mode){case "Random":c=this.generateRandom(d,a,c,e);break;case "Certain":c=this.generateCertain(d,a,c,e);break;case "Repeat":c=this.generateRepeat(d,a,c,e);break;case "Multiple":c=this.generateMultiple(d,a,c,e);break;default:throw Error("Unknown contents mode: "+d.mode);}return this.wrapChoicePositionExtremes(c)};
e.prototype.generateCertain=function(a,b,c,d){var e=this;return a.children.map(function(a){if("Final"===a.type)return e.parseChoiceFinal(a,b,c);if(a=e.parseChoice(a,b,c))"Known"!==a.type&&(a.contents=e.generate(a.title,b)),e.shrinkPositionByChild(b,a,c,d);return a}).filter(function(a){return void 0!==a})};e.prototype.generateRepeat=function(a,b,c,d){a=a.children;for(var e=[],g,f=0;this.positionIsNotEmpty(b,c);){g=a[f];"Final"===g.type?g=this.parseChoiceFinal(g,b,c):(g=this.parseChoice(g,b,c))&&"Known"!==
g.type&&(g.contents=this.generate(g.title,b));if(g&&this.choiceFitsPosition(g,b))this.shrinkPositionByChild(b,g,c,d),e.push(g);else break;f+=1;f>=a.length&&(f=0)}return e};e.prototype.generateRandom=function(a,b,c,d){for(var e=[],f;this.positionIsNotEmpty(b,c);){f=this.generateChild(a,b,c);if(!f)break;this.shrinkPositionByChild(b,f,c,d);e.push(f);if(a.limit&&e.length>a.limit)return}return e};e.prototype.generateMultiple=function(a,b,c,d){var e=this;return a.children.map(function(a){a=e.parseChoice(a,
e.objectCopy(b),c);c&&e.movePositionBySpacing(b,c,d);return a})};e.prototype.generateChild=function(a,b,c){return(a=this.chooseAmongPosition(a.children,b))?this.parseChoice(a,b,c):void 0};e.prototype.parseChoice=function(a,b,c){var d=a.title,e=this.possibilities[d],d={title:d,type:a.type,arguments:a.arguments instanceof Array?this.chooseAmong(a.arguments).values:a.arguments,width:void 0,height:void 0,top:void 0,right:void 0,bottom:void 0,left:void 0};this.ensureSizingOnChoice(d,a,e);this.ensureDirectionBoundsOnChoice(d,
b);d[c]=d[m[c]]+d[k[c]];switch(e.contents.snap){case "top":d.bottom=d.top-d.height;break;case "right":d.left=d.right-d.width;break;case "bottom":d.top=d.bottom+d.height;break;case "left":d.right=d.left+d.width}a.stretch&&(d.arguments||(d.arguments={}),a.stretch.width&&(d.left=b.left,d.right=b.right,d.width=d.right-d.left,d.arguments.width=d.width),a.stretch.height&&(d.top=b.top,d.bottom=b.bottom,d.height=d.top-d.bottom,d.arguments.height=d.height));return d};e.prototype.parseChoiceFinal=function(a,
b,c){c=this.possibilities[a.source];return{type:"Known",title:a.title,arguments:a.arguments,width:c.width,height:c.height,top:b.top,right:b.right,bottom:b.bottom,left:b.left}};e.prototype.chooseAmong=function(a){if(a.length){if(1===a.length)return a[0];var b=this.randomPercentage(),c=0,d;for(d=0;d<a.length;d+=1)if(c+=a[d].percent,c>=b)return a[d]}};e.prototype.chooseAmongPosition=function(a,b){var c=b.right-b.left,d=b.top-b.bottom,e=this;return this.chooseAmong(a.filter(function(a){return e.choiceFitsSize(e.possibilities[a.title],
c,d)}))};e.prototype.choiceFitsSize=function(a,b,c){return a.width<=b&&a.height<=c};e.prototype.choiceFitsPosition=function(a,b){return this.choiceFitsSize(a,b.right-b.left,b.top-b.bottom)};e.prototype.positionIsNotEmpty=function(a,b){return"right"===b||"left"===b?a.left<a.right:a.top>a.bottom};e.prototype.shrinkPositionByChild=function(a,b,c,d){void 0===d&&(d=0);switch(c){case "top":a.bottom=b.top+this.spacingCalculator.calculateFromSpacing(d);break;case "right":a.left=b.right+this.spacingCalculator.calculateFromSpacing(d);
break;case "bottom":a.top=b.bottom-this.spacingCalculator.calculateFromSpacing(d);break;case "left":a.right=b.left-this.spacingCalculator.calculateFromSpacing(d)}};e.prototype.movePositionBySpacing=function(a,b,c){void 0===c&&(c=0);c=this.spacingCalculator.calculateFromSpacing(c);switch(b){case "top":a.top+=c;a.bottom+=c;break;case "right":a.left+=c;a.right+=c;break;case "bottom":a.top-=c;a.bottom-=c;break;case "left":a.left-=c;a.right-=c;break;default:throw Error("Unknown direction: "+b);}};e.prototype.wrapChoicePositionExtremes=
function(a){var b,c,d;if(a&&a.length){c=a[0];b={title:void 0,top:c.top,right:c.right,bottom:c.bottom,left:c.left,width:void 0,height:void 0,children:a};if(1===a.length)return b;for(d=1;d<a.length;d+=1){c=a[d];if(!Object.keys(c).length)return b;b.top=Math.max(b.top,c.top);b.right=Math.max(b.right,c.right);b.bottom=Math.min(b.bottom,c.bottom);b.left=Math.min(b.left,c.left)}b.width=b.right-b.left;b.height=b.top-b.bottom;return b}};e.prototype.ensureSizingOnChoice=function(a,b,c){var d,e;for(e in h)h.hasOwnProperty(e)&&
(d=h[e],a[d]=b.sizing&&"undefined"!==typeof b.sizing[d]?b.sizing[d]:c[d])};e.prototype.ensureDirectionBoundsOnChoice=function(a,b){for(var c in f)f.hasOwnProperty(c)&&(a[f[c]]=b[f[c]])};e.prototype.randomPercentage=function(){return Math.floor(100*this.random())+1};e.prototype.randomBetween=function(a,b){return Math.floor(this.random()*(1+b-a))+a};e.prototype.objectCopy=function(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b};e.prototype.objectMerge=function(a,b){var c=this.objectCopy(a),
d;for(d in b)b.hasOwnProperty(d)&&!c.hasOwnProperty(d)&&(c[d]=b[d]);return c};return e}();l.WorldSeedr=n})(WorldSeedr||(WorldSeedr={}));